const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./core-Cq-uZS8R.js","./index-DZuLAq9P.js","./index-5GHB6AZ1.css","./Web3Context-8eH1kVfe.js"])))=>i.map(i=>d[i]);
import{af as Fg,f as lf,F as Rt,E as Lg}from"./index-DZuLAq9P.js";import{A as wt,F as qa}from"./Web3Context-8eH1kVfe.js";var Uc=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Mg=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),qg=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),zg=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Vg=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Hg=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Kg=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Wg=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Nc=3,Gg=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Kg]],kc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Yg(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Hg:typeof navigator<"u"?Jg(navigator.userAgent):Qg()}function Zg(t){return t!==""&&Gg.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function Jg(t){var e=Zg(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Vg;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Nc&&(s=Uc(Uc([],s,!0),ey(Nc-s.length),!0)):s=[];var n=s.join("."),o=Xg(t),a=Wg.exec(t);return a&&a[1]?new zg(r,n,o,a[1]):new Mg(r,n,o)}function Xg(t){for(var e=0,r=kc.length;e<r;e++){var i=kc[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function Qg(){var t=typeof process<"u"&&process.version;return t?new qg(process.version.slice(1)):null}function ey(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Fn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Wo=function(t,e){return Wo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},Wo(t,e)};function ty(t,e){Wo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Go=function(){return Go=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Go.apply(this,arguments)};function ry(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function iy(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function sy(t,e){return function(r,i){e(r,i,t)}}function ny(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function oy(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function ay(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cy(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ly(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Yo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function uf(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function uy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(uf(arguments[e]));return t}function hy(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Yi(t){return this instanceof Yi?(this.v=t,this):new Yi(t)}function fy(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(p){return new Promise(function(d,g){n.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(n[0][3],d)}}function c(f){f.value instanceof Yi?Promise.resolve(f.value.v).then(l,u):h(n[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),n.shift(),n.length&&a(n[0][0],n[0][1])}}function dy(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:Yi(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function py(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Yo=="function"?Yo(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function gy(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function yy(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function wy(t){return t&&t.__esModule?t:{default:t}}function my(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function by(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const vy=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Go},__asyncDelegator:dy,__asyncGenerator:fy,__asyncValues:py,__await:Yi,__awaiter:oy,__classPrivateFieldGet:my,__classPrivateFieldSet:by,__createBinding:cy,__decorate:iy,__exportStar:ly,__extends:ty,__generator:ay,__importDefault:wy,__importStar:yy,__makeTemplateObject:gy,__metadata:ny,__param:sy,__read:uf,__rest:ry,__spread:uy,__spreadArrays:hy,__values:Yo},Symbol.toStringTag,{value:"Module"})),is=Fg(vy);var Ln={},Ii={},jc;function Ey(){if(jc)return Ii;jc=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Ii.delay=t,Ii}var Dr={},Mn={},Or={},Fc;function xy(){return Fc||(Fc=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.ONE_THOUSAND=Or.ONE_HUNDRED=void 0,Or.ONE_HUNDRED=100,Or.ONE_THOUSAND=1e3),Or}var qn={},Lc;function Iy(){return Lc||(Lc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(qn)),qn}var Mc;function hf(){return Mc||(Mc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=is;e.__exportStar(xy(),t),e.__exportStar(Iy(),t)}(Mn)),Mn}var qc;function _y(){if(qc)return Dr;qc=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.fromMiliseconds=Dr.toMiliseconds=void 0;const t=hf();function e(i){return i*t.ONE_THOUSAND}Dr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Dr.fromMiliseconds=r,Dr}var zc;function Sy(){return zc||(zc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=is;e.__exportStar(Ey(),t),e.__exportStar(_y(),t)}(Ln)),Ln}var Jr={},Vc;function $y(){if(Vc)return Jr;Vc=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Jr.Watch=t,Jr.default=t,Jr}var zn={},_i={},Hc;function Dy(){if(Hc)return _i;Hc=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.IWatch=void 0;class t{}return _i.IWatch=t,_i}var Kc;function Oy(){return Kc||(Kc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),is.__exportStar(Dy(),t)}(zn)),zn}var Wc;function Ay(){return Wc||(Wc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=is;e.__exportStar(Sy(),t),e.__exportStar($y(),t),e.__exportStar(Oy(),t),e.__exportStar(hf(),t)}(Fn)),Fn}var z=Ay(),se={},Gc;function ff(){if(Gc)return se;Gc=1,Object.defineProperty(se,"__esModule",{value:!0}),se.getLocalStorage=se.getLocalStorageOrThrow=se.getCrypto=se.getCryptoOrThrow=se.getLocation=se.getLocationOrThrow=se.getNavigator=se.getNavigatorOrThrow=se.getDocument=se.getDocumentOrThrow=se.getFromWindowOrThrow=se.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}se.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}se.getFromWindowOrThrow=e;function r(){return e("document")}se.getDocumentOrThrow=r;function i(){return t("document")}se.getDocument=i;function s(){return e("navigator")}se.getNavigatorOrThrow=s;function n(){return t("navigator")}se.getNavigator=n;function o(){return e("location")}se.getLocationOrThrow=o;function a(){return t("location")}se.getLocation=a;function c(){return e("crypto")}se.getCryptoOrThrow=c;function l(){return t("crypto")}se.getCrypto=l;function u(){return e("localStorage")}se.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return se.getLocalStorage=h,se}var rr=ff(),Si={},Yc;function Py(){if(Yc)return Si;Yc=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.getWindowMetadata=void 0;const t=ff();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function s(){const p=r.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const m=p[g],E=m.getAttribute("rel");if(E&&E.toLowerCase().indexOf("icon")>-1){const S=m.getAttribute("href");if(S)if(S.toLowerCase().indexOf("https:")===-1&&S.toLowerCase().indexOf("http:")===-1&&S.indexOf("//")!==0){let b=i.protocol+"//"+i.host;if(S.indexOf("/")===0)b+=S;else{const I=i.pathname.split("/");I.pop();const A=I.join("/");b+=A+"/"+S}d.push(b)}else if(S.indexOf("//")===0){const b=i.protocol+S;d.push(b)}else d.push(S)}}return d}function n(...p){const d=r.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const m=d[g],E=["itemprop","property","name"].map(S=>m.getAttribute(S)).filter(S=>S?p.includes(S):!1);if(E.length&&E){const S=m.getAttribute("content");if(S)return S}}return""}function o(){let p=n("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=i.origin,h=s();return{description:l,url:u,icons:h,name:c}}return Si.getWindowMetadata=e,Si}var By=Py();const Cy="0.1.1";function Ty(){return Cy}class le extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof le){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof le&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||s?["",i?`Details: ${i}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Ty()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return df(this,e)}}function df(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?df(t.cause,e):e?null:t}const Xr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ry(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function qr(t,...e){if(!Ry(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Uy(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Zi(t.outputLen),Zi(t.blockLen)}function yi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function pf(t,e){qr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ny(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function wi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Vn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function $t(t,e){return t<<32-e|t>>>e}const ky=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function jy(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Fy(t){for(let e=0;e<t.length;e++)t[e]=jy(t[e]);return t}const Zc=ky?t=>t:Fy;function Ly(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function yn(t){return typeof t=="string"&&(t=Ly(t)),qr(t),t}function My(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];qr(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class za{}function gf(t){const e=i=>t().update(yn(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function qy(t=32){if(Xr&&typeof Xr.getRandomValues=="function")return Xr.getRandomValues(new Uint8Array(t));if(Xr&&typeof Xr.randomBytes=="function")return Uint8Array.from(Xr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function zy(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function Vy(t,e,r){return t&e^~t&r}function Hy(t,e,r){return t&e^t&r^e&r}class Ky extends za{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Vn(this.buffer)}update(e){yi(this),e=yn(e),qr(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Vn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yi(this),pf(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,wi(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;zy(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Vn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const nr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bs=BigInt(2**32-1),Jc=BigInt(32);function Wy(t,e=!1){return e?{h:Number(t&bs),l:Number(t>>Jc&bs)}:{h:Number(t>>Jc&bs)|0,l:Number(t&bs)|0}}function Gy(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=Wy(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const Yy=(t,e,r)=>t<<r|e>>>32-r,Zy=(t,e,r)=>e<<r|t>>>32-r,Jy=(t,e,r)=>e<<r-32|t>>>64-r,Xy=(t,e,r)=>t<<r-32|e>>>64-r,Qy=BigInt(0),$i=BigInt(1),e0=BigInt(2),t0=BigInt(7),r0=BigInt(256),i0=BigInt(113),yf=[],wf=[],mf=[];for(let t=0,e=$i,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],yf.push(2*(5*i+r)),wf.push((t+1)*(t+2)/2%64);let s=Qy;for(let n=0;n<7;n++)e=(e<<$i^(e>>t0)*i0)%r0,e&e0&&(s^=$i<<($i<<BigInt(n))-$i);mf.push(s)}const bf=Gy(mf,!0),s0=bf[0],n0=bf[1],Xc=(t,e,r)=>r>32?Jy(t,e,r):Yy(t,e,r),Qc=(t,e,r)=>r>32?Xy(t,e,r):Zy(t,e,r);function o0(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Xc(l,u,1)^r[a],f=Qc(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=wf[o],c=Xc(s,n,a),l=Qc(s,n,a),u=yf[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=s0[i],t[1]^=n0[i]}wi(r)}class Va extends za{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,Zi(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ny(this.state)}clone(){return this._cloneInto()}keccak(){Zc(this.state32),o0(this.state32,this.rounds),Zc(this.state32),this.posOut=0,this.pos=0}update(e){yi(this),e=yn(e),qr(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,(r&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){yi(this,!1),qr(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Zi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(pf(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wi(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Va(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const a0=(t,e,r)=>gf(()=>new Va(e,t,r)),c0=a0(1,136,256/8),l0=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),or=new Uint32Array(64);class u0 extends Ky{constructor(e=32){super(64,e,8,!1),this.A=nr[0]|0,this.B=nr[1]|0,this.C=nr[2]|0,this.D=nr[3]|0,this.E=nr[4]|0,this.F=nr[5]|0,this.G=nr[6]|0,this.H=nr[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)or[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=or[h-15],p=or[h-2],d=$t(f,7)^$t(f,18)^f>>>3,g=$t(p,17)^$t(p,19)^p>>>10;or[h]=g+or[h-7]+d+or[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=$t(a,6)^$t(a,11)^$t(a,25),p=u+f+Vy(a,c,l)+l0[h]+or[h]|0,g=($t(i,2)^$t(i,13)^$t(i,22))+Hy(i,s,n)|0;u=l,l=c,c=a,a=o+p|0,o=n,n=s,s=i,i=p+g|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){wi(or)}destroy(){this.set(0,0,0,0,0,0,0,0),wi(this.buffer)}}const h0=gf(()=>new u0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ha=BigInt(0),Zo=BigInt(1);function ss(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ka(t){if(!ss(t))throw new Error("Uint8Array expected")}function Ji(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function vs(t){const e=t.toString(16);return e.length&1?"0"+e:e}function vf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ha:BigInt("0x"+t)}const Ef=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",f0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xi(t){if(Ka(t),Ef)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=f0[t[r]];return e}const Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function el(t){if(t>=Lt._0&&t<=Lt._9)return t-Lt._0;if(t>=Lt.A&&t<=Lt.F)return t-(Lt.A-10);if(t>=Lt.a&&t<=Lt.f)return t-(Lt.a-10)}function Ws(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Ef)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=el(t.charCodeAt(n)),a=el(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Mr(t){return vf(Xi(t))}function xf(t){return Ka(t),vf(Xi(Uint8Array.from(t).reverse()))}function ns(t,e){return Ws(t.toString(16).padStart(e*2,"0"))}function If(t,e){return ns(t,e).reverse()}function ht(t,e,r){let i;if(typeof e=="string")try{i=Ws(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(ss(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Gs(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Ka(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Hn=t=>typeof t=="bigint"&&Ha<=t;function Wa(t,e,r){return Hn(t)&&Hn(e)&&Hn(r)&&e<=t&&t<r}function hi(t,e,r,i){if(!Wa(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function d0(t){let e;for(e=0;t>Ha;t>>=Zo,e+=1);return e}const wn=t=>(Zo<<BigInt(t))-Zo,Kn=t=>new Uint8Array(t),tl=t=>Uint8Array.from(t);function p0(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Kn(t),s=Kn(t),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...h)=>r(s,i,...h),c=(h=Kn(0))=>{s=a(tl([0]),h),i=a(),h.length!==0&&(s=a(tl([1]),h),i=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const p=i.slice();f.push(p),h+=i.length}return Gs(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(l()));)c();return o(),p}}const g0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ss(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function mn(t,e,r={}){const i=(s,n,o)=>{const a=g0[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function rl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}function y0(t,e){if(ol(t)>e)throw new k0({givenSize:ol(t),maxSize:e})}const Mt={zero:48,nine:57,A:65,F:70,a:97,f:102};function il(t){if(t>=Mt.zero&&t<=Mt.nine)return t-Mt.zero;if(t>=Mt.A&&t<=Mt.F)return t-(Mt.A-10);if(t>=Mt.a&&t<=Mt.f)return t-(Mt.a-10)}function w0(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new j0({size:t.length,targetSize:i,type:"Bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const o=r==="right";s[o?n:i-n-1]=t[o?n:t.length-n-1]}return s}function _f(t,e){if(Ir(t)>e)throw new D0({givenSize:Ir(t),maxSize:e})}function m0(t,e){if(typeof e=="number"&&e>0&&e>Ir(t)-1)throw new Df({offset:e,position:"start",size:Ir(t)})}function b0(t,e,r){if(typeof e=="number"&&typeof r=="number"&&Ir(t)!==r-e)throw new Df({offset:r,position:"end",size:Ir(t)})}function Sf(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const s=t.replace("0x","");if(s.length>i*2)throw new O0({size:Math.ceil(s.length/2),targetSize:i,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const v0="#__bigint";function Ga(t,e,r){return JSON.stringify(t,(i,s)=>typeof s=="bigint"?s.toString()+v0:s,r)}const E0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function x0(t,e={}){const{strict:r=!1}=e;if(!t)throw new sl(t);if(typeof t!="string")throw new sl(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new nl(t);if(!t.startsWith("0x"))throw new nl(t)}function I0(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Ya(t){return t instanceof Uint8Array?Ys(t):Array.isArray(t)?Ys(new Uint8Array(t)):t}function Ys(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=E0[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(_f(i,e.size),$f(i,e.size)):i}function Wn(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const l=typeof t=="bigint"?"n":"";throw new $0({max:n?`${n}${l}`:void 0,min:`${o}${l}`,signed:r,size:i,value:`${t}${l}`})}const c=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?_0(c,i):c}function _0(t,e){return Sf(t,{dir:"left",size:e})}function $f(t,e){return Sf(t,{dir:"right",size:e})}function Yt(t,e,r,i={}){const{strict:s}=i;m0(t,e);const n=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&b0(n,e,r),n}function Ir(t){return Math.ceil((t.length-2)/2)}function S0(t,e={}){const{strict:r=!1}=e;try{return x0(t,{strict:r}),!0}catch{return!1}}class $0 extends le{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number \`${n}\` is not in safe${s?` ${s*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class sl extends le{constructor(e){super(`Value \`${typeof e=="object"?Ga(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class nl extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let D0=class extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Df extends le{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let O0=class extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const A0=new TextEncoder;function P0(t){if(!(t instanceof Uint8Array)){if(!t)throw new Es(t);if(typeof t!="object")throw new Es(t);if(!("BYTES_PER_ELEMENT"in t))throw new Es(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Es(t)}}function B0(t){return t instanceof Uint8Array?t:typeof t=="string"?T0(t):C0(t)}function C0(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function T0(t,e={}){const{size:r}=e;let i=t;r&&(_f(t,r),i=$f(t,r));let s=i.slice(2);s.length%2&&(s=`0${s}`);const n=s.length/2,o=new Uint8Array(n);for(let a=0,c=0;a<n;a++){const l=il(s.charCodeAt(c++)),u=il(s.charCodeAt(c++));if(l===void 0||u===void 0)throw new le(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=l*16+u}return o}function R0(t,e={}){const{size:r}=e,i=A0.encode(t);return typeof r=="number"?(y0(i,r),U0(i,r)):i}function U0(t,e){return w0(t,{dir:"right",size:e})}function ol(t){return t.length}function N0(t){try{return P0(t),!0}catch{return!1}}class Es extends le{constructor(e){super(`Value \`${typeof e=="object"?Ga(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class k0 extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class j0 extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Of(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=c0(B0(t));return r==="Bytes"?i:Ys(i)}class F0 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const L0={checksum:new F0(8192)},Gn=L0.checksum;function Af(t,e={}){const{compressed:r}=e,{prefix:i,x:s,y:n}=t;if(r===!1||typeof s=="bigint"&&typeof n=="bigint"){if(i!==4)throw new al({prefix:i,cause:new K0});return}if(r===!0||typeof s=="bigint"&&typeof n>"u"){if(i!==3&&i!==2)throw new al({prefix:i,cause:new H0});return}throw new V0({publicKey:t})}function M0(t){const e=(()=>{if(S0(t))return Pf(t);if(N0(t))return q0(t);const{prefix:r,x:i,y:s}=t;return typeof i=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:i,y:s}:{prefix:r,x:i}})();return Af(e),e}function q0(t){return Pf(Ys(t))}function Pf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new W0({publicKey:t});if(t.length===130){const i=BigInt(Yt(t,0,32)),s=BigInt(Yt(t,32,64));return{prefix:4,x:i,y:s}}if(t.length===132){const i=Number(Yt(t,0,1)),s=BigInt(Yt(t,1,33)),n=BigInt(Yt(t,33,65));return{prefix:i,x:s,y:n}}const e=Number(Yt(t,0,1)),r=BigInt(Yt(t,1,33));return{prefix:e,x:r}}function z0(t,e={}){Af(t);const{prefix:r,x:i,y:s}=t,{includePrefix:n=!0}=e;return I0(n?Wn(r,{size:1}):"0x",Wn(i,{size:32}),typeof s=="bigint"?Wn(s,{size:32}):"0x")}class V0 extends le{constructor({publicKey:e}){super(`Value \`${Ga(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class al extends le{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class H0 extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class K0 extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let W0=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Ir(Ya(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const G0=/^0x[a-fA-F0-9]{40}$/;function Bf(t,e={}){const{strict:r=!0}=e;if(!G0.test(t))throw new cl({address:t,cause:new J0});if(r){if(t.toLowerCase()===t)return;if(Cf(t)!==t)throw new cl({address:t,cause:new X0})}}function Cf(t){if(Gn.has(t))return Gn.get(t);Bf(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Of(R0(e),{as:"Bytes"}),i=e.split("");for(let n=0;n<40;n+=2)r[n>>1]>>4>=8&&i[n]&&(i[n]=i[n].toUpperCase()),(r[n>>1]&15)>=8&&i[n+1]&&(i[n+1]=i[n+1].toUpperCase());const s=`0x${i.join("")}`;return Gn.set(t,s),s}function Y0(t,e={}){const{checksum:r=!1}=e;return Bf(t),r?Cf(t):t}function Z0(t,e={}){const r=Of(`0x${z0(t).slice(4)}`).substring(26);return Y0(`0x${r}`,e)}class cl extends le{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class J0 extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class X0 extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class Tf extends za{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Uy(e);const i=yn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),wi(n)}update(e){return yi(this),this.iHash.update(e),this}digestInto(e){yi(this),qr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Rf=(t,e,r)=>new Tf(t,e).update(r).digest();Rf.create=(t,e)=>new Tf(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ze=BigInt(0),Fe=BigInt(1),Nr=BigInt(2),Q0=BigInt(3),Uf=BigInt(4),Nf=BigInt(5),kf=BigInt(8);function We(t,e){const r=t%e;return r>=Ze?r:e+r}function ot(t,e,r){let i=t;for(;e-- >Ze;)i*=i,i%=r;return i}function Jo(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let r=We(t,e),i=e,s=Ze,n=Fe;for(;r!==Ze;){const a=i/r,c=i%r,l=s-n*a;i=r,r=c,s=n,n=l}if(i!==Fe)throw new Error("invert: does not exist");return We(s,e)}function jf(t,e){const r=(t.ORDER+Fe)/Uf,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function ew(t,e){const r=(t.ORDER-Nf)/kf,i=t.mul(e,Nr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Nr),s),a=t.mul(n,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function tw(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Fe,r=0;for(;e%Nr===Ze;)e/=Nr,r++;let i=Nr;const s=Za(t);for(;ll(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return jf;let n=s.pow(i,e);const o=(e+Fe)/Nr;return function(c,l){if(c.is0(l))return l;if(ll(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,n),f=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===u)throw new Error("Cannot find square root");const m=Fe<<BigInt(u-d-1),E=c.pow(h,m);u=d,h=c.sqr(E),f=c.mul(f,h),p=c.mul(p,E)}return p}}function rw(t){return t%Uf===Q0?jf:t%kf===Nf?ew:tw(t)}const iw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=iw.reduce((i,s)=>(i[s]="function",i),e);return mn(t,r)}function nw(t,e,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return t.ONE;if(r===Fe)return e;let i=t.ONE,s=e;for(;r>Ze;)r&Fe&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Fe;return i}function Ff(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function ll(t,e){const r=(t.ORDER-Fe)/Nr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function Lf(t,e){e!==void 0&&Zi(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Za(t,e,r=!1,i={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=Lf(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:wn(s),ZERO:Ze,ONE:Fe,create:c=>We(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ze<=c&&c<t},is0:c=>c===Ze,isOdd:c=>(c&Fe)===Fe,neg:c=>We(-c,t),eql:(c,l)=>c===l,sqr:c=>We(c*c,t),add:(c,l)=>We(c+l,t),sub:(c,l)=>We(c-l,t),mul:(c,l)=>We(c*l,t),pow:(c,l)=>nw(a,c,l),div:(c,l)=>We(c*Jo(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Jo(c,t),sqrt:i.sqrt||(c=>(o||(o=rw(t)),o(a,c))),toBytes:c=>r?If(c,n):ns(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?xf(c):Mr(c)},invertBatch:c=>Ff(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Mf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function qf(t){const e=Mf(t);return e+Math.ceil(e/2)}function ow(t,e,r=!1){const i=t.length,s=Mf(e),n=qf(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?xf(t):Mr(t),a=We(o,e-Fe)+Fe;return r?If(a,s):ns(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ul=BigInt(0),Xo=BigInt(1);function Yn(t,e){const r=e.negate();return t?r:e}function zf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Zn(t,e){zf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=wn(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function hl(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Xo);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function aw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function cw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Jn=new WeakMap,Vf=new WeakMap;function Xn(t){return Vf.get(t)||1}function lw(t,e){return{constTimeNegate:Yn,hasPrecomputes(r){return Xn(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>ul;)i&Xo&&(s=s.add(n)),n=n.double(),i>>=Xo;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Zn(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){let n=t.ZERO,o=t.BASE;const a=Zn(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:d}=hl(s,c,a);s=l,h?o=o.add(Yn(p,i[d])):n=n.add(Yn(f,i[u]))}return{p:n,f:o}},wNAFUnsafe(r,i,s,n=t.ZERO){const o=Zn(r,e);for(let a=0;a<o.windows&&s!==ul;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=hl(s,a,o);if(s=c,!u){const f=i[l];n=n.add(h?f.negate():f)}}return n},getPrecomputes(r,i,s){let n=Jn.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Jn.set(i,s(n))),n},wNAFCached(r,i,s){const n=Xn(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Xn(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){zf(i,e),Vf.set(r,i),Jn.delete(r)}}}function uw(t,e,r,i){aw(r,t),cw(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=d0(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=wn(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<n;g++){const m=i[g],E=Number(m>>BigInt(p)&l);u[E]=u[E].add(r[g])}let d=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),d=d.add(m);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Hf(t){return sw(t.Fp),mn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Lf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fl(t){t.lowS!==void 0&&Ji("lowS",t.lowS),t.prehash!==void 0&&Ji("prehash",t.prehash)}function hw(t){const e=Hf(t);mn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:s}=e;if(r){if(!i.eql(s,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class fw extends Error{constructor(e=""){super(e)}}const Zt={Err:fw,_tlv:{encode:(t,e)=>{const{Err:r}=Zt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=vs(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?vs(s.length/2|128):"";return vs(t)+n+s+e},decode(t,e){const{Err:r}=Zt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Zt;if(t<Xt)throw new e("integer: negative integers are not allowed");let r=vs(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Zt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Mr(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Zt,s=ht("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Zt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}};function Qn(t,e){return Xi(ns(t,e))}const Xt=BigInt(0),Ie=BigInt(1);BigInt(2);const eo=BigInt(3),dw=BigInt(4);function pw(t){const e=hw(t),{Fp:r}=e,i=Za(e.n,e.nBitLength),s=e.toBytes||((b,I,A)=>{const v=I.toAffine();return Gs(Uint8Array.from([4]),r.toBytes(v.x),r.toBytes(v.y))}),n=e.fromBytes||(b=>{const I=b.subarray(1),A=r.fromBytes(I.subarray(0,r.BYTES)),v=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:A,y:v}});function o(b){const{a:I,b:A}=e,v=r.sqr(b),C=r.mul(v,b);return r.add(r.add(C,r.mul(b,I)),A)}function a(b,I){const A=r.sqr(I),v=o(b);return r.eql(A,v)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,eo),dw),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(b){return Wa(b,Ie,e.n)}function h(b){const{allowedPrivateKeyLengths:I,nByteLength:A,wrapPrivateKey:v,n:C}=e;if(I&&typeof b!="bigint"){if(ss(b)&&(b=Xi(b)),typeof b!="string"||!I.includes(b.length))throw new Error("invalid private key");b=b.padStart(A*2,"0")}let R;try{R=typeof b=="bigint"?b:Mr(ht("private key",b,A))}catch{throw new Error("invalid private key, expected hex or "+A+" bytes, got "+typeof b)}return v&&(R=We(R,C)),hi("private key",R,Ie,C),R}function f(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const p=rl((b,I)=>{const{px:A,py:v,pz:C}=b;if(r.eql(C,r.ONE))return{x:A,y:v};const R=b.is0();I==null&&(I=R?r.ONE:r.inv(C));const B=r.mul(A,I),k=r.mul(v,I),U=r.mul(C,I);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(U,r.ONE))throw new Error("invZ was invalid");return{x:B,y:k}}),d=rl(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:I,y:A}=b.toAffine();if(!r.isValid(I)||!r.isValid(A))throw new Error("bad point: x or y not FE");if(!a(I,A))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(I,A,v){if(I==null||!r.isValid(I))throw new Error("x required");if(A==null||!r.isValid(A)||r.is0(A))throw new Error("y required");if(v==null||!r.isValid(v))throw new Error("z required");this.px=I,this.py=A,this.pz=v,Object.freeze(this)}static fromAffine(I){const{x:A,y:v}=I||{};if(!I||!r.isValid(A)||!r.isValid(v))throw new Error("invalid affine point");if(I instanceof g)throw new Error("projective point not allowed");const C=R=>r.eql(R,r.ZERO);return C(A)&&C(v)?g.ZERO:new g(A,v,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(I){const A=Ff(r,I.map(v=>v.pz));return I.map((v,C)=>v.toAffine(A[C])).map(g.fromAffine)}static fromHex(I){const A=g.fromAffine(n(ht("pointHex",I)));return A.assertValidity(),A}static fromPrivateKey(I){return g.BASE.multiply(h(I))}static msm(I,A){return uw(g,i,I,A)}_setWindowSize(I){S.setWindowSize(this,I)}assertValidity(){d(this)}hasEvenY(){const{y:I}=this.toAffine();if(r.isOdd)return!r.isOdd(I);throw new Error("Field doesn't support isOdd")}equals(I){f(I);const{px:A,py:v,pz:C}=this,{px:R,py:B,pz:k}=I,U=r.eql(r.mul(A,k),r.mul(R,C)),T=r.eql(r.mul(v,k),r.mul(B,C));return U&&T}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:I,b:A}=e,v=r.mul(A,eo),{px:C,py:R,pz:B}=this;let k=r.ZERO,U=r.ZERO,T=r.ZERO,O=r.mul(C,C),D=r.mul(R,R),y=r.mul(B,B),w=r.mul(C,R);return w=r.add(w,w),T=r.mul(C,B),T=r.add(T,T),k=r.mul(I,T),U=r.mul(v,y),U=r.add(k,U),k=r.sub(D,U),U=r.add(D,U),U=r.mul(k,U),k=r.mul(w,k),T=r.mul(v,T),y=r.mul(I,y),w=r.sub(O,y),w=r.mul(I,w),w=r.add(w,T),T=r.add(O,O),O=r.add(T,O),O=r.add(O,y),O=r.mul(O,w),U=r.add(U,O),y=r.mul(R,B),y=r.add(y,y),O=r.mul(y,w),k=r.sub(k,O),T=r.mul(y,D),T=r.add(T,T),T=r.add(T,T),new g(k,U,T)}add(I){f(I);const{px:A,py:v,pz:C}=this,{px:R,py:B,pz:k}=I;let U=r.ZERO,T=r.ZERO,O=r.ZERO;const D=e.a,y=r.mul(e.b,eo);let w=r.mul(A,R),x=r.mul(v,B),P=r.mul(C,k),_=r.add(A,v),$=r.add(R,B);_=r.mul(_,$),$=r.add(w,x),_=r.sub(_,$),$=r.add(A,C);let N=r.add(R,k);return $=r.mul($,N),N=r.add(w,P),$=r.sub($,N),N=r.add(v,C),U=r.add(B,k),N=r.mul(N,U),U=r.add(x,P),N=r.sub(N,U),O=r.mul(D,$),U=r.mul(y,P),O=r.add(U,O),U=r.sub(x,O),O=r.add(x,O),T=r.mul(U,O),x=r.add(w,w),x=r.add(x,w),P=r.mul(D,P),$=r.mul(y,$),x=r.add(x,P),P=r.sub(w,P),P=r.mul(D,P),$=r.add($,P),w=r.mul(x,$),T=r.add(T,w),w=r.mul(N,$),U=r.mul(_,U),U=r.sub(U,w),w=r.mul(_,x),O=r.mul(N,O),O=r.add(O,w),new g(U,T,O)}subtract(I){return this.add(I.negate())}is0(){return this.equals(g.ZERO)}wNAF(I){return S.wNAFCached(this,I,g.normalizeZ)}multiplyUnsafe(I){const{endo:A,n:v}=e;hi("scalar",I,Xt,v);const C=g.ZERO;if(I===Xt)return C;if(this.is0()||I===Ie)return this;if(!A||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,I,g.normalizeZ);let{k1neg:R,k1:B,k2neg:k,k2:U}=A.splitScalar(I),T=C,O=C,D=this;for(;B>Xt||U>Xt;)B&Ie&&(T=T.add(D)),U&Ie&&(O=O.add(D)),D=D.double(),B>>=Ie,U>>=Ie;return R&&(T=T.negate()),k&&(O=O.negate()),O=new g(r.mul(O.px,A.beta),O.py,O.pz),T.add(O)}multiply(I){const{endo:A,n:v}=e;hi("scalar",I,Ie,v);let C,R;if(A){const{k1neg:B,k1:k,k2neg:U,k2:T}=A.splitScalar(I);let{p:O,f:D}=this.wNAF(k),{p:y,f:w}=this.wNAF(T);O=S.constTimeNegate(B,O),y=S.constTimeNegate(U,y),y=new g(r.mul(y.px,A.beta),y.py,y.pz),C=O.add(y),R=D.add(w)}else{const{p:B,f:k}=this.wNAF(I);C=B,R=k}return g.normalizeZ([C,R])[0]}multiplyAndAddUnsafe(I,A,v){const C=g.BASE,R=(k,U)=>U===Xt||U===Ie||!k.equals(C)?k.multiplyUnsafe(U):k.multiply(U),B=R(this,A).add(R(I,v));return B.is0()?void 0:B}toAffine(I){return p(this,I)}isTorsionFree(){const{h:I,isTorsionFree:A}=e;if(I===Ie)return!0;if(A)return A(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:I,clearCofactor:A}=e;return I===Ie?this:A?A(g,this):this.multiplyUnsafe(e.h)}toRawBytes(I=!0){return Ji("isCompressed",I),this.assertValidity(),s(g,this,I)}toHex(I=!0){return Ji("isCompressed",I),Xi(this.toRawBytes(I))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:E}=e,S=lw(g,m?Math.ceil(E/2):E);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function gw(t){const e=Hf(t);return mn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function yw(t){const e=gw(t),{Fp:r,n:i,nByteLength:s,nBitLength:n}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return We(y,i)}function l(y){return Jo(y,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=pw({...e,toBytes(y,w,x){const P=w.toAffine(),_=r.toBytes(P.x),$=Gs;return Ji("isCompressed",x),x?$(Uint8Array.from([w.hasEvenY()?2:3]),_):$(Uint8Array.from([4]),_,r.toBytes(P.y))},fromBytes(y){const w=y.length,x=y[0],P=y.subarray(1);if(w===o&&(x===2||x===3)){const _=Mr(P);if(!Wa(_,Ie,r.ORDER))throw new Error("Point is not on curve");const $=f(_);let N;try{N=r.sqrt($)}catch(L){const M=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+M)}const j=(N&Ie)===Ie;return(x&1)===1!==j&&(N=r.neg(N)),{x:_,y:N}}else if(w===a&&x===4){const _=r.fromBytes(P.subarray(0,r.BYTES)),$=r.fromBytes(P.subarray(r.BYTES,2*r.BYTES));return{x:_,y:$}}else{const _=o,$=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+$+", got "+w)}}});function d(y){const w=i>>Ie;return y>w}function g(y){return d(y)?c(-y):y}const m=(y,w,x)=>Mr(y.slice(w,x));class E{constructor(w,x,P){hi("r",w,Ie,i),hi("s",x,Ie,i),this.r=w,this.s=x,P!=null&&(this.recovery=P),Object.freeze(this)}static fromCompact(w){const x=s;return w=ht("compactSignature",w,x*2),new E(m(w,0,x),m(w,x,2*x))}static fromDER(w){const{r:x,s:P}=Zt.toSig(ht("DER",w));return new E(x,P)}assertValidity(){}addRecoveryBit(w){return new E(this.r,this.s,w)}recoverPublicKey(w){const{r:x,s:P,recovery:_}=this,$=C(ht("msgHash",w));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const N=_===2||_===3?x+e.n:x;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=(_&1)===0?"02":"03",V=u.fromHex(j+Qn(N,r.BYTES)),L=l(N),M=c(-$*L),K=c(P*L),G=u.BASE.multiplyAndAddUnsafe(V,M,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new E(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ws(this.toDERHex())}toDERHex(){return Zt.hexFromSig(this)}toCompactRawBytes(){return Ws(this.toCompactHex())}toCompactHex(){const w=s;return Qn(this.r,w)+Qn(this.s,w)}}const S={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const y=qf(e.n);return ow(e.randomBytes(y),e.n)},precompute(y=8,w=u.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}};function b(y,w=!0){return u.fromPrivateKey(y).toRawBytes(w)}function I(y){if(typeof y=="bigint")return!1;if(y instanceof u)return!0;const x=ht("key",y).length,P=r.BYTES,_=P+1,$=2*P+1;if(!(e.allowedPrivateKeyLengths||s===_))return x===_||x===$}function A(y,w,x=!0){if(I(y)===!0)throw new Error("first arg must be private key");if(I(w)===!1)throw new Error("second arg must be public key");return u.fromHex(w).multiply(h(y)).toRawBytes(x)}const v=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const w=Mr(y),x=y.length*8-n;return x>0?w>>BigInt(x):w},C=e.bits2int_modN||function(y){return c(v(y))},R=wn(n);function B(y){return hi("num < 2^"+n,y,Xt,R),ns(y,s)}function k(y,w,x=U){if(["recovered","canonical"].some(W=>W in x))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:_}=e;let{lowS:$,prehash:N,extraEntropy:j}=x;$==null&&($=!0),y=ht("msgHash",y),fl(x),N&&(y=ht("prehashed msgHash",P(y)));const V=C(y),L=h(w),M=[B(L),B(V)];if(j!=null&&j!==!1){const W=j===!0?_(r.BYTES):j;M.push(ht("extraEntropy",W))}const K=Gs(...M),G=V;function Z(W){const J=v(W);if(!p(J))return;const ue=l(J),ye=u.BASE.multiply(J).toAffine(),ve=c(ye.x);if(ve===Xt)return;const je=c(ue*c(G+ve*L));if(je===Xt)return;let St=(ye.x===ve?0:2)|Number(ye.y&Ie),ms=je;return $&&d(je)&&(ms=g(je),St^=1),new E(ve,ms,St)}return{seed:K,k2sig:Z}}const U={lowS:e.lowS,prehash:!1},T={lowS:e.lowS,prehash:!1};function O(y,w,x=U){const{seed:P,k2sig:_}=k(y,w,x),$=e;return p0($.hash.outputLen,$.nByteLength,$.hmac)(P,_)}u.BASE._setWindowSize(8);function D(y,w,x,P=T){const _=y;w=ht("msgHash",w),x=ht("publicKey",x);const{lowS:$,prehash:N,format:j}=P;if(fl(P),"strict"in P)throw new Error("options.strict was renamed to lowS");if(j!==void 0&&j!=="compact"&&j!=="der")throw new Error("format must be compact or der");const V=typeof _=="string"||ss(_),L=!V&&!j&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!V&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,K;try{if(L&&(M=new E(_.r,_.s)),V){try{j!=="compact"&&(M=E.fromDER(_))}catch(St){if(!(St instanceof Zt.Err))throw St}!M&&j!=="der"&&(M=E.fromCompact(_))}K=u.fromHex(x)}catch{return!1}if(!M||$&&M.hasHighS())return!1;N&&(w=e.hash(w));const{r:G,s:Z}=M,W=C(w),J=l(Z),ue=c(W*J),ye=c(G*J),ve=u.BASE.multiplyAndAddUnsafe(K,ue,ye)?.toAffine();return ve?c(ve.x)===G:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:A,sign:O,verify:D,ProjectivePoint:u,Signature:E,utils:S}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ww(t){return{hash:t,hmac:(e,...r)=>Rf(t,e,My(...r)),randomBytes:qy}}function mw(t,e){const r=i=>yw({...t,...ww(i)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),dl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),bw=BigInt(0),vw=BigInt(1),Qo=BigInt(2),pl=(t,e)=>(t+e/Qo)/e;function Ew(t){const e=Kf,r=BigInt(3),i=BigInt(6),s=BigInt(11),n=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=ot(u,r,e)*u%e,f=ot(h,r,e)*u%e,p=ot(f,Qo,e)*l%e,d=ot(p,s,e)*p%e,g=ot(d,n,e)*d%e,m=ot(g,a,e)*g%e,E=ot(m,c,e)*m%e,S=ot(E,a,e)*g%e,b=ot(S,r,e)*u%e,I=ot(b,o,e)*d%e,A=ot(I,i,e)*l%e,v=ot(A,Qo,e);if(!ea.eql(ea.sqr(v),t))throw new Error("Cannot find square root");return v}const ea=Za(Kf,void 0,void 0,{sqrt:Ew}),Wf=mw({a:bw,b:BigInt(7),Fp:ea,n:dl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=dl,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-vw*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=r,o=BigInt("0x100000000000000000000000000000000"),a=pl(n*t,e),c=pl(-i*t,e);let l=We(t-a*r-c*s,e),u=We(-a*i-c*n,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},h0),z6=Object.freeze(Object.defineProperty({__proto__:null,secp256k1:Wf},Symbol.toStringTag,{value:"Module"}));function xw(t){if(t.length!==130&&t.length!==132)throw new _w({signature:t});const e=BigInt(Yt(t,0,32)),r=BigInt(Yt(t,32,64)),i=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return Iw(s)}catch{throw new Sw({value:s})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function Iw(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new $w({value:t})}class _w extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Ir(Ya(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class Sw extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class $w extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Dw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Gf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Zs(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Ja(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function ta(t){if(!Array.isArray(t))throw new Error("array expected")}function Js(t,e){if(!Gf(!0,e))throw new Error(`${t}: array of strings expected`)}function Ow(t,e){if(!Gf(!1,e))throw new Error(`${t}: array of numbers expected`)}function Aw(...t){const e=n=>n,r=(n,o)=>a=>n(o(a)),i=t.map(n=>n.encode).reduceRight(r,e),s=t.map(n=>n.decode).reduce(r,e);return{encode:i,decode:s}}function Pw(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Js("alphabet",e);const i=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(ta(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${t}`);return e[n]})),decode:s=>(ta(s),s.map(n=>{Zs("alphabet.decode",n);const o=i.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return o}))}}function Bw(t=""){return Zs("join",t),{encode:e=>(Js("join.decode",e),e.join(t)),decode:e=>(Zs("join.decode",e),e.split(t))}}function Cw(t,e="="){return Ja(t),Zs("padding",e),{encode(r){for(Js("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Js("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}const Yf=(t,e)=>e===0?t:Yf(e,t%e),Xs=(t,e)=>t+(e-Yf(t,e)),to=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function gl(t,e,r,i){if(ta(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Xs(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Xs(e,r)}`);let s=0,n=0;const o=to[e],a=to[r]-1,c=[];for(const l of t){if(Ja(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=r;n-=r)c.push((s>>n-r&a)>>>0);const u=to[n];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<r-n&a,!i&&n>=e)throw new Error("Excess padding");if(!i&&s>0)throw new Error(`Non-zero padding: ${s}`);return i&&n>0&&c.push(s>>>0),c}function Tw(t,e=!1){if(Ja(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Xs(8,t)>32||Xs(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Dw(r))throw new Error("radix2.encode input should be Uint8Array");return gl(Array.from(r),8,t,!e)},decode:r=>(Ow("radix2.decode",r),Uint8Array.from(gl(r,t,8,e)))}}const Rw=Aw(Tw(5),Pw("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Cw(5),Bw(""));function Uw(t){return Z0(Nw(t))}function Nw(t){const{payload:e,signature:r}=t,{r:i,s,yParity:n}=r,a=new Wf.Signature(BigInt(i),BigInt(s)).addRecoveryBit(n).recoverPublicKey(Ya(e).substring(2));return M0(a)}function kw(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,i=t.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const p=l.length;for(;f!==p&&l[f]===0;)f++,u++;const d=(p-f)*n+1>>>0,g=new Uint8Array(d);for(;f!==p;){let S=l[f],b=0;for(let I=d-1;(S!==0||b<h)&&I!==-1;I--,b++)S+=256*g[I]>>>0,g[I]=S%r>>>0,S=S/r>>>0;if(S!==0)throw new Error("Non-zero carry");h=b,f++}let m=d-h;for(;m!==d&&g[m]===0;)m++;let E=i.repeat(u);for(;m<d;++m)E+=t.charAt(g[m]);return E}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===i;)h++,u++;const p=(l.length-u)*s+1>>>0,d=new Uint8Array(p);for(;u<l.length;){const S=l.charCodeAt(u);if(S>255)return;let b=e[S];if(b===255)return;let I=0;for(let A=p-1;(b!==0||I<f)&&A!==-1;A--,I++)b+=r*d[A]>>>0,d[A]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=I,u++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const m=new Uint8Array(h+(p-g));let E=h;for(;g!==p;)m[E++]=d[g++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var jw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const os=kw(jw);function Fw(t){const e=t.length;let r=0,i=0;for(;i<e;){let s=t.charCodeAt(i++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&i<e){const n=t.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function Lw(t,e,r){const i=t.length;let s=r,n=0;for(;n<i;){let o=t.charCodeAt(n++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const Mw=new TextEncoder,qw=50;function zw(t,e,r){Mw.encodeInto(t,e.subarray(r))}function Vw(t,e,r){t.length>qw?zw(t,e,r):Lw(t,e,r)}const Hw=4096;function Zf(t,e,r){let i=e;const s=i+r,n=[];let o="";for(;i<s;){const a=t[i++];if((a&128)===0)n.push(a);else if((a&224)===192){const c=t[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;n.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|h&1023),n.push(h)}else n.push(a);n.length>=Hw&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const Kw=new TextDecoder,Ww=200;function Gw(t,e,r){const i=t.subarray(e,e+r);return Kw.decode(i)}function Yw(t,e,r){return r>Ww?Gw(t,e,r):Zf(t,e,r)}class xs{constructor(e,r){this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const Di=4294967295;function Zw(t,e,r){const i=r/4294967296,s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function Jf(t,e,r){const i=Math.floor(r/4294967296),s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function Xf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function Jw(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const Xw=-1,Qw=4294967296-1,em=17179869184-1;function tm({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=em)if(e===0&&t<=Qw){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|r&3),n.setUint32(4,i),s}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),Jf(i,4,t),r}}function rm(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,s=Math.floor(i/1e9);return{sec:r+s,nsec:i-s*1e9}}function im(t){if(t instanceof Date){const e=rm(t);return tm(e)}else return null}function sm(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),s=(r&3)*4294967296+i,n=r>>>2;return{sec:s,nsec:n}}case 12:{const r=Xf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function nm(t){const e=sm(t);return new Date(e.sec*1e3+e.nsec/1e6)}const om={type:Xw,encode:im,decode:nm};class Qs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(om)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=-1-i;return new xs(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=i;return new xs(o,n)}}}return e instanceof xs?e:null}decode(e,r,i){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new xs(r,e)}}Qs.defaultCodec=new Qs;function am(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ra(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):am(t)?new Uint8Array(t):Uint8Array.from(t)}const cm=100,lm=2048;let um=class Qf{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Qs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??cm,this.initialBufferSize=e?.initialBufferSize??lm,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Qf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),s=new DataView(r);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=Fw(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),Vw(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=ra(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let i=0;for(const s of r)e[s]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Zw(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Jf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function hm(t,e){return new um(e).encodeSharedRef(t)}function ro(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const fm=16,dm=16;class pm{constructor(e=fm,r=dm){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return n.str}return null}store(e,r){const i=this.caches[e.length-1],s={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,r,i){const s=this.find(e,r,i);if(s!=null)return this.hit++,s;this.miss++;const n=Zf(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,n),n}}const ia="array",zi="map_key",ed="map_value",gm=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class ym{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=ia,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=zi,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ia){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===zi||e.type===ed){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Oi=-1,Xa=new DataView(new ArrayBuffer(0)),wm=new Uint8Array(Xa.buffer);try{Xa.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const yl=new RangeError("Insufficient data"),mm=new pm;let bm=class td{constructor(e){this.totalPos=0,this.pos=0,this.view=Xa,this.bytes=wm,this.headByte=Oi,this.stack=new ym,this.entered=!1,this.extensionCodec=e?.extensionCodec??Qs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Di,this.maxBinLength=e?.maxBinLength??Di,this.maxArrayLength=e?.maxArrayLength??Di,this.maxMapLength=e?.maxMapLength??Di,this.maxExtLength=e?.maxExtLength??Di,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:mm,this.mapKeyConverter=e?.mapKeyConverter??gm}clone(){return new td({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Oi,this.stack.reset()}setBuffer(e){const r=ra(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Oi&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=ra(e),s=new Uint8Array(r.length+i.length);s.set(r),s.set(i,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${ro(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,s=-1;for await(const n of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new it(`Unrecognized type byte: ${ro(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===ia)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,i.release(s);else continue e;else if(s.type===zi){if(r==="__proto__")throw new it("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=ed;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,i.release(s);else{s.key=null,s.type=zi;continue e}}return r}}readHeadByte(){return this.headByte===Oi&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Oi}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${ro(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw yl;const i=this.pos+r;let s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,i,e):s=Yw(this.bytes,i,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===zi:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw yl;const i=this.pos+r,s=this.bytes.subarray(i,i+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Jw(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Xf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function vm(t,e){return new bm(e).decode(t)}const Em=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),xm=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function zr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return xm(t)}catch{return t}}function ir(t){return typeof t=="string"?t:Em(t)||""}function Im(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rd(t,...e){if(!Im(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function wl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function _m(t,e){rd(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Qr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const io=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Sm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function id(t){return typeof t=="string"&&(t=Sm(t)),rd(t),t}let $m=class{clone(){return this._cloneInto()}};function Dm(t){const e=i=>t().update(id(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function sd(t=32){if(Qr&&typeof Qr.getRandomValues=="function")return Qr.getRandomValues(new Uint8Array(t));if(Qr&&typeof Qr.randomBytes=="function")return Qr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Om(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let Am=class extends $m{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=io(this.buffer)}update(e){wl(this);const{view:r,buffer:i,blockLen:s}=this;e=id(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=io(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wl(this),_m(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;Om(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=io(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const Is=BigInt(2**32-1),sa=BigInt(32);function nd(t,e=!1){return e?{h:Number(t&Is),l:Number(t>>sa&Is)}:{h:Number(t>>sa&Is)|0,l:Number(t&Is)|0}}function Pm(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=nd(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Bm=(t,e)=>BigInt(t>>>0)<<sa|BigInt(e>>>0),Cm=(t,e,r)=>t>>>r,Tm=(t,e,r)=>t<<32-r|e>>>r,Rm=(t,e,r)=>t>>>r|e<<32-r,Um=(t,e,r)=>t<<32-r|e>>>r,Nm=(t,e,r)=>t<<64-r|e>>>r-32,km=(t,e,r)=>t>>>r-32|e<<64-r,jm=(t,e)=>e,Fm=(t,e)=>t,Lm=(t,e,r)=>t<<r|e>>>32-r,Mm=(t,e,r)=>e<<r|t>>>32-r,qm=(t,e,r)=>e<<r-32|t>>>64-r,zm=(t,e,r)=>t<<r-32|e>>>64-r;function Vm(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Hm=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Km=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Wm=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Gm=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Ym=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Zm=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Y={fromBig:nd,split:Pm,toBig:Bm,shrSH:Cm,shrSL:Tm,rotrSH:Rm,rotrSL:Um,rotrBH:Nm,rotrBL:km,rotr32H:jm,rotr32L:Fm,rotlSH:Lm,rotlSL:Mm,rotlBH:qm,rotlBL:zm,add:Vm,add3L:Hm,add3H:Km,add4L:Wm,add4H:Gm,add5H:Zm,add5L:Ym},[Jm,Xm]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ar=new Uint32Array(80),cr=new Uint32Array(80);let Qm=class extends Am{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)ar[b]=e.getUint32(r),cr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const I=ar[b-15]|0,A=cr[b-15]|0,v=Y.rotrSH(I,A,1)^Y.rotrSH(I,A,8)^Y.shrSH(I,A,7),C=Y.rotrSL(I,A,1)^Y.rotrSL(I,A,8)^Y.shrSL(I,A,7),R=ar[b-2]|0,B=cr[b-2]|0,k=Y.rotrSH(R,B,19)^Y.rotrBH(R,B,61)^Y.shrSH(R,B,6),U=Y.rotrSL(R,B,19)^Y.rotrBL(R,B,61)^Y.shrSL(R,B,6),T=Y.add4L(C,U,cr[b-7],cr[b-16]),O=Y.add4H(T,v,k,ar[b-7],ar[b-16]);ar[b]=O|0,cr[b]=T|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:m,Hh:E,Hl:S}=this;for(let b=0;b<80;b++){const I=Y.rotrSH(h,f,14)^Y.rotrSH(h,f,18)^Y.rotrBH(h,f,41),A=Y.rotrSL(h,f,14)^Y.rotrSL(h,f,18)^Y.rotrBL(h,f,41),v=h&p^~h&g,C=f&d^~f&m,R=Y.add5L(S,A,C,Xm[b],cr[b]),B=Y.add5H(R,E,I,v,Jm[b],ar[b]),k=R|0,U=Y.rotrSH(i,s,28)^Y.rotrBH(i,s,34)^Y.rotrBH(i,s,39),T=Y.rotrSL(i,s,28)^Y.rotrBL(i,s,34)^Y.rotrBL(i,s,39),O=i&n^i&a^n&a,D=s&o^s&c^o&c;E=g|0,S=m|0,g=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=Y.add(l|0,u|0,B|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=Y.add3L(k,T,D);i=Y.add3H(y,B,U,O),s=y|0}({h:i,l:s}=Y.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Y.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Y.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Y.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Y.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=Y.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:E,l:S}=Y.add(this.Hh|0,this.Hl|0,E|0,S|0),this.set(i,s,n,o,a,c,l,u,h,f,p,d,g,m,E,S)}roundClean(){ar.fill(0),cr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const eb=Dm(()=>new Qm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qa=BigInt(0),od=BigInt(1),tb=BigInt(2);function ec(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tc(t){if(!ec(t))throw new Error("Uint8Array expected")}function so(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const rb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function rc(t){tc(t);let e="";for(let r=0;r<t.length;r++)e+=rb[t[r]];return e}function ad(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Qa:BigInt("0x"+t)}const qt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ml(t){if(t>=qt._0&&t<=qt._9)return t-qt._0;if(t>=qt.A&&t<=qt.F)return t-(qt.A-10);if(t>=qt.a&&t<=qt.f)return t-(qt.a-10)}function cd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=ml(t.charCodeAt(n)),a=ml(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function ib(t){return ad(rc(t))}function Ls(t){return tc(t),ad(rc(Uint8Array.from(t).reverse()))}function ld(t,e){return cd(t.toString(16).padStart(e*2,"0"))}function na(t,e){return ld(t,e).reverse()}function zt(t,e,r){let i;if(typeof e=="string")try{i=cd(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(ec(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function bl(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];tc(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const no=t=>typeof t=="bigint"&&Qa<=t;function sb(t,e,r){return no(t)&&no(e)&&no(r)&&e<=t&&t<r}function Ai(t,e,r,i){if(!sb(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function nb(t){let e;for(e=0;t>Qa;t>>=od,e+=1);return e}const ob=t=>(tb<<BigInt(t-1))-od,ab={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ec(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ic(t,e,r={}){const i=(s,n,o)=>{const a=ab[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function vl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const _e=BigInt(0),fe=BigInt(1),Tr=BigInt(2),cb=BigInt(3),oa=BigInt(4),El=BigInt(5),xl=BigInt(8);function me(t,e){const r=t%e;return r>=_e?r:e+r}function lb(t,e,r){if(e<_e)throw new Error("invalid exponent, negatives unsupported");if(r<=_e)throw new Error("invalid modulus");if(r===fe)return _e;let i=fe;for(;e>_e;)e&fe&&(i=i*t%r),t=t*t%r,e>>=fe;return i}function Dt(t,e,r){let i=t;for(;e-- >_e;)i*=i,i%=r;return i}function Il(t,e){if(t===_e)throw new Error("invert: expected non-zero number");if(e<=_e)throw new Error("invert: expected positive modulus, got "+e);let r=me(t,e),i=e,s=_e,n=fe;for(;r!==_e;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==fe)throw new Error("invert: does not exist");return me(s,e)}function ub(t){const e=(t-fe)/Tr;let r,i,s;for(r=t-fe,i=0;r%Tr===_e;r/=Tr,i++);for(s=Tr;s<t&&lb(s,e,t)!==t-fe;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+fe)/oa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+fe)/Tr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(l,fe<<BigInt(c-f-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=f}return u}}function hb(t){if(t%oa===cb){const e=(t+fe)/oa;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%xl===El){const e=(t-El)/xl;return function(r,i){const s=r.mul(i,Tr),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,Tr),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return ub(t)}const fb=(t,e)=>(me(t,e)&fe)===fe,db=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pb(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=db.reduce((i,s)=>(i[s]="function",i),e);return ic(t,r)}function gb(t,e,r){if(r<_e)throw new Error("invalid exponent, negatives unsupported");if(r===_e)return t.ONE;if(r===fe)return e;let i=t.ONE,s=e;for(;r>_e;)r&fe&&(i=t.mul(i,s)),s=t.sqr(s),r>>=fe;return i}function yb(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function ud(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function hd(t,e,r=!1,i={}){if(t<=_e)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=ud(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:ob(s),ZERO:_e,ONE:fe,create:c=>me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return _e<=c&&c<t},is0:c=>c===_e,isOdd:c=>(c&fe)===fe,neg:c=>me(-c,t),eql:(c,l)=>c===l,sqr:c=>me(c*c,t),add:(c,l)=>me(c+l,t),sub:(c,l)=>me(c-l,t),mul:(c,l)=>me(c*l,t),pow:(c,l)=>gb(a,c,l),div:(c,l)=>me(c*Il(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Il(c,t),sqrt:i.sqrt||(c=>(o||(o=hb(t)),o(a,c))),invertBatch:c=>yb(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?na(c,n):ld(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Ls(c):ib(c)}});return Object.freeze(a)}const _l=BigInt(0),_s=BigInt(1);function oo(t,e){const r=e.negate();return t?r:e}function fd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ao(t,e){fd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function wb(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function mb(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const co=new WeakMap,dd=new WeakMap;function lo(t){return dd.get(t)||1}function bb(t,e){return{constTimeNegate:oo,hasPrecomputes(r){return lo(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>_l;)i&_s&&(s=s.add(n)),n=n.double(),i>>=_s;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=ao(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=ao(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<n;f++){const p=f*o;let d=Number(s&l);s>>=h,d>o&&(d-=u,s+=_s);const g=p,m=p+Math.abs(d)-1,E=f%2!==0,S=d<0;d===0?c=c.add(oo(E,i[g])):a=a.add(oo(S,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=ao(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(s===_l)break;let p=Number(s&c);if(s>>=u,p>a&&(p-=l,s+=_s),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(r,i,s){let n=co.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&co.set(i,s(n))),n},wNAFCached(r,i,s){const n=lo(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=lo(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){fd(i,e),dd.set(r,i),co.delete(r)}}}function vb(t,e,r,i){if(wb(r,t),mb(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=nb(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let p=0;p<i.length;p++){const d=i[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[p])}let f=s;for(let p=c.length-1,d=s;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function Eb(t){return pb(t.Fp),ic(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ud(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const mt=BigInt(0),ze=BigInt(1),Ss=BigInt(2),xb=BigInt(8),Ib={zip215:!0};function _b(t){const e=Eb(t);return ic(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Sb(t){const e=_b(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=Ss<<BigInt(a*8)-ze,u=r.create,h=hd(e.n,e.nBitLength),f=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(w))}}catch{return{isValid:!1,value:mt}}}),p=e.adjustScalarBytes||(y=>y),d=e.domain||((y,w,x)=>{if(so("phflag",x),w.length||x)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,w){Ai("coordinate "+y,w,mt,l)}function m(y){if(!(y instanceof b))throw new Error("ExtendedPoint expected")}const E=vl((y,w)=>{const{ex:x,ey:P,ez:_}=y,$=y.is0();w==null&&(w=$?xb:r.inv(_));const N=u(x*w),j=u(P*w),V=u(_*w);if($)return{x:mt,y:ze};if(V!==ze)throw new Error("invZ was invalid");return{x:N,y:j}}),S=vl(y=>{const{a:w,d:x}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:P,ey:_,ez:$,et:N}=y,j=u(P*P),V=u(_*_),L=u($*$),M=u(L*L),K=u(j*w),G=u(L*u(K+V)),Z=u(M+u(x*u(j*V)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const W=u(P*_),J=u($*N);if(W!==J)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(w,x,P,_){this.ex=w,this.ey=x,this.ez=P,this.et=_,g("x",w),g("y",x),g("z",P),g("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof b)throw new Error("extended point not allowed");const{x,y:P}=w||{};return g("x",x),g("y",P),new b(x,P,ze,u(x*P))}static normalizeZ(w){const x=r.invertBatch(w.map(P=>P.ez));return w.map((P,_)=>P.toAffine(x[_])).map(b.fromAffine)}static msm(w,x){return vb(b,h,w,x)}_setWindowSize(w){v.setWindowSize(this,w)}assertValidity(){S(this)}equals(w){m(w);const{ex:x,ey:P,ez:_}=this,{ex:$,ey:N,ez:j}=w,V=u(x*j),L=u($*_),M=u(P*j),K=u(N*_);return V===L&&M===K}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:w}=e,{ex:x,ey:P,ez:_}=this,$=u(x*x),N=u(P*P),j=u(Ss*u(_*_)),V=u(w*$),L=x+P,M=u(u(L*L)-$-N),K=V+N,G=K-j,Z=V-N,W=u(M*G),J=u(K*Z),ue=u(M*Z),ye=u(G*K);return new b(W,J,ye,ue)}add(w){m(w);const{a:x,d:P}=e,{ex:_,ey:$,ez:N,et:j}=this,{ex:V,ey:L,ez:M,et:K}=w;if(x===BigInt(-1)){const Oc=u(($-_)*(L+V)),Ac=u(($+_)*(L-V)),jn=u(Ac-Oc);if(jn===mt)return this.double();const Pc=u(N*Ss*K),Bc=u(j*Ss*M),Cc=Bc+Pc,Tc=Ac+Oc,Rc=Bc-Pc,Ug=u(Cc*jn),Ng=u(Tc*Rc),kg=u(Cc*Rc),jg=u(jn*Tc);return new b(Ug,Ng,jg,kg)}const G=u(_*V),Z=u($*L),W=u(j*P*K),J=u(N*M),ue=u((_+$)*(V+L)-G-Z),ye=J-W,ve=J+W,je=u(Z-x*G),St=u(ue*ye),ms=u(ve*je),Tg=u(ue*je),Rg=u(ye*ve);return new b(St,ms,Rg,Tg)}subtract(w){return this.add(w.negate())}wNAF(w){return v.wNAFCached(this,w,b.normalizeZ)}multiply(w){const x=w;Ai("scalar",x,ze,i);const{p:P,f:_}=this.wNAF(x);return b.normalizeZ([P,_])[0]}multiplyUnsafe(w,x=b.ZERO){const P=w;return Ai("scalar",P,mt,i),P===mt?A:this.is0()||P===ze?this:v.wNAFCachedUnsafe(this,P,b.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return v.unsafeLadder(this,i).is0()}toAffine(w){return E(this,w)}clearCofactor(){const{h:w}=e;return w===ze?this:this.multiplyUnsafe(w)}static fromHex(w,x=!1){const{d:P,a:_}=e,$=r.BYTES;w=zt("pointHex",w,$),so("zip215",x);const N=w.slice(),j=w[$-1];N[$-1]=j&-129;const V=Ls(N),L=x?l:r.ORDER;Ai("pointHex.y",V,mt,L);const M=u(V*V),K=u(M-ze),G=u(P*M-_);let{isValid:Z,value:W}=f(K,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const J=(W&ze)===ze,ue=(j&128)!==0;if(!x&&W===mt&&ue)throw new Error("Point.fromHex: x=0 and x_0=1");return ue!==J&&(W=u(-W)),b.fromAffine({x:W,y:V})}static fromPrivateKey(w){return B(w).point}toRawBytes(){const{x:w,y:x}=this.toAffine(),P=na(x,r.BYTES);return P[P.length-1]|=w&ze?128:0,P}toHex(){return rc(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,ze,u(e.Gx*e.Gy)),b.ZERO=new b(mt,ze,ze,mt);const{BASE:I,ZERO:A}=b,v=bb(b,a*8);function C(y){return me(y,i)}function R(y){return C(Ls(y))}function B(y){const w=r.BYTES;y=zt("private key",y,w);const x=zt("hashed private key",n(y),2*w),P=p(x.slice(0,w)),_=x.slice(w,2*w),$=R(P),N=I.multiply($),j=N.toRawBytes();return{head:P,prefix:_,scalar:$,point:N,pointBytes:j}}function k(y){return B(y).pointBytes}function U(y=new Uint8Array,...w){const x=bl(...w);return R(n(d(x,zt("context",y),!!s)))}function T(y,w,x={}){y=zt("message",y),s&&(y=s(y));const{prefix:P,scalar:_,pointBytes:$}=B(w),N=U(x.context,P,y),j=I.multiply(N).toRawBytes(),V=U(x.context,j,$,y),L=C(N+V*_);Ai("signature.s",L,mt,i);const M=bl(j,na(L,r.BYTES));return zt("result",M,r.BYTES*2)}const O=Ib;function D(y,w,x,P=O){const{context:_,zip215:$}=P,N=r.BYTES;y=zt("signature",y,2*N),w=zt("message",w),x=zt("publicKey",x,N),$!==void 0&&so("zip215",$),s&&(w=s(w));const j=Ls(y.slice(N,2*N));let V,L,M;try{V=b.fromHex(x,$),L=b.fromHex(y.slice(0,N),$),M=I.multiplyUnsafe(j)}catch{return!1}if(!$&&V.isSmallOrder())return!1;const K=U(_,L.toRawBytes(),V.toRawBytes(),w);return L.add(V.multiplyUnsafe(K)).subtract(M).clearCofactor().equals(b.ZERO)}return I._setWindowSize(8),{CURVE:e,getPublicKey:k,sign:T,verify:D,ExtendedPoint:b,utils:{getExtendedPublicKey:B,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,w=b.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const sc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Sl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const $b=BigInt(1),$l=BigInt(2);BigInt(3);const Db=BigInt(5),Ob=BigInt(8);function Ab(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=sc,o=t*t%n*t%n,a=Dt(o,$l,n)*o%n,c=Dt(a,$b,n)*t%n,l=Dt(c,Db,n)*c%n,u=Dt(l,e,n)*l%n,h=Dt(u,r,n)*u%n,f=Dt(h,i,n)*h%n,p=Dt(f,s,n)*f%n,d=Dt(p,s,n)*f%n,g=Dt(d,e,n)*l%n;return{pow_p_5_8:Dt(g,$l,n)*t%n,b2:o}}function Pb(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Bb(t,e){const r=sc,i=me(e*e*e,r),s=me(i*i*e,r),n=Ab(t*s).pow_p_5_8;let o=me(t*i*n,r);const a=me(e*o*o,r),c=o,l=me(o*Sl,r),u=a===t,h=a===me(-t,r),f=a===me(-t*Sl,r);return u&&(o=c),(h||f)&&(o=l),fb(o,r)&&(o=me(-o,r)),{isValid:u||h,value:o}}const Cb=hd(sc,void 0,!0),Tb={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Cb,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Ob,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:eb,randomBytes:sd,adjustScalarBytes:Pb,uvRatio:Bb},pd=Sb(Tb),Rb="EdDSA",Ub="JWT",en=".",bn="base64url",gd="utf8",yd="utf8",Nb=":",kb="did",jb="key",Dl="base58btc",Fb="z",Lb="K36",Mb=32;function nc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function wd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?nc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function md(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=wd(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return nc(r)}function qb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,I=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*I[C]>>>0,I[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&I[R]===0;)R++;for(var B=c.repeat(g);R<b;++R)B+=t.charAt(I[R]);return B}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var I=r[d.charCodeAt(g)];if(I===255)return;for(var A=0,v=S-1;(I!==0||A<E)&&v!==-1;v--,A++)I+=a*b[v]>>>0,b[v]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),B=m;C!==S;)R[B++]=b[C++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var zb=qb,Vb=zb;const bd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Hb=t=>new TextEncoder().encode(t),Kb=t=>new TextDecoder().decode(t);let Wb=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Gb=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vd(this,e)}},Yb=class{constructor(e){this.decoders=e}or(e){return vd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const vd=(t,e)=>new Yb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Zb=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Wb(e,r,i),this.decoder=new Gb(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const vn=({name:t,prefix:e,encode:r,decode:i})=>new Zb(t,e,r,i),as=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Vb(r,e);return vn({prefix:t,name:e,encode:i,decode:n=>bd(s(n))})},Jb=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Xb=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ae=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>vn({prefix:e,name:t,encode(s){return Xb(s,i,r)},decode(s){return Jb(s,i,r,t)}}),Qb=vn({prefix:"\0",name:"identity",encode:t=>Kb(t),decode:t=>Hb(t)});var e1=Object.freeze({__proto__:null,identity:Qb});const t1=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var r1=Object.freeze({__proto__:null,base2:t1});const i1=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var s1=Object.freeze({__proto__:null,base8:i1});const n1=as({prefix:"9",name:"base10",alphabet:"0123456789"});var o1=Object.freeze({__proto__:null,base10:n1});const a1=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),c1=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var l1=Object.freeze({__proto__:null,base16:a1,base16upper:c1});const u1=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),h1=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),f1=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),d1=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p1=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g1=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),y1=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w1=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),m1=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var b1=Object.freeze({__proto__:null,base32:u1,base32upper:h1,base32pad:f1,base32padupper:d1,base32hex:p1,base32hexupper:g1,base32hexpad:y1,base32hexpadupper:w1,base32z:m1});const v1=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),E1=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var x1=Object.freeze({__proto__:null,base36:v1,base36upper:E1});const I1=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_1=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var S1=Object.freeze({__proto__:null,base58btc:I1,base58flickr:_1});const $1=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),D1=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),O1=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),A1=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var P1=Object.freeze({__proto__:null,base64:$1,base64pad:D1,base64url:O1,base64urlpad:A1});const Ed=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),B1=Ed.reduce((t,e,r)=>(t[r]=e,t),[]),C1=Ed.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function T1(t){return t.reduce((e,r)=>(e+=B1[r],e),"")}function R1(t){const e=[];for(const r of t){const i=C1[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const U1=vn({prefix:"🚀",name:"base256emoji",encode:T1,decode:R1});var N1=Object.freeze({__proto__:null,base256emoji:U1}),k1=xd,Ol=128,j1=-128,F1=Math.pow(2,31);function xd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=F1;)e[r++]=t&255|Ol,t/=128;for(;t&j1;)e[r++]=t&255|Ol,t>>>=7;return e[r]=t|0,xd.bytes=r-i+1,e}var L1=aa,M1=128,Al=127;function aa(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw aa.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Al)<<s:(o&Al)*Math.pow(2,s),s+=7}while(o>=M1);return aa.bytes=n-i,r}var q1=Math.pow(2,7),z1=Math.pow(2,14),V1=Math.pow(2,21),H1=Math.pow(2,28),K1=Math.pow(2,35),W1=Math.pow(2,42),G1=Math.pow(2,49),Y1=Math.pow(2,56),Z1=Math.pow(2,63),J1=function(t){return t<q1?1:t<z1?2:t<V1?3:t<H1?4:t<K1?5:t<W1?6:t<G1?7:t<Y1?8:t<Z1?9:10},X1={encode:k1,decode:L1,encodingLength:J1},Id=X1;const Pl=(t,e,r=0)=>(Id.encode(t,e,r),e),Bl=t=>Id.encodingLength(t),ca=(t,e)=>{const r=e.byteLength,i=Bl(t),s=i+Bl(r),n=new Uint8Array(s+r);return Pl(t,n,0),Pl(r,n,i),n.set(e,s),new Q1(t,r,e,n)};let Q1=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const _d=({name:t,code:e,encode:r})=>new ev(t,e,r);let ev=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ca(this.code,r):r.then(i=>ca(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Sd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),tv=_d({name:"sha2-256",code:18,encode:Sd("SHA-256")}),rv=_d({name:"sha2-512",code:19,encode:Sd("SHA-512")});var iv=Object.freeze({__proto__:null,sha256:tv,sha512:rv});const $d=0,sv="identity",Dd=bd,nv=t=>ca($d,Dd(t)),ov={code:$d,name:sv,encode:Dd,digest:nv};var av=Object.freeze({__proto__:null,identity:ov});new TextEncoder,new TextDecoder;const Cl={...e1,...r1,...s1,...o1,...l1,...b1,...x1,...S1,...P1,...N1};({...iv,...av});function Od(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Tl=Od("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),uo=Od("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=wd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ad={utf8:Tl,"utf-8":Tl,hex:Cl.base16,latin1:uo,ascii:uo,binary:uo,...Cl};function En(t,e="utf8"){const r=Ad[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function vi(t,e="utf8"){const r=Ad[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?nc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Rl(t){return zr(En(vi(t,bn),gd))}function tn(t){return En(vi(ir(t),gd),bn)}function Pd(t){const e=vi(Lb,Dl),r=Fb+En(md([e,t]),Dl);return[kb,jb,r].join(Nb)}function cv(t){return En(t,bn)}function lv(t){return vi(t,bn)}function uv(t){return vi([tn(t.header),tn(t.payload)].join(en),yd)}function hv(t){return[tn(t.header),tn(t.payload),cv(t.signature)].join(en)}function la(t){const e=t.split(en),r=Rl(e[0]),i=Rl(e[1]),s=lv(e[2]),n=vi(e.slice(0,2).join(en),yd);return{header:r,payload:i,signature:s,data:n}}function Ul(t=sd(Mb)){const e=pd.getPublicKey(t);return{secretKey:md([t,e]),publicKey:e}}async function fv(t,e,r,i,s=z.fromMiliseconds(Date.now())){const n={alg:Rb,typ:Ub},o=Pd(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=uv({header:n,payload:c}),u=pd.sign(l,i.secretKey.slice(0,32));return hv({header:n,payload:c,signature:u})}function oc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Bd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?oc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Vi(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=Bd(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return oc(r)}function dv(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,I=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*I[C]>>>0,I[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&I[R]===0;)R++;for(var B=c.repeat(g);R<b;++R)B+=t.charAt(I[R]);return B}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var I=r[d.charCodeAt(g)];if(I===255)return;for(var A=0,v=S-1;(I!==0||A<E)&&v!==-1;v--,A++)I+=a*b[v]>>>0,b[v]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),B=m;C!==S;)R[B++]=b[C++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var pv=dv,gv=pv;const yv=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},wv=t=>new TextEncoder().encode(t),mv=t=>new TextDecoder().decode(t);class bv{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class vv{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cd(this,e)}}class Ev{constructor(e){this.decoders=e}or(e){return Cd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Cd=(t,e)=>new Ev({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class xv{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new bv(e,r,i),this.decoder=new vv(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xn=({name:t,prefix:e,encode:r,decode:i})=>new xv(t,e,r,i),cs=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=gv(r,e);return xn({prefix:t,name:e,encode:i,decode:n=>yv(s(n))})},Iv=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},_v=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>xn({prefix:e,name:t,encode(s){return _v(s,i,r)},decode(s){return Iv(s,i,r,t)}}),Sv=xn({prefix:"\0",name:"identity",encode:t=>mv(t),decode:t=>wv(t)}),$v=Object.freeze(Object.defineProperty({__proto__:null,identity:Sv},Symbol.toStringTag,{value:"Module"})),Dv=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ov=Object.freeze(Object.defineProperty({__proto__:null,base2:Dv},Symbol.toStringTag,{value:"Module"})),Av=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Pv=Object.freeze(Object.defineProperty({__proto__:null,base8:Av},Symbol.toStringTag,{value:"Module"})),Bv=cs({prefix:"9",name:"base10",alphabet:"0123456789"}),Cv=Object.freeze(Object.defineProperty({__proto__:null,base10:Bv},Symbol.toStringTag,{value:"Module"})),Tv=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Rv=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Uv=Object.freeze(Object.defineProperty({__proto__:null,base16:Tv,base16upper:Rv},Symbol.toStringTag,{value:"Module"})),Nv=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kv=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jv=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fv=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lv=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Mv=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qv=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zv=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Vv=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Hv=Object.freeze(Object.defineProperty({__proto__:null,base32:Nv,base32hex:Lv,base32hexpad:qv,base32hexpadupper:zv,base32hexupper:Mv,base32pad:jv,base32padupper:Fv,base32upper:kv,base32z:Vv},Symbol.toStringTag,{value:"Module"})),Kv=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wv=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Gv=Object.freeze(Object.defineProperty({__proto__:null,base36:Kv,base36upper:Wv},Symbol.toStringTag,{value:"Module"})),Yv=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Zv=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Jv=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Yv,base58flickr:Zv},Symbol.toStringTag,{value:"Module"})),Xv=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qv=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),e2=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),t2=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),r2=Object.freeze(Object.defineProperty({__proto__:null,base64:Xv,base64pad:Qv,base64url:e2,base64urlpad:t2},Symbol.toStringTag,{value:"Module"})),Td=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),i2=Td.reduce((t,e,r)=>(t[r]=e,t),[]),s2=Td.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function n2(t){return t.reduce((e,r)=>(e+=i2[r],e),"")}function o2(t){const e=[];for(const r of t){const i=s2[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const a2=xn({prefix:"🚀",name:"base256emoji",encode:n2,decode:o2}),c2=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:a2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Nl={...$v,...Ov,...Pv,...Cv,...Uv,...Hv,...Gv,...Jv,...r2,...c2};function Rd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const kl=Rd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ho=Rd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Bd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ud={utf8:kl,"utf-8":kl,hex:Nl.base16,latin1:ho,ascii:ho,binary:ho,...Nl};function pt(t,e="utf8"){const r=Ud[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?oc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Xe(t,e="utf8"){const r=Ud[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const l2={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var fo,jl;function Nd(){if(jl)return fo;jl=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=i(a[u]).toUpperCase(),l+=" ",l+=i(a[u+1]).toUpperCase();else if(c===64)l+=i(a[u+1]).toUpperCase(),l+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function n(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),g=d-l;l=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return fo={normalizeInput:e,toHex:r,debugPrint:s,testSpeed:n},fo}var po,Fl;function u2(){if(Fl)return po;Fl=1;const t=Nd();function e(E,S,b){const I=E[S]+E[b];let A=E[S+1]+E[b+1];I>=4294967296&&A++,E[S]=I,E[S+1]=A}function r(E,S,b,I){let A=E[S]+b;b<0&&(A+=4294967296);let v=E[S+1]+I;A>=4294967296&&v++,E[S]=A,E[S+1]=v}function i(E,S){return E[S]^E[S+1]<<8^E[S+2]<<16^E[S+3]<<24}function s(E,S,b,I,A,v){const C=l[A],R=l[A+1],B=l[v],k=l[v+1];e(c,E,S),r(c,E,C,R);let U=c[I]^c[E],T=c[I+1]^c[E+1];c[I]=T,c[I+1]=U,e(c,b,I),U=c[S]^c[b],T=c[S+1]^c[b+1],c[S]=U>>>24^T<<8,c[S+1]=T>>>24^U<<8,e(c,E,S),r(c,E,B,k),U=c[I]^c[E],T=c[I+1]^c[E+1],c[I]=U>>>16^T<<16,c[I+1]=T>>>16^U<<16,e(c,b,I),U=c[S]^c[b],T=c[S+1]^c[b+1],c[S]=T>>>31^U<<1,c[S+1]=U>>>31^T<<1}const n=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(E){return E*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(E,S){let b=0;for(b=0;b<16;b++)c[b]=E.h[b],c[b+16]=n[b];for(c[24]=c[24]^E.t,c[25]=c[25]^E.t/4294967296,S&&(c[28]=~c[28],c[29]=~c[29]),b=0;b<32;b++)l[b]=i(E.b,4*b);for(b=0;b<12;b++)s(0,8,16,24,a[b*16+0],a[b*16+1]),s(2,10,18,26,a[b*16+2],a[b*16+3]),s(4,12,20,28,a[b*16+4],a[b*16+5]),s(6,14,22,30,a[b*16+6],a[b*16+7]),s(0,10,20,30,a[b*16+8],a[b*16+9]),s(2,12,22,24,a[b*16+10],a[b*16+11]),s(4,14,16,26,a[b*16+12],a[b*16+13]),s(6,8,18,28,a[b*16+14],a[b*16+15]);for(b=0;b<16;b++)E.h[b]=E.h[b]^c[b]^c[b+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(E,S,b,I){if(E===0||E>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(S&&S.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(b&&b.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(I&&I.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const A={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:E};h.fill(0),h[0]=E,S&&(h[1]=S.length),h[2]=1,h[3]=1,b&&h.set(b,32),I&&h.set(I,48);for(let v=0;v<16;v++)A.h[v]=n[v]^i(h,v*4);return S&&(p(A,S),A.c=128),A}function p(E,S){for(let b=0;b<S.length;b++)E.c===128&&(E.t+=E.c,u(E,!1),E.c=0),E.b[E.c++]=S[b]}function d(E){for(E.t+=E.c;E.c<128;)E.b[E.c++]=0;u(E,!0);const S=new Uint8Array(E.outlen);for(let b=0;b<E.outlen;b++)S[b]=E.h[b>>2]>>8*(b&3);return S}function g(E,S,b,I,A){b=b||64,E=t.normalizeInput(E),I&&(I=t.normalizeInput(I)),A&&(A=t.normalizeInput(A));const v=f(b,S,I,A);return p(v,E),d(v)}function m(E,S,b,I,A){const v=g(E,S,b,I,A);return t.toHex(v)}return po={blake2b:g,blake2bHex:m,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},po}var go,Ll;function h2(){if(Ll)return go;Ll=1;const t=Nd();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function r(d,g,m,E,S,b){o[d]=o[d]+o[g]+S,o[E]=i(o[E]^o[d],16),o[m]=o[m]+o[E],o[g]=i(o[g]^o[m],12),o[d]=o[d]+o[g]+b,o[E]=i(o[E]^o[d],8),o[m]=o[m]+o[E],o[g]=i(o[g]^o[m],7)}function i(d,g){return d>>>g^d<<32-g}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),n=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let m=0;for(m=0;m<8;m++)o[m]=d.h[m],o[m+8]=s[m];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(d.b,4*m);for(m=0;m<10;m++)r(0,4,8,12,a[n[m*16+0]],a[n[m*16+1]]),r(1,5,9,13,a[n[m*16+2]],a[n[m*16+3]]),r(2,6,10,14,a[n[m*16+4]],a[n[m*16+5]]),r(3,7,11,15,a[n[m*16+6]],a[n[m*16+7]]),r(0,5,10,15,a[n[m*16+8]],a[n[m*16+9]]),r(1,6,11,12,a[n[m*16+10]],a[n[m*16+11]]),r(2,7,8,13,a[n[m*16+12]],a[n[m*16+13]]),r(3,4,9,14,a[n[m*16+14]],a[n[m*16+15]]);for(m=0;m<8;m++)d.h[m]^=o[m]^o[m+8]}function l(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=g?g.length:0;if(g&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const E={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:d};return E.h[0]^=16842752^m<<8^d,m>0&&(u(E,g),E.c=64),E}function u(d,g){for(let m=0;m<g.length;m++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[m]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let m=0;m<d.outlen;m++)g[m]=d.h[m>>2]>>8*(m&3)&255;return g}function f(d,g,m){m=m||32,d=t.normalizeInput(d);const E=l(m,g);return u(E,d),h(E)}function p(d,g,m){const E=f(d,g,m);return t.toHex(E)}return go={blake2s:f,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},go}var yo,Ml;function f2(){if(Ml)return yo;Ml=1;const t=u2(),e=h2();return yo={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},yo}var d2=f2(),p2={};const g2=":";function er(t){const[e,r]=t.split(g2);return{namespace:e,reference:r}}function ql(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function kd(t,e){return t.includes(":")?[t]:e.chains||[]}var y2=Object.defineProperty,w2=Object.defineProperties,m2=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,b2=Object.prototype.hasOwnProperty,v2=Object.prototype.propertyIsEnumerable,ua=(t,e,r)=>e in t?y2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vl=(t,e)=>{for(var r in e||(e={}))b2.call(e,r)&&ua(t,r,e[r]);if(zl)for(var r of zl(e))v2.call(e,r)&&ua(t,r,e[r]);return t},E2=(t,e)=>w2(t,m2(e)),Hl=(t,e,r)=>ua(t,typeof e!="symbol"?e+"":e,r);const x2="ReactNative",nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},I2="js";function rn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Sr(){return!rr.getDocument()&&!!rr.getNavigator()&&navigator.product===x2}function _2(){return Sr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function S2(){return Sr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ei(){return!rn()&&!!rr.getNavigator()&&!!rr.getDocument()}function ls(){return Sr()?nt.reactNative:rn()?nt.node:Ei()?nt.browser:nt.unknown}function Kl(){var t;try{return Sr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function $2(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!=null&&r.set(i,String(s))}),r.toString()}function D2(t){var e,r;const i=jd();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),E2(Vl(Vl({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function jd(){return By.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function O2(){if(ls()===nt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Yg();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function A2(){var t;const e=ls();return e===nt.browser?[e,((t=rr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Fd(t,e,r){const i=O2(),s=A2();return[[t,e].join("-"),[I2,r].join("-"),i,s].join("/")}function P2({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Fd(t,e,i),h={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=$2(l[1]||"",h);return l[0]+"?"+f}function kr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function ha(t){return Object.fromEntries(t.entries())}function fa(t){return new Map(Object.entries(t))}function Br(t=z.FIVE_MINUTES,e){const r=z.toMiliseconds(t||z.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,s=c})}}function Nt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function Ld(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function B2(t){return Ld("topic",t)}function C2(t){return Ld("id",t)}function Md(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function pe(t,e){return z.fromMiliseconds(Date.now()+z.toMiliseconds(t))}function Ut(t){return Date.now()>=z.toMiliseconds(t)}function re(t,e){return`${t}${e?`:${e}`:""}`}function kt(t=[],e=[]){return[...new Set([...t,...e])]}async function T2({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s?.href;if(typeof n!="string")return;const o=R2(n,t,e),a=ls();if(a===nt.browser){if(!((i=rr.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}U2(o)}else a===nt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function R2(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${F2(i,!0)}`}else s=`${s}/wc?${i}`;return s}function U2(t){let e="_self";j2()?e="_top":(k2()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function N2(t,e){let r="";try{if(Ei()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Wl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Gl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function ac(){return typeof process<"u"&&p2.IS_VITEST==="true"}function k2(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function j2(){try{return window.self!==window.top}catch{return!1}}function F2(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function qd(t){return Buffer.from(t,"base64").toString("utf-8")}function L2(t){return new Promise(e=>setTimeout(e,t))}let M2=class{constructor({limit:e}){Hl(this,"limit"),Hl(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const $s=BigInt(2**32-1),Yl=BigInt(32);function zd(t,e=!1){return e?{h:Number(t&$s),l:Number(t>>Yl&$s)}:{h:Number(t>>Yl&$s)|0,l:Number(t&$s)|0}}function Vd(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=zd(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const Zl=(t,e,r)=>t>>>r,Jl=(t,e,r)=>t<<32-r|e>>>r,yr=(t,e,r)=>t>>>r|e<<32-r,wr=(t,e,r)=>t<<32-r|e>>>r,Li=(t,e,r)=>t<<64-r|e>>>r-32,Mi=(t,e,r)=>t>>>r-32|e<<64-r,q2=(t,e)=>e,z2=(t,e)=>t,V2=(t,e,r)=>t<<r|e>>>32-r,H2=(t,e,r)=>e<<r|t>>>32-r,K2=(t,e,r)=>e<<r-32|t>>>64-r,W2=(t,e,r)=>t<<r-32|e>>>64-r;function Et(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const cc=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),lc=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,G2=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Y2=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Z2=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),J2=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,ei=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function In(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function sr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function _t(t,...e){if(!In(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function _n(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");sr(t.outputLen),sr(t.blockLen)}function _r(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function uc(t,e){_t(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Qi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function yt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function wo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Ot(t,e){return t<<32-e|t>>>e}const Hd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Kd(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Wt=Hd?t=>t:t=>Kd(t);function X2(t){for(let e=0;e<t.length;e++)t[e]=Kd(t[e]);return t}const mr=Hd?t=>t:X2,Wd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Q2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function fi(t){if(_t(t),Wd)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Q2[t[r]];return e}const Vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Xl(t){if(t>=Vt._0&&t<=Vt._9)return t-Vt._0;if(t>=Vt.A&&t<=Vt.F)return t-(Vt.A-10);if(t>=Vt.a&&t<=Vt.f)return t-(Vt.a-10)}function sn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Wd)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Xl(t.charCodeAt(n)),a=Xl(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Gd(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function It(t){return typeof t=="string"&&(t=Gd(t)),_t(t),t}function br(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];_t(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class Sn{}function us(t){const e=i=>t().update(It(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function eE(t){const e=(i,s)=>t(s).update(It(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function Kr(t=32){if(ei&&typeof ei.getRandomValues=="function")return ei.getRandomValues(new Uint8Array(t));if(ei&&typeof ei.randomBytes=="function")return Uint8Array.from(ei.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const tE=BigInt(0),Pi=BigInt(1),rE=BigInt(2),iE=BigInt(7),sE=BigInt(256),nE=BigInt(113),Yd=[],Zd=[],Jd=[];for(let t=0,e=Pi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Yd.push(2*(5*i+r)),Zd.push((t+1)*(t+2)/2%64);let s=tE;for(let n=0;n<7;n++)e=(e<<Pi^(e>>iE)*nE)%sE,e&rE&&(s^=Pi<<(Pi<<BigInt(n))-Pi);Jd.push(s)}const Xd=Vd(Jd,!0),oE=Xd[0],aE=Xd[1],Ql=(t,e,r)=>r>32?K2(t,e,r):V2(t,e,r),eu=(t,e,r)=>r>32?W2(t,e,r):H2(t,e,r);function cE(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Ql(l,u,1)^r[a],f=eu(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=Zd[o],c=Ql(s,n,a),l=eu(s,n,a),u=Yd[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=oE[i],t[1]^=aE[i]}yt(r)}let lE=class Qd extends Sn{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,sr(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Qi(this.state)}clone(){return this._cloneInto()}keccak(){mr(this.state32),cE(this.state32,this.rounds),mr(this.state32),this.posOut=0,this.pos=0}update(e){_r(this),e=It(e),_t(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,(r&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){_r(this,!1),_t(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return sr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(uc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,yt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Qd(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const uE=(t,e,r)=>us(()=>new lE(e,t,r)),hE=uE(1,136,256/8);function fE(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function dE(t,e,r){return t&e^~t&r}function pE(t,e,r){return t&e^t&r^e&r}let ep=class extends Sn{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=wo(this.buffer)}update(e){_r(this),e=It(e),_t(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=wo(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){_r(this),uc(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,yt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;fE(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=wo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const lr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ce=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Te=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),gE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ur=new Uint32Array(64);class yE extends ep{constructor(e=32){super(64,e,8,!1),this.A=lr[0]|0,this.B=lr[1]|0,this.C=lr[2]|0,this.D=lr[3]|0,this.E=lr[4]|0,this.F=lr[5]|0,this.G=lr[6]|0,this.H=lr[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ur[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=ur[h-15],p=ur[h-2],d=Ot(f,7)^Ot(f,18)^f>>>3,g=Ot(p,17)^Ot(p,19)^p>>>10;ur[h]=g+ur[h-7]+d+ur[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Ot(a,6)^Ot(a,11)^Ot(a,25),p=u+f+dE(a,c,l)+gE[h]+ur[h]|0,d=(Ot(i,2)^Ot(i,13)^Ot(i,22))+pE(i,s,n)|0;u=l,l=c,c=a,a=o+p|0,o=n,n=s,s=i,i=p+d|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){yt(ur)}destroy(){this.set(0,0,0,0,0,0,0,0),yt(this.buffer)}}const tp=Vd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),wE=tp[0],mE=tp[1],hr=new Uint32Array(80),fr=new Uint32Array(80);let hc=class extends ep{constructor(e=64){super(128,e,16,!1),this.Ah=Te[0]|0,this.Al=Te[1]|0,this.Bh=Te[2]|0,this.Bl=Te[3]|0,this.Ch=Te[4]|0,this.Cl=Te[5]|0,this.Dh=Te[6]|0,this.Dl=Te[7]|0,this.Eh=Te[8]|0,this.El=Te[9]|0,this.Fh=Te[10]|0,this.Fl=Te[11]|0,this.Gh=Te[12]|0,this.Gl=Te[13]|0,this.Hh=Te[14]|0,this.Hl=Te[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)hr[b]=e.getUint32(r),fr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const I=hr[b-15]|0,A=fr[b-15]|0,v=yr(I,A,1)^yr(I,A,8)^Zl(I,A,7),C=wr(I,A,1)^wr(I,A,8)^Jl(I,A,7),R=hr[b-2]|0,B=fr[b-2]|0,k=yr(R,B,19)^Li(R,B,61)^Zl(R,B,6),U=wr(R,B,19)^Mi(R,B,61)^Jl(R,B,6),T=G2(C,U,fr[b-7],fr[b-16]),O=Y2(T,v,k,hr[b-7],hr[b-16]);hr[b]=O|0,fr[b]=T|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:m,Hh:E,Hl:S}=this;for(let b=0;b<80;b++){const I=yr(h,f,14)^yr(h,f,18)^Li(h,f,41),A=wr(h,f,14)^wr(h,f,18)^Mi(h,f,41),v=h&p^~h&g,C=f&d^~f&m,R=Z2(S,A,C,mE[b],fr[b]),B=J2(R,E,I,v,wE[b],hr[b]),k=R|0,U=yr(i,s,28)^Li(i,s,34)^Li(i,s,39),T=wr(i,s,28)^Mi(i,s,34)^Mi(i,s,39),O=i&n^i&a^n&a,D=s&o^s&c^o&c;E=g|0,S=m|0,g=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=Et(l|0,u|0,B|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=cc(k,T,D);i=lc(y,B,U,O),s=y|0}({h:i,l:s}=Et(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Et(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=Et(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Et(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Et(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Et(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=Et(this.Gh|0,this.Gl|0,g|0,m|0),{h:E,l:S}=Et(this.Hh|0,this.Hl|0,E|0,S|0),this.set(i,s,n,o,a,c,l,u,h,f,p,d,g,m,E,S)}roundClean(){yt(hr,fr)}destroy(){yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class bE extends hc{constructor(){super(48),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}}const Re=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class vE extends hc{constructor(){super(32),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}}const $n=us(()=>new yE),EE=us(()=>new hc),xE=us(()=>new bE),IE=us(()=>new vE),_E=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),we=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),H=new Uint32Array(32);function dr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=H[2*t],l=H[2*t+1],u=H[2*e],h=H[2*e+1],f=H[2*r],p=H[2*r+1],d=H[2*i],g=H[2*i+1],m=cc(c,u,o);l=lc(m,l,h,a),c=m|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:q2(g,d),Dl:z2(g)},{h:p,l:f}=Et(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:yr(h,u,24),Bl:wr(h,u,24)},H[2*t]=c,H[2*t+1]=l,H[2*e]=u,H[2*e+1]=h,H[2*r]=f,H[2*r+1]=p,H[2*i]=d,H[2*i+1]=g}function pr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=H[2*t],l=H[2*t+1],u=H[2*e],h=H[2*e+1],f=H[2*r],p=H[2*r+1],d=H[2*i],g=H[2*i+1],m=cc(c,u,o);l=lc(m,l,h,a),c=m|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:yr(g,d,16),Dl:wr(g,d,16)},{h:p,l:f}=Et(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:Li(h,u,63),Bl:Mi(h,u,63)},H[2*t]=c,H[2*t+1]=l,H[2*e]=u,H[2*e+1]=h,H[2*r]=f,H[2*r+1]=p,H[2*i]=d,H[2*i+1]=g}function SE(t,e={},r,i,s){if(sr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class $E extends Sn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,sr(e),sr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Qi(this.buffer)}update(e){_r(this),e=It(e),_t(e);const{blockLen:r,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===r&&(mr(s),this.compress(s,0,!1),mr(s),this.pos=0);const l=Math.min(r-this.pos,n-c),u=o+c;if(l===r&&!(u%4)&&c+l<n){const h=new Uint32Array(a,u,Math.floor((n-c)/4));mr(h);for(let f=0;c+r<n;f+=s.length,c+=r)this.length+=r,this.compress(h,f,!1);mr(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){_r(this),uc(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,yt(this.buffer.subarray(r)),mr(i),this.compress(i,0,!0),mr(i);const s=Qi(e);this.get().forEach((n,o)=>s[o]=Wt(n))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class DE extends $E{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=we[0]|0,this.v0h=we[1]|0,this.v1l=we[2]|0,this.v1h=we[3]|0,this.v2l=we[4]|0,this.v2h=we[5]|0,this.v3l=we[6]|0,this.v3h=we[7]|0,this.v4l=we[8]|0,this.v4h=we[9]|0,this.v5l=we[10]|0,this.v5h=we[11]|0,this.v6l=we[12]|0,this.v6h=we[13]|0,this.v7l=we[14]|0,this.v7h=we[15]|0,SE(r,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=It(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=It(n);const a=Qi(n);this.v4l^=Wt(a[0]),this.v4h^=Wt(a[1]),this.v5l^=Wt(a[2]),this.v5h^=Wt(a[3])}if(s!==void 0){s=It(s);const a=Qi(s);this.v6l^=Wt(a[0]),this.v6h^=Wt(a[1]),this.v7l^=Wt(a[2]),this.v7h^=Wt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,p,d,g,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>H[l]=c),H.set(we,16);let{h:s,l:n}=zd(BigInt(this.length));H[24]=we[8]^n,H[25]=we[9]^s,i&&(H[28]=~H[28],H[29]=~H[29]);let o=0;const a=_E;for(let c=0;c<12;c++)dr(0,4,8,12,e,r+2*a[o++]),pr(0,4,8,12,e,r+2*a[o++]),dr(1,5,9,13,e,r+2*a[o++]),pr(1,5,9,13,e,r+2*a[o++]),dr(2,6,10,14,e,r+2*a[o++]),pr(2,6,10,14,e,r+2*a[o++]),dr(3,7,11,15,e,r+2*a[o++]),pr(3,7,11,15,e,r+2*a[o++]),dr(0,5,10,15,e,r+2*a[o++]),pr(0,5,10,15,e,r+2*a[o++]),dr(1,6,11,12,e,r+2*a[o++]),pr(1,6,11,12,e,r+2*a[o++]),dr(2,7,8,13,e,r+2*a[o++]),pr(2,7,8,13,e,r+2*a[o++]),dr(3,4,9,14,e,r+2*a[o++]),pr(3,4,9,14,e,r+2*a[o++]);this.v0l^=H[0]^H[16],this.v0h^=H[1]^H[17],this.v1l^=H[2]^H[18],this.v1h^=H[3]^H[19],this.v2l^=H[4]^H[20],this.v2h^=H[5]^H[21],this.v3l^=H[6]^H[22],this.v3h^=H[7]^H[23],this.v4l^=H[8]^H[24],this.v4h^=H[9]^H[25],this.v5l^=H[10]^H[26],this.v5h^=H[11]^H[27],this.v6l^=H[12]^H[28],this.v6h^=H[13]^H[29],this.v7l^=H[14]^H[30],this.v7h^=H[15]^H[31],yt(H)}destroy(){this.destroyed=!0,yt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const OE=eE(t=>new DE(t)),AE="https://rpc.walletconnect.org/v1";function rp(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(hE(r)).toString("hex")}async function PE(t,e,r,i,s,n){switch(r.t){case"eip191":return await BE(t,e,r.s);case"eip1271":return await CE(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function BE(t,e,r){const i=xw(r);return Uw({payload:rp(e),signature:i}).toLowerCase()===t.toLowerCase()}async function CE(t,e,r,i,s,n){const o=er(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:rp(e)).substring(2),f=a+h+c+u+l,p=await fetch(`${n||AE}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:TE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function TE(){return Date.now()+Math.floor(Math.random()*1e3)}function RE(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return os.encode(n)}function UE(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const s=OE(i,{dkLen:32});return os.encode(s)}function tu(t){const e=new Uint8Array($n(NE(t)));return os.encode(e)}function NE(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function ru(t){const e=Buffer.from(t,"base64"),r=vm(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=hm(r),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(i)]),o=IE(n);return Rw.encode(o).replace(/=+$/,"")}function mo(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function kE(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(mo(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(mo(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(mo(i.length)),s.push(i);const n=Buffer.concat(s),o=$n(n);return Buffer.from(o).toString("hex").toUpperCase()}function jE(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&i.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return i}var FE=Object.defineProperty,LE=Object.defineProperties,ME=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,qE=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,su=(t,e,r)=>e in t?FE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,VE=(t,e)=>{for(var r in e||(e={}))qE.call(e,r)&&su(t,r,e[r]);if(iu)for(var r of iu(e))zE.call(e,r)&&su(t,r,e[r]);return t},HE=(t,e)=>LE(t,ME(e));const KE="did:pkh:",fc=t=>t?.split(":"),WE=t=>{const e=t&&fc(t);if(e)return t.includes(KE)?e[3]:e[1]},da=t=>{const e=t&&fc(t);if(e)return e[2]+":"+e[3]},nn=t=>{const e=t&&fc(t);if(e)return e.pop()};async function nu(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=ip(s,s.iss),o=nn(s.iss);return await PE(o,n,i,da(s.iss),r)}const ip=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=nn(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${WE(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=Ms(t.resources);if(d){const g=es(d);s=rx(s,g)}return[r,i,"",s,"",n,o,a,c,l,u,h,f,p].filter(g=>g!=null).join(`
`)};function GE(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function YE(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Vr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function ZE(t,e,r,i={}){return r?.sort((s,n)=>s.localeCompare(n)),{att:{[t]:JE(e,r,i)}}}function JE(t,e,r={}){e=e?.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function sp(t){return Vr(t),`urn:recap:${GE(t).replace(/=/g,"")}`}function es(t){const e=YE(t.replace("urn:recap:",""));return Vr(e),e}function XE(t,e,r){const i=ZE(t,e,r);return sp(i)}function QE(t){return t&&t.includes("urn:recap:")}function ex(t,e){const r=es(t),i=es(e),s=tx(r,i);return sp(s)}function tx(t,e){Vr(t),Vr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=HE(VE({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function rx(t="",e){Vr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function ou(t){var e;const r=es(t);Vr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function au(t){const e=es(t);Vr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Ms(t){if(!t)return;const e=t?.[t.length-1];return QE(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function np(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function pa(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function bo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ge(t,...e){if(!np(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function cu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ix(t,e){Ge(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function xr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function mi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function sx(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const nx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ox(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ga(t){if(typeof t=="string")t=ox(t);else if(np(t))t=ya(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function ax(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function cx(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const lx=(t,e)=>{function r(i,...s){if(Ge(i),!nx)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ge(l):Ge(l,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Ge(s[1]);const o=e(i,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ge(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ge(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ge(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function lu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!hx(e))throw new Error("invalid output, must be aligned");return e}function uu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function ux(t,e,r){pa(r);const i=new Uint8Array(16),s=sx(i);return uu(s,0,BigInt(e),r),uu(s,8,BigInt(t),r),i}function hx(t){return t.byteOffset%4===0}function ya(t){return Uint8Array.from(t)}const op=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),fx=op("expand 16-byte k"),dx=op("expand 32-byte k"),px=xr(fx),gx=xr(dx);function ee(t,e){return t<<e|t>>>32-e}function wa(t){return t.byteOffset%4===0}const Ds=64,yx=16,ap=2**32-1,hu=new Uint32Array;function wx(t,e,r,i,s,n,o,a){const c=s.length,l=new Uint8Array(Ds),u=xr(l),h=wa(s)&&wa(n),f=h?xr(s):hu,p=h?xr(n):hu;for(let d=0;d<c;o++){if(t(e,r,i,u,o,a),o>=ap)throw new Error("arx: counter overflow");const g=Math.min(Ds,c-d);if(h&&g===Ds){const m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let E=0,S;E<yx;E++)S=m+E,p[S]=f[S]^u[E];d+=Ds;continue}for(let m=0,E;m<g;m++)E=d+m,n[E]=s[E]^l[m];d+=g}}function mx(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=ax({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return bo(s),bo(o),pa(n),pa(r),(a,c,l,u,h=0)=>{Ge(a),Ge(c),Ge(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),Ge(u),bo(h),h<0||h>=ap)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,m;if(d===32)p.push(g=ya(a)),m=gx;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),m=px,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);wa(c)||p.push(c=ya(c));const E=xr(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,E,xr(c.subarray(0,16)),E),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const I=new Uint8Array(12);I.set(c,n?0:12-c.length),c=I,p.push(c)}const b=xr(c);return wx(t,m,E,b,l,u,h,o),mi(...p),u}}const Se=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class bx{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ga(e),Ge(e,32);const r=Se(e,0),i=Se(e,2),s=Se(e,4),n=Se(e,6),o=Se(e,8),a=Se(e,10),c=Se(e,12),l=Se(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Se(e,16+2*u)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],m=o[9],E=Se(e,r+0),S=Se(e,r+2),b=Se(e,r+4),I=Se(e,r+6),A=Se(e,r+8),v=Se(e,r+10),C=Se(e,r+12),R=Se(e,r+14);let B=n[0]+(E&8191),k=n[1]+((E>>>13|S<<3)&8191),U=n[2]+((S>>>10|b<<6)&8191),T=n[3]+((b>>>7|I<<9)&8191),O=n[4]+((I>>>4|A<<12)&8191),D=n[5]+(A>>>1&8191),y=n[6]+((A>>>14|v<<2)&8191),w=n[7]+((v>>>11|C<<5)&8191),x=n[8]+((C>>>8|R<<8)&8191),P=n[9]+(R>>>5|s),_=0,$=_+B*a+k*(5*m)+U*(5*g)+T*(5*d)+O*(5*p);_=$>>>13,$&=8191,$+=D*(5*f)+y*(5*h)+w*(5*u)+x*(5*l)+P*(5*c),_+=$>>>13,$&=8191;let N=_+B*c+k*a+U*(5*m)+T*(5*g)+O*(5*d);_=N>>>13,N&=8191,N+=D*(5*p)+y*(5*f)+w*(5*h)+x*(5*u)+P*(5*l),_+=N>>>13,N&=8191;let j=_+B*l+k*c+U*a+T*(5*m)+O*(5*g);_=j>>>13,j&=8191,j+=D*(5*d)+y*(5*p)+w*(5*f)+x*(5*h)+P*(5*u),_+=j>>>13,j&=8191;let V=_+B*u+k*l+U*c+T*a+O*(5*m);_=V>>>13,V&=8191,V+=D*(5*g)+y*(5*d)+w*(5*p)+x*(5*f)+P*(5*h),_+=V>>>13,V&=8191;let L=_+B*h+k*u+U*l+T*c+O*a;_=L>>>13,L&=8191,L+=D*(5*m)+y*(5*g)+w*(5*d)+x*(5*p)+P*(5*f),_+=L>>>13,L&=8191;let M=_+B*f+k*h+U*u+T*l+O*c;_=M>>>13,M&=8191,M+=D*a+y*(5*m)+w*(5*g)+x*(5*d)+P*(5*p),_+=M>>>13,M&=8191;let K=_+B*p+k*f+U*h+T*u+O*l;_=K>>>13,K&=8191,K+=D*c+y*a+w*(5*m)+x*(5*g)+P*(5*d),_+=K>>>13,K&=8191;let G=_+B*d+k*p+U*f+T*h+O*u;_=G>>>13,G&=8191,G+=D*l+y*c+w*a+x*(5*m)+P*(5*g),_+=G>>>13,G&=8191;let Z=_+B*g+k*d+U*p+T*f+O*h;_=Z>>>13,Z&=8191,Z+=D*u+y*l+w*c+x*a+P*(5*m),_+=Z>>>13,Z&=8191;let W=_+B*m+k*g+U*d+T*p+O*f;_=W>>>13,W&=8191,W+=D*h+y*u+w*l+x*c+P*a,_+=W>>>13,W&=8191,_=(_<<2)+_|0,_=_+$|0,$=_&8191,_=_>>>13,N+=_,n[0]=$,n[1]=N,n[2]=j,n[3]=V,n[4]=L,n[5]=M,n[6]=K,n[7]=G,n[8]=Z,n[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;mi(i)}update(e){cu(this),e=ga(e),Ge(e);const{buffer:r,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){mi(this.h,this.r,this.buffer,this.pad)}digestInto(e){cu(this),ix(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function vx(t){const e=(i,s)=>t(s).update(ga(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const Ex=vx(t=>new bx(t));function xx(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],m=e[6],E=e[7],S=s,b=r[0],I=r[1],A=r[2],v=o,C=a,R=c,B=l,k=u,U=h,T=f,O=p,D=d,y=g,w=m,x=E,P=S,_=b,$=I,N=A;for(let V=0;V<n;V+=2)v=v+k|0,P=ee(P^v,16),D=D+P|0,k=ee(k^D,12),v=v+k|0,P=ee(P^v,8),D=D+P|0,k=ee(k^D,7),C=C+U|0,_=ee(_^C,16),y=y+_|0,U=ee(U^y,12),C=C+U|0,_=ee(_^C,8),y=y+_|0,U=ee(U^y,7),R=R+T|0,$=ee($^R,16),w=w+$|0,T=ee(T^w,12),R=R+T|0,$=ee($^R,8),w=w+$|0,T=ee(T^w,7),B=B+O|0,N=ee(N^B,16),x=x+N|0,O=ee(O^x,12),B=B+O|0,N=ee(N^B,8),x=x+N|0,O=ee(O^x,7),v=v+U|0,N=ee(N^v,16),w=w+N|0,U=ee(U^w,12),v=v+U|0,N=ee(N^v,8),w=w+N|0,U=ee(U^w,7),C=C+T|0,P=ee(P^C,16),x=x+P|0,T=ee(T^x,12),C=C+T|0,P=ee(P^C,8),x=x+P|0,T=ee(T^x,7),R=R+O|0,_=ee(_^R,16),D=D+_|0,O=ee(O^D,12),R=R+O|0,_=ee(_^R,8),D=D+_|0,O=ee(O^D,7),B=B+k|0,$=ee($^B,16),y=y+$|0,k=ee(k^y,12),B=B+k|0,$=ee($^B,8),y=y+$|0,k=ee(k^y,7);let j=0;i[j++]=o+v|0,i[j++]=a+C|0,i[j++]=c+R|0,i[j++]=l+B|0,i[j++]=u+k|0,i[j++]=h+U|0,i[j++]=f+T|0,i[j++]=p+O|0,i[j++]=d+D|0,i[j++]=g+y|0,i[j++]=m+w|0,i[j++]=E+x|0,i[j++]=S+P|0,i[j++]=b+_|0,i[j++]=I+$|0,i[j++]=A+N|0}const Ix=mx(xx,{counterRight:!1,counterLength:4,allowShortKeys:!1}),_x=new Uint8Array(16),fu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(_x.subarray(r))},Sx=new Uint8Array(32);function du(t,e,r,i,s){const n=t(e,r,Sx),o=Ex.create(n);s&&fu(o,s),fu(o,i);const a=ux(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return mi(n,a),c}const $x=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=lu(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=du(t,e,r,a,i);return n.set(c,o),mi(c),n},decrypt(s,n){n=lu(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=du(t,e,r,o,i);if(!cx(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),mi(c),n}}),cp=lx({blockSize:64,nonceLength:12,tagLength:16},$x(Ix));let lp=class extends Sn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,_n(e);const i=It(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),yt(n)}update(e){return _r(this),this.iHash.update(e),this}digestInto(e){_r(this),_t(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Dn=(t,e,r)=>new lp(t,e).update(r).digest();Dn.create=(t,e)=>new lp(t,e);function Dx(t,e,r){return _n(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Dn(t,It(r),It(e))}const vo=Uint8Array.from([0]),pu=Uint8Array.of();function Ox(t,e,r,i=32){_n(t),sr(i);const s=t.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);r===void 0&&(r=pu);const o=new Uint8Array(n*s),a=Dn.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<n;u++)vo[0]=u+1,c.update(u===0?pu:l).update(r).update(vo).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),yt(l,vo),o.slice(0,i)}const Ax=(t,e,r,i,s)=>Ox(t,Dx(t,e,r),i,s),On=$n,dc=BigInt(0),ma=BigInt(1);function on(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function jr(t,e,r=""){const i=In(t),s=t?.length,n=e!==void 0;if(!i||n&&s!==e){const o=r&&`"${r}" `,a=n?` of length ${e}`:"",c=i?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Os(t){const e=t.toString(16);return e.length&1?"0"+e:e}function up(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?dc:BigInt("0x"+t)}function An(t){return up(fi(t))}function an(t){return _t(t),up(fi(Uint8Array.from(t).reverse()))}function pc(t,e){return sn(t.toString(16).padStart(e*2,"0"))}function gc(t,e){return pc(t,e).reverse()}function ke(t,e,r){let i;if(typeof e=="string")try{i=sn(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(In(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const Eo=t=>typeof t=="bigint"&&dc<=t;function Px(t,e,r){return Eo(t)&&Eo(e)&&Eo(r)&&e<=t&&t<r}function ba(t,e,r,i){if(!Px(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function hp(t){let e;for(e=0;t>dc;t>>=ma,e+=1);return e}const hs=t=>(ma<<BigInt(t))-ma;function Bx(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=i(t),o=i(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},l=(...f)=>r(o,n,...f),u=(f=i(0))=>{o=l(s(0),f),n=l(),f.length!==0&&(o=l(s(1),f),n=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){n=l();const d=n.slice();p.push(d),f+=n.length}return br(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(h()));)u();return c(),d}}function Pn(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(r).forEach(([s,n])=>i(s,n,!0))}function gu(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const Je=BigInt(0),Le=BigInt(1),Fr=BigInt(2),fp=BigInt(3),dp=BigInt(4),pp=BigInt(5),Cx=BigInt(7),gp=BigInt(8),Tx=BigInt(9),yp=BigInt(16);function st(t,e){const r=t%e;return r>=Je?r:e+r}function vt(t,e,r){let i=t;for(;e-- >Je;)i*=i,i%=r;return i}function yu(t,e){if(t===Je)throw new Error("invert: expected non-zero number");if(e<=Je)throw new Error("invert: expected positive modulus, got "+e);let r=st(t,e),i=e,s=Je,n=Le;for(;r!==Je;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==Le)throw new Error("invert: does not exist");return st(s,e)}function yc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function wp(t,e){const r=(t.ORDER+Le)/dp,i=t.pow(e,r);return yc(t,i,e),i}function Rx(t,e){const r=(t.ORDER-pp)/gp,i=t.mul(e,Fr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Fr),s),a=t.mul(n,t.sub(o,t.ONE));return yc(t,a,e),a}function Ux(t){const e=$r(t),r=mp(t),i=r(e,e.neg(e.ONE)),s=r(e,i),n=r(e,e.neg(i)),o=(t+Cx)/yp;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const h=a.mul(l,s),f=a.mul(l,n),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(f,h,d);const g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return yc(a,m,c),m}}function mp(t){if(t<fp)throw new Error("sqrt is not defined for small field");let e=t-Le,r=0;for(;e%Fr===Je;)e/=Fr,r++;let i=Fr;const s=$r(t);for(;wu(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return wp;let n=s.pow(i,e);const o=(e+Le)/Fr;return function(a,c){if(a.is0(c))return c;if(wu(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,n),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const g=Le<<BigInt(l-p-1),m=a.pow(u,g);l=p,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function Nx(t){return t%dp===fp?wp:t%gp===pp?Rx:t%yp===Tx?Ux(t):mp(t)}const kx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jx(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=kx.reduce((i,s)=>(i[s]="function",i),e);return Pn(t,r),t}function Fx(t,e,r){if(r<Je)throw new Error("invalid exponent, negatives unsupported");if(r===Je)return t.ONE;if(r===Le)return e;let i=t.ONE,s=e;for(;r>Je;)r&Le&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Le;return i}function bp(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function wu(t,e){const r=(t.ORDER-Le)/Fr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function vp(t,e){e!==void 0&&sr(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function $r(t,e,r=!1,i={}){if(t<=Je)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(n=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:c,nByteLength:l}=vp(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:hs(c),ZERO:Je,ONE:Le,allowedLengths:a,create:f=>st(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Je<=f&&f<t},is0:f=>f===Je,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Le)===Le,neg:f=>st(-f,t),eql:(f,p)=>f===p,sqr:f=>st(f*f,t),add:(f,p)=>st(f+p,t),sub:(f,p)=>st(f-p,t),mul:(f,p)=>st(f*p,t),pow:(f,p)=>Fx(h,f,p),div:(f,p)=>st(f*yu(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>yu(f,t),sqrt:n||(f=>(u||(u=Nx(t)),u(h,f))),toBytes:f=>r?gc(f,l):pc(f,l),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(l);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let d=r?an(f):An(f);if(o&&(d=st(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>bp(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function Ep(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function xp(t){const e=Ep(t);return e+Math.ceil(e/2)}function Lx(t,e,r=!1){const i=t.length,s=Ep(e),n=xp(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?an(t):An(t),a=st(o,e-Le)+Le;return r?gc(a,s):pc(a,s)}const bi=BigInt(0),Lr=BigInt(1);function cn(t,e){const r=e.negate();return t?r:e}function xo(t,e){const r=bp(t.Fp,e.map(i=>i.Z));return e.map((i,s)=>t.fromAffine(i.toAffine(r[s])))}function Ip(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Io(t,e){Ip(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=hs(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function mu(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Lr);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function Mx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function qx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const _o=new WeakMap,_p=new WeakMap;function So(t){return _p.get(t)||1}function bu(t){if(t!==bi)throw new Error("invalid wNAF")}class zx{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let s=e;for(;r>bi;)r&Lr&&(i=i.add(s)),s=s.double(),r>>=Lr;return i}precomputeWindow(e,r){const{windows:i,windowSize:s}=Io(r,this.bits),n=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,n.push(a);for(let l=1;l<s;l++)a=a.add(o),n.push(a);o=a.double()}return n}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let s=this.ZERO,n=this.BASE;const o=Io(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:p}=mu(i,a,o);i=c,u?n=n.add(cn(f,r[p])):s=s.add(cn(h,r[l]))}return bu(i),{p:s,f:n}}wNAFUnsafe(e,r,i,s=this.ZERO){const n=Io(e,this.bits);for(let o=0;o<n.windows&&i!==bi;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=mu(i,o,n);if(i=a,!l){const h=r[c];s=s.add(u?h.negate():h)}}return bu(i),s}getPrecomputes(e,r,i){let s=_o.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(s=i(s)),_o.set(r,s))),s}cached(e,r,i){const s=So(e);return this.wNAF(s,this.getPrecomputes(s,e,i),r)}unsafe(e,r,i,s){const n=So(e);return n===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,i),r,s)}createCache(e,r){Ip(r,this.bits),_p.set(e,r),_o.delete(e)}hasCache(e){return So(e)!==1}}function Vx(t,e,r,i){let s=e,n=t.ZERO,o=t.ZERO;for(;r>bi||i>bi;)r&Lr&&(n=n.add(s)),i&Lr&&(o=o.add(s)),s=s.double(),r>>=Lr,i>>=Lr;return{p1:n,p2:o}}function Hx(t,e,r,i){Mx(r,t),qx(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=hp(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=hs(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<n;g++){const m=i[g],E=Number(m>>BigInt(p)&l);u[E]=u[E].add(r[g])}let d=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),d=d.add(m);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function vu(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return jx(e),e}else return $r(t,{isLE:r})}function Kx(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>bi))throw new Error(`CURVE.${a} must be positive bigint`)}const s=vu(e.p,r.Fp,i),n=vu(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Gd("HashToScalar-");const Bi=BigInt(0),ti=BigInt(1),As=BigInt(2);function Wx(t){return Pn(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Gx(t){const e=Wx(t),{P:r,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||Kr,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?As**BigInt(254):As**BigInt(447),d=a?BigInt(8)*As**BigInt(251)-ti:BigInt(4)*As**BigInt(445)-ti,g=p+d+ti,m=T=>st(T,r),E=S(h);function S(T){return gc(m(T),u)}function b(T){const O=ke("u coordinate",T,u);return a&&(O[31]&=127),m(an(O))}function I(T){return an(s(ke("scalar",T,u)))}function A(T,O){const D=R(b(O),I(T));if(D===Bi)throw new Error("invalid private or public key received");return S(D)}function v(T){return A(T,E)}function C(T,O,D){const y=m(T*(O-D));return O=m(O-y),D=m(D+y),{x_2:O,x_3:D}}function R(T,O){ba("u",T,Bi,r),ba("scalar",O,p,g);const D=O,y=T;let w=ti,x=Bi,P=T,_=ti,$=Bi;for(let j=BigInt(l-1);j>=Bi;j--){const V=D>>j&ti;$^=V,{x_2:w,x_3:P}=C($,w,P),{x_2:x,x_3:_}=C($,x,_),$=V;const L=w+x,M=m(L*L),K=w-x,G=m(K*K),Z=M-G,W=P+_,J=P-_,ue=m(J*L),ye=m(W*K),ve=ue+ye,je=ue-ye;P=m(ve*ve),_=m(y*m(je*je)),w=m(M*G),x=m(Z*(M+m(f*Z)))}({x_2:w,x_3:P}=C($,w,P)),{x_2:x,x_3:_}=C($,x,_);const N=n(x);return m(w*N)}const B={secretKey:u,publicKey:u,seed:u},k=(T=c(u))=>(_t(T,B.seed),T);function U(T){const O=k(T);return{secretKey:O,publicKey:v(O)}}return{keygen:U,getSharedSecret:(T,O)=>A(T,O),getPublicKey:T=>v(T),scalarMult:A,scalarMultBase:v,utils:{randomSecretKey:k,randomPrivateKey:k},GuBytes:E.slice(),lengths:B}}const Yx=BigInt(1),Eu=BigInt(2),Zx=BigInt(3),Jx=BigInt(5);BigInt(8);const Sp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Xx={p:Sp,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Qx(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Sp,o=t*t%n*t%n,a=vt(o,Eu,n)*o%n,c=vt(a,Yx,n)*t%n,l=vt(c,Jx,n)*c%n,u=vt(l,e,n)*l%n,h=vt(u,r,n)*u%n,f=vt(h,i,n)*h%n,p=vt(f,s,n)*f%n,d=vt(p,s,n)*f%n,g=vt(d,e,n)*l%n;return{pow_p_5_8:vt(g,Eu,n)*t%n,b2:o}}function e3(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const t3=$r(Xx.p,{isLE:!0}),va=(()=>{const t=t3.ORDER;return Gx({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=Qx(e);return st(vt(r,Zx,t)*i,t)},adjustScalarBytes:e3})})(),xu=(t,e)=>(t+(t>=0?e:-e)/$p)/e;function r3(t,e,r){const[[i,s],[n,o]]=e,a=xu(o*t,r),c=xu(-s*t,r);let l=t-a*i-c*n,u=-a*s-c*o;const h=l<Qt,f=u<Qt;h&&(l=-l),f&&(u=-u);const p=hs(Math.ceil(hp(r)/2))+di;if(l<Qt||l>=p||u<Qt||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function Ea(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function $o(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return on(r.lowS,"lowS"),on(r.prehash,"prehash"),r.format!==void 0&&Ea(r.format),r}class i3 extends Error{constructor(e=""){super(e)}}const Jt={Err:i3,_tlv:{encode:(t,e)=>{const{Err:r}=Jt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=Os(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?Os(s.length/2|128):"";return Os(t)+n+s+e},decode(t,e){const{Err:r}=Jt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Jt;if(t<Qt)throw new e("integer: negative integers are not allowed");let r=Os(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Jt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return An(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Jt,s=ke("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Jt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},Qt=BigInt(0),di=BigInt(1),$p=BigInt(2),Ps=BigInt(3),s3=BigInt(4);function ai(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let s=ke("private key",e);try{i=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function n3(t,e={}){const r=Kx("weierstrass",t,e),{Fp:i,Fn:s}=r;let n=r.CURVE;const{h:o,n:a}=n;Pn(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(n.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Op(i,s);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(T,O,D){const{x:y,y:w}=O.toAffine(),x=i.toBytes(y);if(on(D,"isCompressed"),D){u();const P=!i.isOdd(w);return br(Dp(P),x)}else return br(Uint8Array.of(4),x,i.toBytes(w))}function f(T){jr(T,void 0,"Point");const{publicKey:O,publicKeyUncompressed:D}=l,y=T.length,w=T[0],x=T.subarray(1);if(y===O&&(w===2||w===3)){const P=i.fromBytes(x);if(!i.isValid(P))throw new Error("bad point: is not on curve, wrong x");const _=g(P);let $;try{$=i.sqrt(_)}catch(j){const V=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}u();const N=i.isOdd($);return(w&1)===1!==N&&($=i.neg($)),{x:P,y:$}}else if(y===D&&w===4){const P=i.BYTES,_=i.fromBytes(x.subarray(0,P)),$=i.fromBytes(x.subarray(P,P*2));if(!m(_,$))throw new Error("bad point: is not on curve");return{x:_,y:$}}else throw new Error(`bad point: got length ${y}, expected compressed=${O} or uncompressed=${D}`)}const p=e.toBytes||h,d=e.fromBytes||f;function g(T){const O=i.sqr(T),D=i.mul(O,T);return i.add(i.add(D,i.mul(T,n.a)),n.b)}function m(T,O){const D=i.sqr(O),y=g(T);return i.eql(D,y)}if(!m(n.Gx,n.Gy))throw new Error("bad curve params: generator point");const E=i.mul(i.pow(n.a,Ps),s3),S=i.mul(i.sqr(n.b),BigInt(27));if(i.is0(i.add(E,S)))throw new Error("bad curve params: a or b");function b(T,O,D=!1){if(!i.isValid(O)||D&&i.is0(O))throw new Error(`bad point coordinate ${T}`);return O}function I(T){if(!(T instanceof B))throw new Error("ProjectivePoint expected")}function A(T){if(!c||!c.basises)throw new Error("no endo");return r3(T,c.basises,s.ORDER)}const v=gu((T,O)=>{const{X:D,Y:y,Z:w}=T;if(i.eql(w,i.ONE))return{x:D,y};const x=T.is0();O==null&&(O=x?i.ONE:i.inv(w));const P=i.mul(D,O),_=i.mul(y,O),$=i.mul(w,O);if(x)return{x:i.ZERO,y:i.ZERO};if(!i.eql($,i.ONE))throw new Error("invZ was invalid");return{x:P,y:_}}),C=gu(T=>{if(T.is0()){if(e.allowInfinityPoint&&!i.is0(T.Y))return;throw new Error("bad point: ZERO")}const{x:O,y:D}=T.toAffine();if(!i.isValid(O)||!i.isValid(D))throw new Error("bad point: x or y not field elements");if(!m(O,D))throw new Error("bad point: equation left != right");if(!T.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(T,O,D,y,w){return D=new B(i.mul(D.X,T),D.Y,D.Z),O=cn(y,O),D=cn(w,D),O.add(D)}class B{constructor(O,D,y){this.X=b("x",O),this.Y=b("y",D,!0),this.Z=b("z",y),Object.freeze(this)}static CURVE(){return n}static fromAffine(O){const{x:D,y}=O||{};if(!O||!i.isValid(D)||!i.isValid(y))throw new Error("invalid affine point");if(O instanceof B)throw new Error("projective point not allowed");return i.is0(D)&&i.is0(y)?B.ZERO:new B(D,y,i.ONE)}static fromBytes(O){const D=B.fromAffine(d(jr(O,void 0,"point")));return D.assertValidity(),D}static fromHex(O){return B.fromBytes(ke("pointHex",O))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(O=8,D=!0){return U.createCache(this,O),D||this.multiply(Ps),this}assertValidity(){C(this)}hasEvenY(){const{y:O}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(O)}equals(O){I(O);const{X:D,Y:y,Z:w}=this,{X:x,Y:P,Z:_}=O,$=i.eql(i.mul(D,_),i.mul(x,w)),N=i.eql(i.mul(y,_),i.mul(P,w));return $&&N}negate(){return new B(this.X,i.neg(this.Y),this.Z)}double(){const{a:O,b:D}=n,y=i.mul(D,Ps),{X:w,Y:x,Z:P}=this;let _=i.ZERO,$=i.ZERO,N=i.ZERO,j=i.mul(w,w),V=i.mul(x,x),L=i.mul(P,P),M=i.mul(w,x);return M=i.add(M,M),N=i.mul(w,P),N=i.add(N,N),_=i.mul(O,N),$=i.mul(y,L),$=i.add(_,$),_=i.sub(V,$),$=i.add(V,$),$=i.mul(_,$),_=i.mul(M,_),N=i.mul(y,N),L=i.mul(O,L),M=i.sub(j,L),M=i.mul(O,M),M=i.add(M,N),N=i.add(j,j),j=i.add(N,j),j=i.add(j,L),j=i.mul(j,M),$=i.add($,j),L=i.mul(x,P),L=i.add(L,L),j=i.mul(L,M),_=i.sub(_,j),N=i.mul(L,V),N=i.add(N,N),N=i.add(N,N),new B(_,$,N)}add(O){I(O);const{X:D,Y:y,Z:w}=this,{X:x,Y:P,Z:_}=O;let $=i.ZERO,N=i.ZERO,j=i.ZERO;const V=n.a,L=i.mul(n.b,Ps);let M=i.mul(D,x),K=i.mul(y,P),G=i.mul(w,_),Z=i.add(D,y),W=i.add(x,P);Z=i.mul(Z,W),W=i.add(M,K),Z=i.sub(Z,W),W=i.add(D,w);let J=i.add(x,_);return W=i.mul(W,J),J=i.add(M,G),W=i.sub(W,J),J=i.add(y,w),$=i.add(P,_),J=i.mul(J,$),$=i.add(K,G),J=i.sub(J,$),j=i.mul(V,W),$=i.mul(L,G),j=i.add($,j),$=i.sub(K,j),j=i.add(K,j),N=i.mul($,j),K=i.add(M,M),K=i.add(K,M),G=i.mul(V,G),W=i.mul(L,W),K=i.add(K,G),G=i.sub(M,G),G=i.mul(V,G),W=i.add(W,G),M=i.mul(K,W),N=i.add(N,M),M=i.mul(J,W),$=i.mul(Z,$),$=i.sub($,M),M=i.mul(Z,K),j=i.mul(J,j),j=i.add(j,M),new B($,N,j)}subtract(O){return this.add(O.negate())}is0(){return this.equals(B.ZERO)}multiply(O){const{endo:D}=e;if(!s.isValidNot0(O))throw new Error("invalid scalar: out of range");let y,w;const x=P=>U.cached(this,P,_=>xo(B,_));if(D){const{k1neg:P,k1:_,k2neg:$,k2:N}=A(O),{p:j,f:V}=x(_),{p:L,f:M}=x(N);w=V.add(M),y=R(D.beta,j,L,P,$)}else{const{p:P,f:_}=x(O);y=P,w=_}return xo(B,[y,w])[0]}multiplyUnsafe(O){const{endo:D}=e,y=this;if(!s.isValid(O))throw new Error("invalid scalar: out of range");if(O===Qt||y.is0())return B.ZERO;if(O===di)return y;if(U.hasCache(this))return this.multiply(O);if(D){const{k1neg:w,k1:x,k2neg:P,k2:_}=A(O),{p1:$,p2:N}=Vx(B,y,x,_);return R(D.beta,$,N,w,P)}else return U.unsafe(y,O)}multiplyAndAddUnsafe(O,D,y){const w=this.multiplyUnsafe(D).add(O.multiplyUnsafe(y));return w.is0()?void 0:w}toAffine(O){return v(this,O)}isTorsionFree(){const{isTorsionFree:O}=e;return o===di?!0:O?O(B,this):U.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:O}=e;return o===di?this:O?O(B,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(O=!0){return on(O,"isCompressed"),this.assertValidity(),p(B,this,O)}toHex(O=!0){return fi(this.toBytes(O))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(O=!0){return this.toBytes(O)}_setWindowSize(O){this.precompute(O)}static normalizeZ(O){return xo(B,O)}static msm(O,D){return Hx(B,s,O,D)}static fromPrivateKey(O){return B.BASE.multiply(ai(s,O))}}B.BASE=new B(n.Gx,n.Gy,i.ONE),B.ZERO=new B(i.ZERO,i.ONE,i.ZERO),B.Fp=i,B.Fn=s;const k=s.BITS,U=new zx(B,e.endo?Math.ceil(k/2):k);return B.BASE.precompute(8),B}function Dp(t){return Uint8Array.of(t?2:3)}function Op(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function o3(t,e={}){const{Fn:r}=t,i=e.randomBytes||Kr,s=Object.assign(Op(t.Fp,r),{seed:xp(r.ORDER)});function n(f){try{return!!ai(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:g}=s;try{const m=f.length;return p===!0&&m!==d||p===!1&&m!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(s.seed)){return Lx(jr(f,s.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(ai(r,f)).toBytes(p)}function l(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=s;if(r.allowedLengths||p===d)return;const m=ke("key",f).length;return m===d||m===g}function h(f,p,d=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const g=ai(r,f);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:n,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:n,randomPrivateKey:a,normPrivateKeyToScalar:f=>ai(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:s})}function a3(t,e,r={}){_n(e),Pn(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||Kr,s=r.hmac||((D,...y)=>Dn(e,D,br(...y))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p}=o3(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(D){const y=a>>di;return D>y}function E(D,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${D}: out of range 1..Point.Fn.ORDER`);return y}function S(D,y){Ea(y);const w=p.signature,x=y==="compact"?w:y==="recovered"?w+1:void 0;return jr(D,x,`${y} signature`)}class b{constructor(y,w,x){this.r=E("r",y),this.s=E("s",w),x!=null&&(this.recovery=x),Object.freeze(this)}static fromBytes(y,w=g){S(y,w);let x;if(w==="der"){const{r:N,s:j}=Jt.toSig(jr(y));return new b(N,j)}w==="recovered"&&(x=y[0],w="compact",y=y.subarray(1));const P=o.BYTES,_=y.subarray(0,P),$=y.subarray(P,P*2);return new b(o.fromBytes(_),o.fromBytes($),x)}static fromHex(y,w){return this.fromBytes(sn(y),w)}addRecoveryBit(y){return new b(this.r,this.s,y)}recoverPublicKey(y){const w=n.ORDER,{r:x,s:P,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*$p<w&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const $=_===2||_===3?x+a:x;if(!n.isValid($))throw new Error("recovery id 2 or 3 invalid");const N=n.toBytes($),j=t.fromBytes(br(Dp((_&1)===0),N)),V=o.inv($),L=A(ke("msgHash",y)),M=o.create(-L*V),K=o.create(P*V),G=t.BASE.multiplyUnsafe(M).add(j.multiplyUnsafe(K));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(y=g){if(Ea(y),y==="der")return sn(Jt.hexFromSig(this));const w=o.toBytes(this.r),x=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return br(Uint8Array.of(this.recovery),w,x)}return br(w,x)}toHex(y){return fi(this.toBytes(y))}assertValidity(){}static fromCompact(y){return b.fromBytes(ke("sig",y),"compact")}static fromDER(y){return b.fromBytes(ke("sig",y),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return fi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return fi(this.toBytes("compact"))}}const I=r.bits2int||function(D){if(D.length>8192)throw new Error("input is too large");const y=An(D),w=D.length*8-c;return w>0?y>>BigInt(w):y},A=r.bits2int_modN||function(D){return o.create(I(D))},v=hs(c);function C(D){return ba("num < 2^"+c,D,Qt,v),o.toBytes(D)}function R(D,y){return jr(D,void 0,"message"),y?jr(e(D),void 0,"prehashed message"):D}function B(D,y,w){if(["recovered","canonical"].some(K=>K in w))throw new Error("sign() legacy options not supported");const{lowS:x,prehash:P,extraEntropy:_}=$o(w,d);D=R(D,P);const $=A(D),N=ai(o,y),j=[C(N),C($)];if(_!=null&&_!==!1){const K=_===!0?i(p.secretKey):_;j.push(ke("extraEntropy",K))}const V=br(...j),L=$;function M(K){const G=I(K);if(!o.isValidNot0(G))return;const Z=o.inv(G),W=t.BASE.multiply(G).toAffine(),J=o.create(W.x);if(J===Qt)return;const ue=o.create(Z*o.create(L+J*N));if(ue===Qt)return;let ye=(W.x===J?0:2)|Number(W.y&di),ve=ue;return x&&m(ue)&&(ve=o.neg(ue),ye^=1),new b(J,ve,ye)}return{seed:V,k2sig:M}}function k(D,y,w={}){D=ke("message",D);const{seed:x,k2sig:P}=B(D,y,w);return Bx(e.outputLen,o.BYTES,s)(x,P)}function U(D){let y;const w=typeof D=="string"||In(D),x=!w&&D!==null&&typeof D=="object"&&typeof D.r=="bigint"&&typeof D.s=="bigint";if(!w&&!x)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(x)y=new b(D.r,D.s);else if(w){try{y=b.fromBytes(ke("sig",D),"der")}catch(P){if(!(P instanceof Jt.Err))throw P}if(!y)try{y=b.fromBytes(ke("sig",D),"compact")}catch{return!1}}return y||!1}function T(D,y,w,x={}){const{lowS:P,prehash:_,format:$}=$o(x,d);if(w=ke("publicKey",w),y=R(ke("message",y),_),"strict"in x)throw new Error("options.strict was renamed to lowS");const N=$===void 0?U(D):b.fromBytes(ke("sig",D),$);if(N===!1)return!1;try{const j=t.fromBytes(w);if(P&&N.hasHighS())return!1;const{r:V,s:L}=N,M=A(y),K=o.inv(L),G=o.create(M*K),Z=o.create(V*K),W=t.BASE.multiplyUnsafe(G).add(j.multiplyUnsafe(Z));return W.is0()?!1:o.create(W.x)===V}catch{return!1}}function O(D,y,w={}){const{prehash:x}=$o(w,d);return y=R(y,x),b.fromBytes(D,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:k,verify:T,recoverPublicKey:O,Signature:b,hash:e})}function c3(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=$r(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),n={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function l3(t){const{CURVE:e,curveOpts:r}=c3(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function u3(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,vp(r.Fn.ORDER,r.Fn.BITS))})}function h3(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:s}=l3(t),n=n3(e,r),o=a3(n,i,s);return u3(t,o)}function xa(t,e){const r=i=>h3({...t,hash:i});return{...r(e),create:r}}const Ap={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Pp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Bp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},f3=$r(Ap.p),d3=$r(Pp.p),p3=$r(Bp.p),g3=xa({...Ap,Fp:f3,lowS:!1},$n);xa({...Pp,Fp:d3,lowS:!1},xE),xa({...Bp,Fp:p3,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},EE);const y3=g3,Cp="base10",Me="base16",Ye="base64pad",vr="base64url",fs="utf8",Tp=0,tr=1,ds=2,w3=0,Iu=1,Hi=12,wc=32;function m3(){const t=va.utils.randomPrivateKey(),e=va.getPublicKey(t);return{privateKey:Xe(t,Me),publicKey:Xe(e,Me)}}function Ia(){const t=Kr(wc);return Xe(t,Me)}function b3(t,e){const r=va.getSharedSecret(pt(t,Me),pt(e,Me)),i=Ax(On,r,void 0,void 0,wc);return Xe(i,Me)}function qs(t){const e=On(pt(t,Me));return Xe(e,Me)}function ft(t){const e=On(pt(t,fs));return Xe(e,Me)}function Rp(t){return pt(`${t}`,Cp)}function Hr(t){return Number(Xe(t,Cp))}function Up(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Np(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function v3(t){const e=Rp(typeof t.type<"u"?t.type:Tp);if(Hr(e)===tr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?pt(t.senderPublicKey,Me):void 0,i=typeof t.iv<"u"?pt(t.iv,Me):Kr(Hi),s=pt(t.symKey,Me),n=cp(s,i).encrypt(pt(t.message,fs)),o=kp({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===vr?Up(o):o}function E3(t){const e=pt(t.symKey,Me),{sealed:r,iv:i}=ts({encoded:t.encoded,encoding:t.encoding}),s=cp(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Xe(s,fs)}function x3(t,e){const r=Rp(ds),i=Kr(Hi),s=pt(t,fs),n=kp({type:r,sealed:s,iv:i});return e===vr?Up(n):n}function I3(t,e){const{sealed:r}=ts({encoded:t,encoding:e});return Xe(r,fs)}function kp(t){if(Hr(t.type)===ds)return Xe(Vi([t.type,t.sealed]),Ye);if(Hr(t.type)===tr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Xe(Vi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ye)}return Xe(Vi([t.type,t.iv,t.sealed]),Ye)}function ts(t){const e=(t.encoding||Ye)===vr?Np(t.encoded):t.encoded,r=pt(e,Ye),i=r.slice(w3,Iu),s=Iu;if(Hr(i)===tr){const c=s+wc,l=c+Hi,u=r.slice(s,c),h=r.slice(c,l),f=r.slice(l);return{type:i,sealed:f,iv:h,senderPublicKey:u}}if(Hr(i)===ds){const c=r.slice(s),l=Kr(Hi);return{type:i,sealed:c,iv:l}}const n=s+Hi,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function _3(t,e){const r=ts({encoded:t,encoding:e?.encoding});return jp({type:Hr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Xe(r.senderPublicKey,Me):void 0,receiverPublicKey:e?.receiverPublicKey})}function jp(t){const e=t?.type||Tp;if(e===tr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function _u(t){return t.type===tr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Su(t){return t.type===ds}function S3(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Vi([new Uint8Array([4]),e,r])}function $3(t,e){const[r,i,s]=t.split("."),n=Buffer.from(Np(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=On(c),u=S3(e);if(!y3.verify(Vi([o,a]),l,u))throw new Error("Invalid signature");return la(t).payload}const D3="irn";function ln(t){return t?.relay||{protocol:D3}}function ci(t){const e=l2[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var O3=Object.defineProperty,A3=Object.defineProperties,P3=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,B3=Object.prototype.hasOwnProperty,C3=Object.prototype.propertyIsEnumerable,Du=(t,e,r)=>e in t?O3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Do=(t,e)=>{for(var r in e||(e={}))B3.call(e,r)&&Du(t,r,e[r]);if($u)for(var r of $u(e))C3.call(e,r)&&Du(t,r,e[r]);return t},T3=(t,e)=>A3(t,P3(e));function R3(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function Ou(t){if(!t.includes("wc:")){const l=qd(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:U3(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:R3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function U3(t){return t.startsWith("//")?t.substring(2):t}function N3(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function Au(t){const e=new URLSearchParams,r=Do(Do(T3(Do({},N3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!==void 0&&e.append(i,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Bs(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var k3=Object.defineProperty,j3=Object.defineProperties,F3=Object.getOwnPropertyDescriptors,Pu=Object.getOwnPropertySymbols,L3=Object.prototype.hasOwnProperty,M3=Object.prototype.propertyIsEnumerable,Bu=(t,e,r)=>e in t?k3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q3=(t,e)=>{for(var r in e||(e={}))L3.call(e,r)&&Bu(t,r,e[r]);if(Pu)for(var r of Pu(e))M3.call(e,r)&&Bu(t,r,e[r]);return t},z3=(t,e)=>j3(t,F3(e));function xi(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function V3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...xi(r.accounts))}),e}function H3(t,e){const r=[];return Object.values(t).forEach(i=>{xi(i.accounts).includes(e)&&r.push(...i.methods)}),r}function K3(t,e){const r=[];return Object.values(t).forEach(i=>{xi(i.accounts).includes(e)&&r.push(...i.events)}),r}function Bn(t){return t.includes(":")}function li(t){return Bn(t)?t.split(":")[0]:t}function Cu(t){var e,r,i;const s={};if(!jt(t))return s;for(const[n,o]of Object.entries(t)){const a=Bn(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=li(n);s[u]=z3(q3({},s[u]),{chains:kt(a,(e=s[u])==null?void 0:e.chains),methods:kt(c,(r=s[u])==null?void 0:r.methods),events:kt(l,(i=s[u])==null?void 0:i.events)})}return s}function W3(t){const e={};return t?.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Tu(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=W3(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=kt(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function G3(t,e){var r,i,s,n,o,a;const c=Cu(t),l=Cu(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:kt((r=c[f])==null?void 0:r.chains,(i=l[f])==null?void 0:i.chains),methods:kt((s=c[f])==null?void 0:s.methods,(n=l[f])==null?void 0:n.methods),events:kt((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const Y3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Z3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(t,e){const{message:r,code:i}=Z3[t];return{message:e?`${r} ${e}`:r,code:i}}function ce(t,e){const{message:r,code:i}=Y3[t];return{message:e?`${r} ${e}`:r,code:i}}function gt(t,e){return!!Array.isArray(t)}function jt(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function be(t){return typeof t>"u"}function ge(t,e){return e&&be(t)?!0:typeof t=="string"&&!!t.trim().length}function mc(t,e){return e&&be(t)?!0:typeof t=="number"&&!isNaN(t)}function J3(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return kr(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=xi(a),h=r[o];(!kr(kd(o,h),u)||!kr(h.methods,c)||!kr(h.events,l))&&(n=!1)}),n):!1}function un(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function X3(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&un(r)}}return!1}function Q3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const r=qd(t);return e(r)}}catch{}return!1}function eI(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function tI(t){return t?.topic}function rI(t,e){let r=null;return ge(t?.publicKey,!1)||(r=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Ru(t){let e=!0;return gt(t)?t.length&&(e=t.every(r=>ge(r,!1))):e=!1,e}function iI(t,e,r){let i=null;return gt(e)&&e.length?e.forEach(s=>{i||un(s)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):un(t)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function sI(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=iI(s,kd(s,n),`${e} ${r}`);o&&(i=o)}),i}function nI(t,e){let r=null;return gt(t)?t.forEach(i=>{r||X3(i)||(r=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function oI(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=nI(i?.accounts,`${e} namespace`);s&&(r=s)}),r}function aI(t,e){let r=null;return Ru(t?.methods)?Ru(t?.events)||(r=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Fp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=aI(i,`${e}, namespace`);s&&(r=s)}),r}function cI(t,e,r){let i=null;if(t&&jt(t)){const s=Fp(t,e);s&&(i=s);const n=sI(t,e,r);n&&(i=n)}else i=q("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Oo(t,e){let r=null;if(t&&jt(t)){const i=Fp(t,e);i&&(r=i);const s=oI(t,e);s&&(r=s)}else r=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Lp(t){return ge(t.protocol,!0)}function lI(t,e){let r=!1;return t?t&&gt(t)&&t.length&&t.forEach(i=>{r=Lp(i)}):r=!0,r}function uI(t){return typeof t=="number"}function Ke(t){return typeof t<"u"&&typeof t!==null}function hI(t){return!(!t||typeof t!="object"||!t.code||!mc(t.code,!1)||!t.message||!ge(t.message,!1))}function fI(t){return!(be(t)||!ge(t.method,!1))}function dI(t){return!(be(t)||be(t.result)&&be(t.error)||!mc(t.id,!1)||!ge(t.jsonrpc,!1))}function pI(t){return!(be(t)||!ge(t.name,!1))}function Uu(t,e){return!(!un(e)||!V3(t).includes(e))}function gI(t,e,r){return ge(r,!1)?H3(t,e).includes(r):!1}function yI(t,e,r){return ge(r,!1)?K3(t,e).includes(r):!1}function Nu(t,e,r){let i=null;const s=wI(t),n=mI(e),o=Object.keys(s),a=Object.keys(n),c=ku(Object.keys(t)),l=ku(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),kr(o,a)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=xi(e[h].accounts);f.includes(h)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(kr(s[h].methods,n[h].methods)?kr(s[h].events,n[h].events)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function wI(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function ku(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function mI(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:xi(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function bI(t,e){return mc(t,!1)&&t<=e.max&&t>=e.min}function ju(){const t=ls();return new Promise(e=>{switch(t){case nt.browser:e(vI());break;case nt.reactNative:e(EI());break;case nt.node:e(xI());break;default:e(!0)}})}function vI(){return Ei()&&navigator?.onLine}async function EI(){return Sr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function xI(){return!0}function II(t){switch(ls()){case nt.browser:_I(t);break;case nt.reactNative:SI(t);break}}function _I(t){!Sr()&&Ei()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function SI(t){Sr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function $I(){var t;return Ei()&&rr.getDocument()?((t=rr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const Ao={};class Ci{static get(e){return Ao[e]}static set(e,r){Ao[e]=r}static delete(e){delete Ao[e]}}function DI(t){const e=os.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function OI({publicKey:t,signature:e,payload:r}){var i;const s=_a(r.method),n=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=BI(r.address),a=r.era==="00"?new Uint8Array([0]):_a(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${PI(r.tip)}`),h=TI(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...s]),p=CI(f.length+1);return new Uint8Array([...p,n,...f])}function AI(t){const e=_a(t),r=d2.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function _a(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function PI(t){return t.startsWith("0x")?t.slice(2):t}function BI(t){const e=os.decode(t)[0];return e===42?0:e===60?2:1}function CI(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function TI(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function RI(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=DI(t.transaction.address),i=OI({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(i).toString("hex");return AI(s)}class Wr{}let UI=class extends Wr{constructor(e){super()}};const Fu=z.FIVE_SECONDS,Gr={pulse:"heartbeat_pulse"};let NI=class Mp extends UI{constructor(e){super(e),this.events=new wt.EventEmitter,this.interval=Fu,this.interval=e?.interval||Fu}static async init(e){const r=new Mp(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),z.toMiliseconds(this.interval))}pulse(){this.events.emit(Gr.pulse)}};const kI=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,jI=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,FI=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function LI(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){MI(t);return}return e}function MI(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Cs(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!FI.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(kI.test(t)||jI.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,LI)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function qI(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function xe(t,...e){try{return qI(t(...e))}catch(r){return Promise.reject(r)}}function zI(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function VI(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function zs(t){if(zI(t))return String(t);if(VI(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return zs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Sa="base64:";function HI(t){return typeof t=="string"?t:Sa+GI(t)}function KI(t){return typeof t!="string"||!t.startsWith(Sa)?t:WI(t.slice(Sa.length))}function WI(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function GI(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function He(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function YI(...t){return He(t.join(":"))}function Ts(t){return t=He(t),t?t+":":""}function ZI(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function JI(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const XI="memory",QI=()=>{const t=new Map;return{name:XI,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function e_(t={}){const e={mounts:{"":t.driver||QI()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=He(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Lu(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of l){const g=typeof d=="string",m=He(g?d:d.key),E=g?void 0:d.value,S=g||!d.options?u:{...u,...d.options},b=r(m);p(b).items.push({key:m,value:E,relativeKey:b.relativeKey,options:S})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=He(l);const{relativeKey:h,driver:f}=r(l);return xe(f.hasItem,h,u)},getItem(l,u={}){l=He(l);const{relativeKey:h,driver:f}=r(l);return xe(f.getItem,h,u).then(p=>Cs(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?xe(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:YI(h.base,p.key),value:Cs(p.value)}))):Promise.all(h.items.map(f=>xe(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Cs(p)})))))},getItemRaw(l,u={}){l=He(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?xe(f.getItemRaw,h,u):xe(f.getItem,h,u).then(p=>KI(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=He(l);const{relativeKey:f,driver:p}=r(l);p.setItem&&(await xe(p.setItem,f,zs(u),h),p.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return xe(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:zs(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>xe(h.driver.setItem,f.relativeKey,zs(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=He(l);const{relativeKey:f,driver:p}=r(l);if(p.setItemRaw)await xe(p.setItemRaw,f,u,h);else if(p.setItem)await xe(p.setItem,f,HI(u),h);else return;p.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=He(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await xe(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await xe(f.removeItem,h+"$",u),f.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=He(l);const{relativeKey:h,driver:f}=r(l),p=Object.create(null);if(f.getMeta&&Object.assign(p,await xe(f.getMeta,h,u)),!u.nativeOnly){const d=await xe(f.getItem,h+"$",u).then(g=>Cs(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=Ts(l);const h=i(l,!0);let f=[];const p=[];let d=!0;for(const m of h){m.driver.flags?.maxDepth||(d=!1);const E=await xe(m.driver.getKeys,m.relativeBase,u);for(const S of E){const b=m.mountpoint+He(S);f.some(I=>b.startsWith(I))||p.push(b)}f=[m.mountpoint,...f.filter(S=>!S.startsWith(m.mountpoint))]}const g=u.maxDepth!==void 0&&!d;return p.filter(m=>(!g||ZI(m,u.maxDepth))&&JI(m,l))},async clear(l,u={}){l=Ts(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return xe(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Mu(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Ts(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Lu(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=Ts(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await Mu(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=He(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=He(l),i(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Lu(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function Mu(t){typeof t.dispose=="function"&&await xe(t.dispose)}function Yr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function qp(t,e){let r;const i=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=Yr(s),r.then(n=>{n.onclose=()=>r=void 0},()=>{}),r};return(s,n)=>i().then(o=>n(o.transaction(e,s).objectStore(e)))}let Po;function ps(){return Po||(Po=qp("keyval-store","keyval")),Po}function qu(t,e=ps()){return e("readonly",r=>Yr(r.get(t)))}function t_(t,e,r=ps()){return r("readwrite",i=>(i.put(e,t),Yr(i.transaction)))}function r_(t,e=ps()){return e("readwrite",r=>(r.delete(t),Yr(r.transaction)))}function i_(t=ps()){return t("readwrite",e=>(e.clear(),Yr(e.transaction)))}function s_(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Yr(t.transaction)}function n_(t=ps()){return t("readonly",e=>{if(e.getAllKeys)return Yr(e.getAllKeys());const r=[];return s_(e,i=>r.push(i.key)).then(()=>r)})}const o_="idb-keyval";var a_=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=qp(t.dbName,t.storeName)),{name:o_,options:t,async hasItem(s){return!(typeof await qu(r(s),i)>"u")},async getItem(s){return await qu(r(s),i)??null},setItem(s,n){return t_(r(s),n,i)},removeItem(s){return r_(r(s),i)},getKeys(){return n_(i)},clear(){return i_(i)}}};const c_="WALLET_CONNECT_V2_INDEXED_DB",l_="keyvaluestorage";let u_=class{constructor(){this.indexedDb=e_({driver:a_({dbName:c_,storeName:l_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,ir(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vs={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Bo<"u"&&Bo.localStorage?Vs.exports=Bo.localStorage:typeof window<"u"&&window.localStorage?Vs.exports=window.localStorage:Vs.exports=new e})();function h_(t){var e;return[t[0],zr((e=t[1])!=null?e:"")]}let f_=class{constructor(){this.localStorage=Vs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(h_)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return zr(r)}async setItem(e,r){this.localStorage.setItem(e,ir(r))}async removeItem(e){this.localStorage.removeItem(e)}};const d_="wc_storage_version",zu=1,p_=async(t,e,r)=>{const i=d_,s=await e.getItem(i);if(s&&s>=zu){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,zu),r(e),g_(t,o)},g_=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let y_=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new f_;this.storage=e;try{const r=new u_;p_(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Co,Vu;function w_(){if(Vu)return Co;Vu=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Co=e;function e(r,i,s){var n=s&&s.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=i.length+o;if(a===1)return r;var c=new Array(a);c[0]=n(r);for(var l=1;l<a;l++)c[l]=n(i[l]);return c.join(" ")}if(typeof r!="string")return r;var u=i.length;if(u===0)return r;for(var h="",f=1-o,p=-1,d=r&&r.length||0,g=0;g<d;){if(r.charCodeAt(g)===37&&g+1<d){switch(p=p>-1?p:0,r.charCodeAt(g+1)){case 100:case 102:if(f>=u||i[f]==null)break;p<g&&(h+=r.slice(p,g)),h+=Number(i[f]),p=g+2,g++;break;case 105:if(f>=u||i[f]==null)break;p<g&&(h+=r.slice(p,g)),h+=Math.floor(Number(i[f])),p=g+2,g++;break;case 79:case 111:case 106:if(f>=u||i[f]===void 0)break;p<g&&(h+=r.slice(p,g));var m=typeof i[f];if(m==="string"){h+="'"+i[f]+"'",p=g+2,g++;break}if(m==="function"){h+=i[f].name||"<anonymous>",p=g+2,g++;break}h+=n(i[f]),p=g+2,g++;break;case 115:if(f>=u)break;p<g&&(h+=r.slice(p,g)),h+=String(i[f]),p=g+2,g++;break;case 37:p<g&&(h+=r.slice(p,g)),h+="%",p=g+2,g++,f--;break}++f}++g}return p===-1?r:(p<d&&(h+=r.slice(p)),h)}return Co}var To,Hu;function m_(){if(Hu)return To;Hu=1;const t=w_();To=s;const e=A().console||{},r={mapHttpRequest:d,mapHttpResponse:d,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:d,res:d,err:f};function i(v,C){return Array.isArray(v)?v.filter(function(B){return B!=="!stdSerializers.err"}):v===!0?Object.keys(C):!1}function s(v){v=v||{},v.browser=v.browser||{};const C=v.browser.transmit;if(C&&typeof C.send!="function")throw Error("pino: transmit option must have a send function");const R=v.browser.write||e;v.browser.write&&(v.browser.asObject=!0);const B=v.serializers||{},k=i(v.browser.serialize,B);let U=v.browser.serialize;Array.isArray(v.browser.serialize)&&v.browser.serialize.indexOf("!stdSerializers.err")>-1&&(U=!1);const T=["error","fatal","warn","info","debug","trace"];typeof R=="function"&&(R.error=R.fatal=R.warn=R.info=R.debug=R.trace=R),v.enabled===!1&&(v.level="silent");const O=v.level||"info",D=Object.create(R);D.log||(D.log=m),Object.defineProperty(D,"levelVal",{get:w}),Object.defineProperty(D,"level",{get:x,set:P});const y={transmit:C,serialize:k,asObject:v.browser.asObject,levels:T,timestamp:p(v)};D.levels=s.levels,D.level=O,D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=m,D.serializers=B,D._serialize=k,D._stdErrSerialize=U,D.child=_,C&&(D._logEvent=h());function w(){return this.level==="silent"?1/0:this.levels.values[this.level]}function x(){return this._level}function P($){if($!=="silent"&&!this.levels.values[$])throw Error("unknown level "+$);this._level=$,n(y,D,"error","log"),n(y,D,"fatal","error"),n(y,D,"warn","error"),n(y,D,"info","log"),n(y,D,"debug","log"),n(y,D,"trace","log")}function _($,N){if(!$)throw new Error("missing bindings for child Pino");N=N||{},k&&$.serializers&&(N.serializers=$.serializers);const j=N.serializers;if(k&&j){var V=Object.assign({},B,j),L=v.browser.serialize===!0?Object.keys(V):k;delete $.serializers,c([$],L,V,this._stdErrSerialize)}function M(K){this._childLevel=(K._childLevel|0)+1,this.error=l(K,$,"error"),this.fatal=l(K,$,"fatal"),this.warn=l(K,$,"warn"),this.info=l(K,$,"info"),this.debug=l(K,$,"debug"),this.trace=l(K,$,"trace"),V&&(this.serializers=V,this._serialize=L),C&&(this._logEvent=h([].concat(K._logEvent.bindings,$)))}return M.prototype=this,new M(this)}return D}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:E,epochTime:S,unixTime:b,isoTime:I});function n(v,C,R,B){const k=Object.getPrototypeOf(C);C[R]=C.levelVal>C.levels.values[R]?m:k[R]?k[R]:e[R]||e[B]||m,o(v,C,R)}function o(v,C,R){!v.transmit&&C[R]===m||(C[R]=function(B){return function(){const U=v.timestamp(),T=new Array(arguments.length),O=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<T.length;D++)T[D]=arguments[D];if(v.serialize&&!v.asObject&&c(T,this._serialize,this.serializers,this._stdErrSerialize),v.asObject?B.call(O,a(this,R,T,U)):B.apply(O,T),v.transmit){const y=v.transmit.level||C.level,w=s.levels.values[y],x=s.levels.values[R];if(x<w)return;u(this,{ts:U,methodLevel:R,methodValue:x,transmitValue:s.levels.values[v.transmit.level||C.level],send:v.transmit.send,val:C.levelVal},T)}}}(C[R]))}function a(v,C,R,B){v._serialize&&c(R,v._serialize,v.serializers,v._stdErrSerialize);const k=R.slice();let U=k[0];const T={};B&&(T.time=B),T.level=s.levels.values[C];let O=(v._childLevel|0)+1;if(O<1&&(O=1),U!==null&&typeof U=="object"){for(;O--&&typeof k[0]=="object";)Object.assign(T,k.shift());U=k.length?t(k.shift(),k):void 0}else typeof U=="string"&&(U=t(k.shift(),k));return U!==void 0&&(T.msg=U),T}function c(v,C,R,B){for(const k in v)if(B&&v[k]instanceof Error)v[k]=s.stdSerializers.err(v[k]);else if(typeof v[k]=="object"&&!Array.isArray(v[k]))for(const U in v[k])C&&C.indexOf(U)>-1&&U in R&&(v[k][U]=R[U](v[k][U]))}function l(v,C,R){return function(){const B=new Array(1+arguments.length);B[0]=C;for(var k=1;k<B.length;k++)B[k]=arguments[k-1];return v[R].apply(this,B)}}function u(v,C,R){const B=C.send,k=C.ts,U=C.methodLevel,T=C.methodValue,O=C.val,D=v._logEvent.bindings;c(R,v._serialize||Object.keys(v.serializers),v.serializers,v._stdErrSerialize===void 0?!0:v._stdErrSerialize),v._logEvent.ts=k,v._logEvent.messages=R.filter(function(y){return D.indexOf(y)===-1}),v._logEvent.level.label=U,v._logEvent.level.value=T,B(U,v._logEvent,O),v._logEvent=h(D)}function h(v){return{ts:0,messages:[],bindings:v||[],level:{label:"",value:0}}}function f(v){const C={type:v.constructor.name,msg:v.message,stack:v.stack};for(const R in v)C[R]===void 0&&(C[R]=v[R]);return C}function p(v){return typeof v.timestamp=="function"?v.timestamp:v.timestamp===!1?E:S}function d(){return{}}function g(v){return v}function m(){}function E(){return!1}function S(){return Date.now()}function b(){return Math.round(Date.now()/1e3)}function I(){return new Date(Date.now()).toISOString()}function A(){function v(C){return typeof C<"u"&&C}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return v(self)||v(window)||v(this)||{}}}return To}var oi=m_();const gs=lf(oi),b_={level:"info"},ys="custom_context",bc=1e3*1024;let v_=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Ku=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new v_(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},zp=class{constructor(e,r=bc){this.level=e??"error",this.levelValue=oi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Ku(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===oi.levels.values.error?console.error(e):r===oi.levels.values.warn?console.warn(e):r===oi.levels.values.debug?console.debug(e):r===oi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(ir({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Ku(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(ir({extraMetadata:e})),new Blob(r,{type:"application/json"})}},E_=class{constructor(e,r=bc){this.baseChunkLogger=new zp(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},x_=class{constructor(e,r=bc){this.baseChunkLogger=new zp(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var I_=Object.defineProperty,__=Object.defineProperties,S_=Object.getOwnPropertyDescriptors,Wu=Object.getOwnPropertySymbols,$_=Object.prototype.hasOwnProperty,D_=Object.prototype.propertyIsEnumerable,Gu=(t,e,r)=>e in t?I_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hn=(t,e)=>{for(var r in e||(e={}))$_.call(e,r)&&Gu(t,r,e[r]);if(Wu)for(var r of Wu(e))D_.call(e,r)&&Gu(t,r,e[r]);return t},fn=(t,e)=>__(t,S_(e));function Cn(t){return fn(hn({},t),{level:t?.level||b_.level})}function O_(t,e=ys){return t[e]||""}function A_(t,e,r=ys){return t[r]=e,t}function Qe(t,e=ys){let r="";return typeof t.bindings>"u"?r=O_(t,e):r=t.bindings().context||"",r}function P_(t,e,r=ys){const i=Qe(t,r);return i.trim()?`${i}/${e}`:e}function qe(t,e,r=ys){const i=P_(t,e,r),s=t.child({context:i});return A_(s,i,r)}function B_(t){var e,r;const i=new E_((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:gs(fn(hn({},t.opts),{level:"trace",browser:fn(hn({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function C_(t){var e;const r=new x_((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:gs(fn(hn({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function T_(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?B_(t):C_(t)}var R_=Object.defineProperty,U_=(t,e,r)=>e in t?R_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yu=(t,e,r)=>U_(t,typeof e!="symbol"?e+"":e,r);let N_=class extends Wr{constructor(e){super(),this.opts=e,Yu(this,"protocol","wc"),Yu(this,"version",2)}};var k_=Object.defineProperty,j_=(t,e,r)=>e in t?k_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,F_=(t,e,r)=>j_(t,e+"",r);let L_=class extends Wr{constructor(e,r){super(),this.core=e,this.logger=r,F_(this,"records",new Map)}},M_=class{constructor(e,r){this.logger=e,this.core=r}},q_=class extends Wr{constructor(e,r){super(),this.relayer=e,this.logger=r}},z_=class extends Wr{constructor(e){super()}},V_=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},H_=class extends Wr{constructor(e,r){super(),this.relayer=e,this.logger=r}},K_=class extends Wr{constructor(e,r){super(),this.core=e,this.logger=r}},W_=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},G_=class{constructor(e,r){this.projectId=e,this.logger=r}},Y_=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var Z_=Object.defineProperty,J_=(t,e,r)=>e in t?Z_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zu=(t,e,r)=>J_(t,typeof e!="symbol"?e+"":e,r);let X_=class{constructor(e){this.opts=e,Zu(this,"protocol","wc"),Zu(this,"version",2)}},Q_=class{constructor(e){this.client=e}};const e8="PARSE_ERROR",t8="INVALID_REQUEST",r8="METHOD_NOT_FOUND",i8="INVALID_PARAMS",Vp="INTERNAL_ERROR",vc="SERVER_ERROR",s8=[-32700,-32600,-32601,-32602,-32603],Ki={[e8]:{code:-32700,message:"Parse error"},[t8]:{code:-32600,message:"Invalid Request"},[r8]:{code:-32601,message:"Method not found"},[i8]:{code:-32602,message:"Invalid params"},[Vp]:{code:-32603,message:"Internal error"},[vc]:{code:-32e3,message:"Server error"}},Hp=vc;function n8(t){return s8.includes(t)}function Ju(t){return Object.keys(Ki).includes(t)?Ki[t]:Ki[Hp]}function o8(t){const e=Object.values(Ki).find(r=>r.code===t);return e||Ki[Hp]}function Kp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ro={},Ht={},Xu;function a8(){if(Xu)return Ht;Xu=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.isBrowserCryptoAvailable=Ht.getSubtleCrypto=Ht.getBrowerCrypto=void 0;function t(){return(Rt===null||Rt===void 0?void 0:Rt.crypto)||(Rt===null||Rt===void 0?void 0:Rt.msCrypto)||{}}Ht.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Ht.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ht.isBrowserCryptoAvailable=r,Ht}var Kt={},Qu;function c8(){if(Qu)return Kt;Qu=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.isBrowser=Kt.isNode=Kt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Kt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Kt.isNode=e;function r(){return!t()&&!e()}return Kt.isBrowser=r,Kt}var eh;function l8(){return eh||(eh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=is;e.__exportStar(a8(),t),e.__exportStar(c8(),t)}(Ro)),Ro}var u8=l8();function Ct(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Er(t=6){return BigInt(Ct(t))}function xt(t,e,r){return{id:r||Ct(),jsonrpc:"2.0",method:t,params:e}}function rs(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Tn(t,e,r){return{id:t,jsonrpc:"2.0",error:h8(e)}}function h8(t,e){return typeof t>"u"?Ju(Vp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Ju(vc)),{message:t})),n8(t.code)&&(t=o8(t.code)),t)}class f8{}class d8 extends f8{constructor(){super()}}class p8 extends d8{constructor(e){super()}}const g8="^https?:",y8="^wss?:";function w8(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Wp(t,e){const r=w8(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function th(t){return Wp(t,g8)}function rh(t){return Wp(t,y8)}function m8(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Gp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Ec(t){return Gp(t)&&"method"in t}function Rn(t){return Gp(t)&&(Tt(t)||dt(t))}function Tt(t){return"result"in t}function dt(t){return"error"in t}let xc=class extends p8{constructor(e){super(e),this.events=new wt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(xt(e.method,e.params||[],e.id||Er().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{dt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Rn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const b8=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),v8=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ih=t=>t.split("?")[0],sh=10,E8=b8();let x8=class{constructor(e){if(this.url=e,this.events=new wt.EventEmitter,this.registering=!1,!rh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ir(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!rh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=u8.isReactNative()?void 0:{rejectUnauthorized:!m8(e)},n=new E8(e,[],s);v8()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?zr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=Tn(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Kp(e,ih(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>sh&&this.events.setMaxListeners(sh)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ih(this.url)}`));return this.events.emit("register_error",r),r}};var I8={};const Yp="wc",Zp=2,$a="core",Ft=`${Yp}@2:${$a}:`,_8={logger:"error"},S8={database:":memory:"},$8="crypto",nh="client_ed25519_seed",D8=z.ONE_DAY,O8="keychain",A8="0.3",P8="messages",B8="0.3",C8=z.SIX_HOURS,T8="publisher",Jp="irn",R8="error",Xp="wss://relay.walletconnect.org",U8="relayer",he={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},N8="_subscription",at={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},k8=.1,Da="2.21.10",ae={link_mode:"link_mode",relay:"relay"},Hs={inbound:"inbound",outbound:"outbound"},j8="0.3",F8="WALLETCONNECT_CLIENT_ID",oh="WALLETCONNECT_LINK_MODE_APPS",rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},L8="subscription",M8="0.3",q8="pairing",z8="0.3",Ti={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},Rr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},V8="history",H8="0.3",K8="expirer",ut={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},W8="0.3",G8="verify-api",Y8="https://verify.walletconnect.com",Qp="https://verify.walletconnect.org",Wi=Qp,Z8=`${Wi}/v3`,J8=[Y8,Qp],X8="echo",Q8="https://echo.walletconnect.com",Bt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Gt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},gr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ri={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Ar={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ui={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},eS=.1,tS="event-client",rS=86400,iS="https://pulse.walletconnect.org/batch";function sS(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,I=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*I[C]>>>0,I[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&I[R]===0;)R++;for(var B=c.repeat(g);R<b;++R)B+=t.charAt(I[R]);return B}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var I=r[d.charCodeAt(g)];if(I===255)return;for(var A=0,v=S-1;(I!==0||A<E)&&v!==-1;v--,A++)I+=a*b[v]>>>0,b[v]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),B=m;C!==S;)R[B++]=b[C++];return R}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var nS=sS,oS=nS;const eg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},aS=t=>new TextEncoder().encode(t),cS=t=>new TextDecoder().decode(t);class lS{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class uS{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return tg(this,e)}}class hS{constructor(e){this.decoders=e}or(e){return tg(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const tg=(t,e)=>new hS({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class fS{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new lS(e,r,i),this.decoder=new uS(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Un=({name:t,prefix:e,encode:r,decode:i})=>new fS(t,e,r,i),ws=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=oS(r,e);return Un({prefix:t,name:e,encode:i,decode:n=>eg(s(n))})},dS=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pS=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Un({prefix:e,name:t,encode(s){return pS(s,i,r)},decode(s){return dS(s,i,r,t)}}),gS=Un({prefix:"\0",name:"identity",encode:t=>cS(t),decode:t=>aS(t)});var yS=Object.freeze({__proto__:null,identity:gS});const wS=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var mS=Object.freeze({__proto__:null,base2:wS});const bS=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var vS=Object.freeze({__proto__:null,base8:bS});const ES=ws({prefix:"9",name:"base10",alphabet:"0123456789"});var xS=Object.freeze({__proto__:null,base10:ES});const IS=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_S=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var SS=Object.freeze({__proto__:null,base16:IS,base16upper:_S});const $S=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),DS=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),OS=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),AS=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),PS=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),BS=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),CS=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),TS=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),RS=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var US=Object.freeze({__proto__:null,base32:$S,base32upper:DS,base32pad:OS,base32padupper:AS,base32hex:PS,base32hexupper:BS,base32hexpad:CS,base32hexpadupper:TS,base32z:RS});const NS=ws({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),kS=ws({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var jS=Object.freeze({__proto__:null,base36:NS,base36upper:kS});const FS=ws({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),LS=ws({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var MS=Object.freeze({__proto__:null,base58btc:FS,base58flickr:LS});const qS=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),zS=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),VS=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),HS=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var KS=Object.freeze({__proto__:null,base64:qS,base64pad:zS,base64url:VS,base64urlpad:HS});const rg=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),WS=rg.reduce((t,e,r)=>(t[r]=e,t),[]),GS=rg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function YS(t){return t.reduce((e,r)=>(e+=WS[r],e),"")}function ZS(t){const e=[];for(const r of t){const i=GS[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const JS=Un({prefix:"🚀",name:"base256emoji",encode:YS,decode:ZS});var XS=Object.freeze({__proto__:null,base256emoji:JS}),QS=ig,ah=128,e$=-128,t$=Math.pow(2,31);function ig(t,e,r){e=e||[],r=r||0;for(var i=r;t>=t$;)e[r++]=t&255|ah,t/=128;for(;t&e$;)e[r++]=t&255|ah,t>>>=7;return e[r]=t|0,ig.bytes=r-i+1,e}var r$=Oa,i$=128,ch=127;function Oa(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw Oa.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&ch)<<s:(o&ch)*Math.pow(2,s),s+=7}while(o>=i$);return Oa.bytes=n-i,r}var s$=Math.pow(2,7),n$=Math.pow(2,14),o$=Math.pow(2,21),a$=Math.pow(2,28),c$=Math.pow(2,35),l$=Math.pow(2,42),u$=Math.pow(2,49),h$=Math.pow(2,56),f$=Math.pow(2,63),d$=function(t){return t<s$?1:t<n$?2:t<o$?3:t<a$?4:t<c$?5:t<l$?6:t<u$?7:t<h$?8:t<f$?9:10},p$={encode:QS,decode:r$,encodingLength:d$},sg=p$;const lh=(t,e,r=0)=>(sg.encode(t,e,r),e),uh=t=>sg.encodingLength(t),Aa=(t,e)=>{const r=e.byteLength,i=uh(t),s=i+uh(r),n=new Uint8Array(s+r);return lh(t,n,0),lh(r,n,i),n.set(e,s),new g$(t,r,e,n)};class g${constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const ng=({name:t,code:e,encode:r})=>new y$(t,e,r);class y${constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Aa(this.code,r):r.then(i=>Aa(this.code,i))}else throw Error("Unknown type, must be binary type")}}const og=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),w$=ng({name:"sha2-256",code:18,encode:og("SHA-256")}),m$=ng({name:"sha2-512",code:19,encode:og("SHA-512")});var b$=Object.freeze({__proto__:null,sha256:w$,sha512:m$});const ag=0,v$="identity",cg=eg,E$=t=>Aa(ag,cg(t)),x$={code:ag,name:v$,encode:cg,digest:E$};var I$=Object.freeze({__proto__:null,identity:x$});new TextEncoder,new TextDecoder;const hh={...yS,...mS,...vS,...xS,...SS,...US,...jS,...MS,...KS,...XS};({...b$,...I$});function lg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _$(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?lg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ug(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const fh=ug("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Uo=ug("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=_$(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),S$={utf8:fh,"utf-8":fh,hex:hh.base16,latin1:Uo,ascii:Uo,binary:Uo,...hh};function $$(t,e="utf8"){const r=S$[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?lg(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var D$=Object.defineProperty,O$=(t,e,r)=>e in t?D$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,At=(t,e,r)=>O$(t,typeof e!="symbol"?e+"":e,r);class A${constructor(e,r){this.core=e,this.logger=r,At(this,"keychain",new Map),At(this,"name",O8),At(this,"version",A8),At(this,"initialized",!1),At(this,"storagePrefix",Ft),At(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),At(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),At(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),At(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),At(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=qe(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ha(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var P$=Object.defineProperty,B$=(t,e,r)=>e in t?P$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e,r)=>B$(t,typeof e!="symbol"?e+"":e,r);class C${constructor(e,r,i){this.core=e,this.logger=r,$e(this,"name",$8),$e(this,"keychain"),$e(this,"randomSessionIdentifier",Ia()),$e(this,"initialized",!1),$e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),$e(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),$e(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Ul(s);return Pd(n.publicKey)}),$e(this,"generateKeyPair",()=>{this.isInitialized();const s=m3();return this.setPrivateKey(s.publicKey,s.privateKey)}),$e(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Ul(n),a=this.randomSessionIdentifier;return await fv(a,s,D8,o)}),$e(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=b3(a,n);return this.setSymKey(c,o)}),$e(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||qs(s);return await this.keychain.set(o,s),o}),$e(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"encode",async(s,n,o)=>{this.isInitialized();const a=jp(o),c=ir(n);if(Su(a))return x3(c,o?.encoding);if(_u(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(f,p)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return v3({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),$e(this,"decode",async(s,n,o)=>{this.isInitialized();const a=_3(n,o);if(Su(a)){const c=I3(n,o?.encoding);return zr(c)}if(_u(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=E3({symKey:c,encoded:n,encoding:o?.encoding});return zr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),$e(this,"getPayloadType",(s,n=Ye)=>{const o=ts({encoded:s,encoding:n});return Hr(o.type)}),$e(this,"getPayloadSenderPublicKey",(s,n=Ye)=>{const o=ts({encoded:s,encoding:n});return o.senderPublicKey?Xe(o.senderPublicKey,Me):void 0}),this.core=e,this.logger=qe(r,this.name),this.keychain=i||new A$(this.core,this.logger)}get context(){return Qe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(nh)}catch{e=Ia(),await this.keychain.set(nh,e)}return $$(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var T$=Object.defineProperty,R$=Object.defineProperties,U$=Object.getOwnPropertyDescriptors,dh=Object.getOwnPropertySymbols,N$=Object.prototype.hasOwnProperty,k$=Object.prototype.propertyIsEnumerable,Pa=(t,e,r)=>e in t?T$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j$=(t,e)=>{for(var r in e||(e={}))N$.call(e,r)&&Pa(t,r,e[r]);if(dh)for(var r of dh(e))k$.call(e,r)&&Pa(t,r,e[r]);return t},F$=(t,e)=>R$(t,U$(e)),et=(t,e,r)=>Pa(t,typeof e!="symbol"?e+"":e,r);class L$ extends M_{constructor(e,r){super(e,r),this.logger=e,this.core=r,et(this,"messages",new Map),et(this,"messagesWithoutClientAck",new Map),et(this,"name",P8),et(this,"version",B8),et(this,"initialized",!1),et(this,"storagePrefix",Ft),et(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),et(this,"set",async(i,s,n)=>{this.isInitialized();const o=ft(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===Hs.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,F$(j$({},c),{[o]:s}))}return await this.persist(),o}),et(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),et(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),et(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=ft(s);return typeof n[o]<"u"}),et(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=ft(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),et(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=qe(e,this.name),this.core=r}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ha(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ha(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fa(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?fa(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var M$=Object.defineProperty,q$=Object.defineProperties,z$=Object.getOwnPropertyDescriptors,ph=Object.getOwnPropertySymbols,V$=Object.prototype.hasOwnProperty,H$=Object.prototype.propertyIsEnumerable,Ba=(t,e,r)=>e in t?M$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ri=(t,e)=>{for(var r in e||(e={}))V$.call(e,r)&&Ba(t,r,e[r]);if(ph)for(var r of ph(e))H$.call(e,r)&&Ba(t,r,e[r]);return t},gh=(t,e)=>q$(t,z$(e)),ct=(t,e,r)=>Ba(t,typeof e!="symbol"?e+"":e,r);class K$ extends q_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ct(this,"events",new wt.EventEmitter),ct(this,"name",T8),ct(this,"queue",new Map),ct(this,"publishTimeout",z.toMiliseconds(z.ONE_MINUTE)),ct(this,"initialPublishTimeout",z.toMiliseconds(z.ONE_SECOND*15)),ct(this,"needsTransportRestart",!1),ct(this,"publish",async(i,s,n)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const h=n?.ttl||C8,f=n?.prompt||!1,p=n?.tag||0,d=n?.id||Er().toString(),g=ci(ln().protocol),m={id:d,method:n?.publishMethod||g.publish,params:ri({topic:i,message:s,ttl:h,prompt:f,tag:p,attestation:n?.attestation},n?.tvf)},E=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{be((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),be((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const S=new Promise(async b=>{const I=({id:v})=>{var C;((C=m.id)==null?void 0:C.toString())===v.toString()&&(this.removeRequestFromQueue(v),this.relayer.events.removeListener(he.publish,I),b())};this.relayer.events.on(he.publish,I);const A=Nt(new Promise((v,C)=>{this.rpcPublish(m,n).then(v).catch(R=>{this.logger.warn(R,R?.message),C(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await A,this.events.removeListener(he.publish,I)}catch(v){this.queue.set(d,{request:m,opts:n,attempt:1}),this.logger.warn(v,v?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:s,opts:n}}),await Nt(S,this.publishTimeout,E)}catch(S){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(S),(u=n?.internal)!=null&&u.throwOnFailedPublish)throw S}finally{this.queue.delete(d)}}),ct(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:m=z.FIVE_MINUTES}=u,E=u.id||Er().toString(),S=ci(ln().protocol),b=p||S.publish,I={id:E,method:b,params:ri(gh(ri({},l),{ttl:m,prompt:d,tag:g,attestation:h}),f)},A=`Failed to publish custom payload, please try again. id:${E} tag:${g}`;try{be((s=I.params)==null?void 0:s.prompt)&&((n=I.params)==null||delete n.prompt),be((o=I.params)==null?void 0:o.tag)&&((a=I.params)==null||delete a.tag);const v=new Promise(async C=>{const R=({id:k})=>{var U;((U=I.id)==null?void 0:U.toString())===k.toString()&&(this.removeRequestFromQueue(k),this.relayer.events.removeListener(he.publish,R),C())};this.relayer.events.on(he.publish,R);const B=Nt(new Promise((k,U)=>{this.rpcPublish(I,u).then(k).catch(T=>{this.logger.warn(T,T?.message),U(T)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${E} tag:${g}`);try{await B,this.events.removeListener(he.publish,R)}catch(k){this.queue.set(E,{request:I,opts:u,attempt:1}),this.logger.warn(k,k?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:E,payload:l,opts:u}}),await Nt(v,this.publishTimeout,A)}catch(v){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(v),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw v}finally{this.queue.delete(E)}}),ct(this,"on",(i,s)=>{this.events.on(i,s)}),ct(this,"once",(i,s)=>{this.events.once(i,s)}),ct(this,"off",(i,s)=>{this.events.off(i,s)}),ct(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=qe(r,this.name),this.registerEventListeners()}get context(){return Qe(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(he.publish,ri(ri({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const s=e.attempt+1;this.queue.set(r,gh(ri({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Gr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(he.connection_stalled);return}this.checkQueue()}),this.relayer.on(he.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var W$=Object.defineProperty,G$=(t,e,r)=>e in t?W$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ii=(t,e,r)=>G$(t,typeof e!="symbol"?e+"":e,r);class Y${constructor(){ii(this,"map",new Map),ii(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),ii(this,"get",e=>this.map.get(e)||[]),ii(this,"exists",(e,r)=>this.get(e).includes(r)),ii(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),ii(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Z$=Object.defineProperty,J$=Object.defineProperties,X$=Object.getOwnPropertyDescriptors,yh=Object.getOwnPropertySymbols,Q$=Object.prototype.hasOwnProperty,eD=Object.prototype.propertyIsEnumerable,Ca=(t,e,r)=>e in t?Z$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ni=(t,e)=>{for(var r in e||(e={}))Q$.call(e,r)&&Ca(t,r,e[r]);if(yh)for(var r of yh(e))eD.call(e,r)&&Ca(t,r,e[r]);return t},No=(t,e)=>J$(t,X$(e)),ne=(t,e,r)=>Ca(t,typeof e!="symbol"?e+"":e,r);class tD extends H_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ne(this,"subscriptions",new Map),ne(this,"topicMap",new Y$),ne(this,"events",new wt.EventEmitter),ne(this,"name",L8),ne(this,"version",M8),ne(this,"pending",new Map),ne(this,"cached",[]),ne(this,"initialized",!1),ne(this,"storagePrefix",Ft),ne(this,"subscribeTimeout",z.toMiliseconds(z.ONE_MINUTE)),ne(this,"initialSubscribeTimeout",z.toMiliseconds(z.ONE_SECOND*15)),ne(this,"clientId"),ne(this,"batchSubscribeTopicsLimit",500),ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ne(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=ln(s),a={topic:i,relay:o,transportType:s?.transportType};(n=s?.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ne(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ne(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ne(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ne(this,"on",(i,s)=>{this.events.on(i,s)}),ne(this,"once",(i,s)=>{this.events.once(i,s)}),ne(this,"off",(i,s)=>{this.events.off(i,s)}),ne(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ne(this,"start",async()=>{await this.onConnect()}),ne(this,"stop",async()=>{await this.onDisconnect()}),ne(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ne(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Gr.pulse,async()=>{await this.checkPending()}),this.events.on(rt.created,async i=>{const s=rt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(rt.deleted,async i=>{const s=rt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=qe(r,this.name),this.clientId=""}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=ln(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i?.internal)!=null&&s.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ci(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i?.internal)==null?void 0:n.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},z.toMiliseconds(z.ONE_SECOND)),o;const l=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(rt.created,f),h(p.id))};this.events.on(rt.created,f);try{const p=await Nt(new Promise((d,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rt.created,f),h(p)}catch{}}),u=await Nt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(he.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ci(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Nt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(he.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ci(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Nt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(he.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:ci(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,No(Ni({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ni({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ni({},r)),this.topicMap.set(r.topic,e),this.events.emit(rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(rt.deleted,No(Ni({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>No(Ni({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await L2(z.toMiliseconds(z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ft(e+await this.getClientId())}}var rD=Object.defineProperty,wh=Object.getOwnPropertySymbols,iD=Object.prototype.hasOwnProperty,sD=Object.prototype.propertyIsEnumerable,Ta=(t,e,r)=>e in t?rD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mh=(t,e)=>{for(var r in e||(e={}))iD.call(e,r)&&Ta(t,r,e[r]);if(wh)for(var r of wh(e))sD.call(e,r)&&Ta(t,r,e[r]);return t},te=(t,e,r)=>Ta(t,typeof e!="symbol"?e+"":e,r);class nD extends z_{constructor(e){super(e),te(this,"protocol","wc"),te(this,"version",2),te(this,"core"),te(this,"logger"),te(this,"events",new wt.EventEmitter),te(this,"provider"),te(this,"messages"),te(this,"subscriber"),te(this,"publisher"),te(this,"name",U8),te(this,"transportExplicitlyClosed",!1),te(this,"initialized",!1),te(this,"connectionAttemptInProgress",!1),te(this,"relayUrl"),te(this,"projectId"),te(this,"packageName"),te(this,"bundleId"),te(this,"hasExperiencedNetworkDisruption",!1),te(this,"pingTimeout"),te(this,"heartBeatTimeout",z.toMiliseconds(z.THIRTY_SECONDS+z.FIVE_SECONDS)),te(this,"reconnectTimeout"),te(this,"connectPromise"),te(this,"reconnectInProgress",!1),te(this,"requestsInFlight",[]),te(this,"connectTimeout",z.toMiliseconds(z.ONE_SECOND*15)),te(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const n=r.id||Er().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),te(this,"resetPingTimeout",()=>{rn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),te(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),te(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(he.connect)}),te(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),te(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(he.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),te(this,"registerProviderListeners",()=>{this.provider.on(at.payload,this.onPayloadHandler),this.provider.on(at.connect,this.onConnectHandler),this.provider.on(at.disconnect,this.onDisconnectHandler),this.provider.on(at.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?qe(e.logger,this.name):gs(Cn({level:e.logger||R8})),this.messages=new L$(this.logger,e.core),this.subscriber=new tD(this,this.logger),this.publisher=new K$(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Xp,_2()?this.packageName=Kl():S2()&&(this.bundleId=Kl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Qe(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Hs.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(rt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(rt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,mh({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Nt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ju())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=pe(z.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(he.message,e),await this.recordMessageEvent(e,Hs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(at.disconnect,n),await Nt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(at.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(at.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(at.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(rn())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new xc(new x8(P2({sdkVersion:Da,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ec(e)){if(!e.method.endsWith(N8))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(mh({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Rn(e)&&this.events.emit(he.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Hs.inbound),this.events.emit(he.message,e))}async acknowledgePayload(e){const r=rs(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(at.payload,this.onPayloadHandler),this.provider.off(at.connect,this.onConnectHandler),this.provider.off(at.disconnect,this.onDisconnectHandler),this.provider.off(at.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await ju();II(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Gr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&$I())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(he.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},z.toMiliseconds(k8)))))}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function oD(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function bh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function vh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const aD="[object RegExp]",cD="[object String]",lD="[object Number]",uD="[object Boolean]",Eh="[object Arguments]",hD="[object Symbol]",fD="[object Date]",dD="[object Map]",pD="[object Set]",gD="[object Array]",yD="[object Function]",wD="[object ArrayBuffer]",ko="[object Object]",mD="[object Error]",bD="[object DataView]",vD="[object Uint8Array]",ED="[object Uint8ClampedArray]",xD="[object Uint16Array]",ID="[object Uint32Array]",_D="[object BigUint64Array]",SD="[object Int8Array]",$D="[object Int16Array]",DD="[object Int32Array]",OD="[object BigInt64Array]",AD="[object Float32Array]",PD="[object Float64Array]";function BD(){}function xh(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function CD(t,e,r){return qi(t,e,void 0,void 0,void 0,void 0,r)}function qi(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Gi(t,e,n,o)}return Gi(t,e,n,o)}function Gi(t,e,r,i){if(Object.is(t,e))return!0;let s=vh(t),n=vh(e);if(s===Eh&&(s=ko),n===Eh&&(n=ko),s!==n)return!1;switch(s){case cD:return t.toString()===e.toString();case lD:{const c=t.valueOf(),l=e.valueOf();return oD(c,l)}case uD:case fD:case hD:return Object.is(t.valueOf(),e.valueOf());case aD:return t.source===e.source&&t.flags===e.flags;case yD:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case dD:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!qi(l,e.get(c),c,t,e,r,i))return!1;return!0}case pD:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(p=>qi(h,p,void 0,t,e,r,i));if(f===-1)return!1;l.splice(f,1)}return!0}case gD:case vD:case ED:case xD:case ID:case _D:case SD:case $D:case DD:case OD:case AD:case PD:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!qi(t[c],e[c],c,t,e,r,i))return!1;return!0}case wD:return t.byteLength!==e.byteLength?!1:Gi(new Uint8Array(t),new Uint8Array(e),r,i);case bD:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Gi(new Uint8Array(t),new Uint8Array(e),r,i);case mD:return t.name===e.name&&t.message===e.message;case ko:{if(!(Gi(t.constructor,e.constructor,r,i)||xh(t)&&xh(e)))return!1;const c=[...Object.keys(t),...bh(t)],l=[...Object.keys(e),...bh(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!qi(f,p,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function TD(t,e){return CD(t,e,BD)}var RD=Object.defineProperty,Ih=Object.getOwnPropertySymbols,UD=Object.prototype.hasOwnProperty,ND=Object.prototype.propertyIsEnumerable,Ra=(t,e,r)=>e in t?RD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_h=(t,e)=>{for(var r in e||(e={}))UD.call(e,r)&&Ra(t,r,e[r]);if(Ih)for(var r of Ih(e))ND.call(e,r)&&Ra(t,r,e[r]);return t},Ve=(t,e,r)=>Ra(t,typeof e!="symbol"?e+"":e,r);class Zr extends V_{constructor(e,r,i,s=Ft,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Ve(this,"map",new Map),Ve(this,"version",j8),Ve(this,"cached",[]),Ve(this,"initialized",!1),Ve(this,"getKey"),Ve(this,"storagePrefix",Ft),Ve(this,"recentlyDeleted",[]),Ve(this,"recentlyDeletedLimit",200),Ve(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!be(o)?this.map.set(this.getKey(o),o):eI(o)?this.map.set(o.id,o):tI(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ve(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ve(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ve(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>TD(a[c],o[c]))):this.values)),Ve(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=_h(_h({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ve(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=qe(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=q("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kD=Object.defineProperty,jD=(t,e,r)=>e in t?kD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>jD(t,typeof e!="symbol"?e+"":e,r);class FD{constructor(e,r){this.core=e,this.logger=r,X(this,"name",q8),X(this,"version",z8),X(this,"events",new qa),X(this,"pairings"),X(this,"initialized",!1),X(this,"storagePrefix",Ft),X(this,"ignoredPayloadTypes",[tr]),X(this,"registeredMethods",[]),X(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),X(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),X(this,"create",async i=>{this.isInitialized();const s=Ia(),n=await this.core.crypto.setSymKey(s),o=pe(z.FIVE_MINUTES),a={protocol:Jp},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},l=Au({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Rr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType,internal:i?.internal}),{topic:n,uri:l}}),X(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Bt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Ou(i.uri);s.props.properties.topic=n,s.addTrace(Bt.pairing_uri_validation_success),s.addTrace(Bt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(Bt.existing_pairing),u.active)throw s.setError(Gt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Bt.pairing_not_expired)}const h=c||pe(z.FIVE_MINUTES),f={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,f),s.addTrace(Bt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Rr.create,f),s.addTrace(Bt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Bt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Gt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(p){throw s.setError(Gt.subscribe_pairing_topic_failure),p}return s.addTrace(Bt.subscribe_pairing_topic_success),f}),X(this,"activate",async({topic:i})=>{this.isInitialized();const s=pe(z.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),X(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Br();this.events.once(re("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),X(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),X(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),X(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),X(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(s))}),X(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return Au({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),X(this,"sendRequest",async(i,s,n)=>{const o=xt(s,n),a=await this.core.crypto.encode(i,o),c=Ti[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),X(this,"sendResult",async(i,s,n)=>{const o=rs(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ti[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"sendError",async(i,s,n)=>{const o=Tn(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ti[c]?Ti[c].res:Ti.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),X(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Ut(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),X(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),X(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),X(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Rr.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{Tt(s)?this.events.emit(re("pairing_ping",n),{}):dt(s)&&this.events.emit(re("pairing_ping",n),{error:s.error})},500)}),X(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Rr.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),X(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",i))}),X(this,"isValidPair",(i,s)=>{var n;if(!Ke(i)){const{message:a}=q("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Gt.malformed_pairing_uri),new Error(a)}if(!Q3(i.uri)){const{message:a}=q("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Gt.malformed_pairing_uri),new Error(a)}const o=Ou(i?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Gt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Gt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&z.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(Gt.pairing_expired);const{message:a}=q("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),X(this,"isValidPing",async i=>{if(!Ke(i)){const{message:n}=q("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidDisconnect",async i=>{if(!Ke(i)){const{message:n}=q("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidPairingTopic",async i=>{if(!ge(i,!1)){const{message:s}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=q("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=qe(r,this.name),this.pairings=new Zr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Qe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(he.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);Ec(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):Rn(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(ut.expired,async e=>{const{topic:r}=Md(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Rr.expire,{topic:r}))})}}var LD=Object.defineProperty,MD=(t,e,r)=>e in t?LD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>MD(t,typeof e!="symbol"?e+"":e,r);class qD extends L_{constructor(e,r){super(e,r),this.core=e,this.logger=r,De(this,"records",new Map),De(this,"events",new wt.EventEmitter),De(this,"name",V8),De(this,"version",H8),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",Ft),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:pe(z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(bt.created,o)}),De(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=dt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(bt.updated,s))}),De(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),De(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(bt.deleted,n)}}),this.persist()}),De(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),De(this,"on",(i,s)=>{this.events.on(i,s)}),De(this,"once",(i,s)=>{this.events.once(i,s)}),De(this,"off",(i,s)=>{this.events.off(i,s)}),De(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=qe(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:xt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Gr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(bt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zD=Object.defineProperty,VD=(t,e,r)=>e in t?zD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e,r)=>VD(t,typeof e!="symbol"?e+"":e,r);class HD extends K_{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ue(this,"expirations",new Map),Ue(this,"events",new wt.EventEmitter),Ue(this,"name",K8),Ue(this,"version",W8),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Ft),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Ue(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(ut.created,{target:n,expiration:o})}),Ue(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Ue(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ut.deleted,{target:s,expiration:n})}}),Ue(this,"on",(i,s)=>{this.events.on(i,s)}),Ue(this,"once",(i,s)=>{this.events.once(i,s)}),Ue(this,"off",(i,s)=>{this.events.off(i,s)}),Ue(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=qe(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return B2(e);if(typeof e=="number")return C2(e);const{message:r}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ut.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ut.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Gr.pulse,()=>this.checkExpirations()),this.events.on(ut.created,e=>{const r=ut.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.expired,e=>{const r=ut.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.deleted,e=>{const r=ut.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var KD=Object.defineProperty,WD=(t,e,r)=>e in t?KD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,de=(t,e,r)=>WD(t,typeof e!="symbol"?e+"":e,r);class GD extends W_{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,de(this,"name",G8),de(this,"abortController"),de(this,"isDevEnv"),de(this,"verifyUrlV3",Z8),de(this,"storagePrefix",Ft),de(this,"version",Zp),de(this,"publicKey"),de(this,"fetchPromise"),de(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&z.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),de(this,"register",async s=>{if(!Ei()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=rr.getDocument(),u=this.startAbortTimer(z.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",m),l.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const m=E=>{if(E.data&&typeof E.data=="string")try{const S=JSON.parse(E.data);if(S.type==="verify_attestation"){if(la(S.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),f(S.attestation===null?"":S.attestation)}}catch(S){this.logger.warn(S)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),de(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(la(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),de(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(z.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),de(this,"getVerifyUrl",s=>{let n=s||Wi;return J8.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Wi}`),n=Wi),n}),de(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(z.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),de(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),de(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),de(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),de(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),de(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),de(this,"validateAttestation",(s,n)=>{const o=$3(s,n.publicKey),a={hasExpired:z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=qe(r,this.name),this.abortController=new AbortController,this.isDevEnv=ac(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Qe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(e))}}var YD=Object.defineProperty,ZD=(t,e,r)=>e in t?YD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sh=(t,e,r)=>ZD(t,typeof e!="symbol"?e+"":e,r);class JD extends G_{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Sh(this,"context",X8),Sh(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${Q8}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=qe(r,this.context)}}var XD=Object.defineProperty,$h=Object.getOwnPropertySymbols,QD=Object.prototype.hasOwnProperty,eO=Object.prototype.propertyIsEnumerable,Ua=(t,e,r)=>e in t?XD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ki=(t,e)=>{for(var r in e||(e={}))QD.call(e,r)&&Ua(t,r,e[r]);if($h)for(var r of $h(e))eO.call(e,r)&&Ua(t,r,e[r]);return t},Ee=(t,e,r)=>Ua(t,typeof e!="symbol"?e+"":e,r);class tO extends Y_{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",tS),Ee(this,"storagePrefix",Ft),Ee(this,"storageVersion",eS),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!ac())try{const s={eventId:Gl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Fd(this.core.relayer.protocol,this.core.relayer.version,Da)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ee(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Gl(),u=this.core.projectId||"",h=Date.now(),f=ki({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ee(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ki(ki({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Gr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{z.fromMiliseconds(Date.now())-z.fromMiliseconds(s.timestamp)>rS&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),Ee(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,ki(ki({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Ee(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${iS}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Da}${n}`,{method:"POST",body:JSON.stringify(s)})}),Ee(this,"getAppDomain",()=>jd().url),this.logger=qe(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var rO=Object.defineProperty,Dh=Object.getOwnPropertySymbols,iO=Object.prototype.hasOwnProperty,sO=Object.prototype.propertyIsEnumerable,Na=(t,e,r)=>e in t?rO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oh=(t,e)=>{for(var r in e||(e={}))iO.call(e,r)&&Na(t,r,e[r]);if(Dh)for(var r of Dh(e))sO.call(e,r)&&Na(t,r,e[r]);return t},oe=(t,e,r)=>Na(t,typeof e!="symbol"?e+"":e,r);let nO=class hg extends N_{constructor(e){var r;super(e),oe(this,"protocol",Yp),oe(this,"version",Zp),oe(this,"name",$a),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new wt.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Xp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Cn({level:typeof e?.logger=="string"&&e.logger?e.logger:_8.logger,name:$a}),{logger:n,chunkLoggerController:o}=T_({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=qe(n,this.name),this.heartbeat=new NI,this.crypto=new C$(this,this.logger,e?.keychain),this.history=new qD(this,this.logger),this.expirer=new HD(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new y_(Oh(Oh({},S8),e?.storageOptions)),this.relayer=new nD({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new FD(this,this.logger),this.verify=new GD(this,this.logger,this.storage),this.echoClient=new JD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new tO(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new hg(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(F8,i),r}get context(){return Qe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(oh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(oh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&I8.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const oO=nO,fg="wc",dg=2,pg="client",Ic=`${fg}@${dg}:${pg}:`,jo={name:pg,logger:"error"},Ah="WALLETCONNECT_DEEPLINK_CHOICE",aO="proposal",Ph="Proposal expired",cO="session",si=z.SEVEN_DAYS,lO="engine",Oe={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1119}}},Fo={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},Pt={idle:"IDLE",active:"ACTIVE"},uO={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},hO="request",fO=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],dO="wc",pO="auth",gO="authKeys",yO="pairingTopics",wO="requests",Nn=`${dO}@${1.5}:${pO}:`,Ks=`${Nn}:PUB_KEY`;var mO=Object.defineProperty,bO=Object.defineProperties,vO=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,EO=Object.prototype.hasOwnProperty,xO=Object.prototype.propertyIsEnumerable,ka=(t,e,r)=>e in t?mO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ie=(t,e)=>{for(var r in e||(e={}))EO.call(e,r)&&ka(t,r,e[r]);if(Bh)for(var r of Bh(e))xO.call(e,r)&&ka(t,r,e[r]);return t},Ne=(t,e)=>bO(t,vO(e)),F=(t,e,r)=>ka(t,typeof e!="symbol"?e+"":e,r);class IO extends Q_{constructor(e){super(e),F(this,"name",lO),F(this,"events",new qa),F(this,"initialized",!1),F(this,"requestQueue",{state:Pt.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Pt.idle,queue:[]}),F(this,"emittedSessionRequests",new M2({limit:500})),F(this,"requestQueueDelay",z.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Oe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Ne(ie({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=G3(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let u=s,h,f=!1;try{if(u){const v=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=v.active}}catch(v){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),v}if(!u||!f){const{topic:v,uri:C}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=v,h=C}if(!u){const{message:v}=q("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(v)}const p=await this.client.core.crypto.generateKeyPair(),d=Oe.wc_sessionPropose.req.ttl||z.FIVE_MINUTES,g=pe(d),m=Ne(ie(ie({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:Jp}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Ct()}),E=re("session_connect",m.id),{reject:S,resolve:b,done:I}=Br(d,Ph),A=({id:v})=>{v===m.id&&(this.client.events.off("proposal_expire",A),this.pendingSessions.delete(m.id),this.events.emit(E,{error:{message:Ph,code:0}}))};return this.client.events.on("proposal_expire",A),this.events.once(E,({error:v,session:C})=>{this.client.events.off("proposal_expire",A),v?S(v):C&&b(C)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:I}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),F(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[gr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(B){throw o.setError(Ri.no_internet_connection),B}try{await this.isValidProposalId(r?.id)}catch(B){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Ri.proposal_not_found),B}try{await this.isValidApprove(r)}catch(B){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ri.session_approve_namespace_validation_failure),B}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:g,requiredNamespaces:m,optionalNamespaces:E}=p;let S=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});S||(S=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:gr.session_approve_started,properties:{topic:d,trace:[gr.session_approve_started,gr.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),I=g.publicKey,A=await this.client.core.crypto.generateSharedKey(b,I),v=ie(ie(ie({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(si)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),C=ae.relay;S.addTrace(gr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(A,{transportType:C,internal:{skipSubscribe:!0}})}catch(B){throw S.setError(Ri.subscribe_session_topic_failure),B}S.addTrace(gr.subscribe_session_topic_success);const R=Ne(ie({},v),{topic:A,requiredNamespaces:m,optionalNamespaces:E,pairingTopic:d,acknowledged:!1,self:v.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:ae.relay});await this.client.session.set(A,R),S.addTrace(gr.store_session);try{await this.sendApproveSession({sessionTopic:A,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),S.addTrace(gr.session_approve_publish_success)}catch(B){throw this.client.logger.error(B),this.client.session.delete(A,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(A),B}return this.client.core.eventClient.deleteEvent({eventId:S.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(A,pe(si)),{topic:A,acknowledged:()=>Promise.resolve(this.client.session.get(A))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:Oe.wc_sessionPropose.reject}),await this.deleteProposal(i)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Br(),c=Ct(),l=Er().toString(),u=this.client.session.get(i).namespaces;return this.events.once(re("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:n}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Ct(),{done:n,resolve:o,reject:a}=Br();return this.events.once(re("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,pe(si)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:s,topic:n,expiry:o=Oe.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=Ct(),l=Er().toString(),{done:u,resolve:h,reject:f}=Br(o,"Request expired. Please try again.");this.events.once(re("session_request",c),({error:m,result:E})=>{m?f(m):h(E)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:p,params:{request:Ne(ie({},s),{expiryTimestamp:pe(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const g={request:Ne(ie({},s),{expiryTimestamp:pe(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(E=>f(E)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),m()}),new Promise(async m=>{var E;if(!((E=a.sessionConfig)!=null&&E.disableDeepLink)){const S=await N2(this.client.core.storage,Ah);await T2({id:c,topic:n,wcDeepLink:S})}m()}),u()]).then(m=>m[2])}),F(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Tt(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):dt(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(r)}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Ct(),n=Er().toString(),{done:o,resolve:a,reject:c}=Br();this.events.once(re("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=Er().toString(),a=Ct();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=q("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>J3(i,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:m}=r,E=[...r.resources||[]],{topic:S,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:S,uri:b}});const I=await this.client.core.crypto.generateKeyPair(),A=qs(I);if(await Promise.all([this.client.auth.authKeys.set(Ks,{responseTopic:A,publicKey:I}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:S})]),await this.client.core.relayer.subscribe(A,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${S}`),g.length>0){const{namespace:_}=er(a[0]);let $=XE(_,"request",g);Ms(E)&&($=ex($,E.pop())),E.push($)}const v=m&&m>Oe.wc_sessionAuthenticate.req.ttl?m:Oe.wc_sessionAuthenticate.req.ttl,C={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:E},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:pe(v)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},B={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:S,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:pe(Oe.wc_sessionPropose.req.ttl),id:Ct()},{done:k,resolve:U,reject:T}=Br(v,"Request expired"),O=Ct(),D=re("session_connect",B.id),y=re("session_request",O),w=async({error:_,session:$})=>{this.events.off(y,x),_?T(_):$&&U({session:$})},x=async _=>{var $,N,j;if(await this.deletePendingAuthRequest(O,{message:"fulfilled",code:0}),_.error){const W=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===W.code?void 0:(this.events.off(D,w),T(_.error.message))}await this.deleteProposal(B.id),this.events.off(D,w);const{cacaos:V,responder:L}=_.result,M=[],K=[];for(const W of V){await nu({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),T(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:J}=W,ue=Ms(J.resources),ye=[da(J.iss)],ve=nn(J.iss);if(ue){const je=ou(ue),St=au(ue);M.push(...je),ye.push(...St)}for(const je of ye)K.push(`${je}:${ve}`)}const G=await this.client.core.crypto.generateSharedKey(I,L.publicKey);let Z;M.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:L,controller:L.publicKey,expiry:pe(si),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:S,namespaces:Tu([...new Set(M)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:L.metadata}),Z=this.client.session.get(G)),($=this.client.metadata.redirect)!=null&&$.linkMode&&(N=L.metadata.redirect)!=null&&N.linkMode&&(j=L.metadata.redirect)!=null&&j.universal&&i&&(this.client.core.addLinkModeSupportedApp(L.metadata.redirect.universal),this.client.session.update(G,{transportType:ae.link_mode})),U({auths:V,session:Z})};this.events.once(D,w),this.events.once(y,x);let P;try{if(n){const _=xt("wc_sessionAuthenticate",C,O);this.client.core.history.set(S,_);const $=await this.client.core.crypto.encode("",_,{type:ds,encoding:vr});P=Bs(i,S,$)}else await Promise.all([this.sendRequest({topic:S,method:"wc_sessionAuthenticate",params:C,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:O}),this.sendRequest({topic:S,method:"wc_sessionPropose",params:B,expiry:Oe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(_){throw this.events.off(D,w),this.events.off(y,x),_}return await this.setProposal(B.id,B),await this.setAuthRequest(O,{request:Ne(ie({},C),{verifyContext:{}}),pairingTopic:S,transportType:o}),{uri:P??b,response:k}}),F(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Ar.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw n.setError(Ui.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(Ui.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=qs(c),h={type:tr,receiverPublicKey:c,senderPublicKey:l},f=[],p=[];for(const m of s){if(!await nu({cacao:m,projectId:this.client.core.projectId})){n.setError(Ui.invalid_cacao);const A=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:A,encodeOpts:h}),new Error(A.message)}n.addTrace(Ar.cacaos_verified);const{p:E}=m,S=Ms(E.resources),b=[da(E.iss)],I=nn(E.iss);if(S){const A=ou(S),v=au(S);f.push(...A),b.push(...v)}for(const A of b)p.push(`${A}:${I}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Ar.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(si),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Tu([...new Set(f)],[...new Set(p)]),transportType:a},n.addTrace(Ar.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(m){throw n.setError(Ui.subscribe_authenticated_session_topic_failure),m}n.addTrace(Ar.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),n.addTrace(Ar.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Ar.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw n.setError(Ui.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=qs(o),l={type:tr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:Oe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return ip(i,s)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),F(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Ah).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,ce("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Pt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),F(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Ri.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ce("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=Pt.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),F(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,pe(Oe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),F(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||pe(Oe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,p=xt(s,n,c);let d;const g=!!u;try{const S=g?vr:Ye;d=await this.client.core.crypto.encode(i,p,{encoding:S})}catch(S){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),S}let m;if(fO.includes(s)){const S=ft(JSON.stringify(p)),b=ft(d);m=await this.client.core.verify.register({id:b,decryptedId:S})}const E=ie(ie({},Oe[s].req),f);if(E.attestation=m,o&&(E.ttl=o),a&&(E.id=a),this.client.core.history.set(i,p),g){const S=Bs(u,i,d);await global.Linking.openURL(S,this.client.name)}else E.tvf=Ne(ie({},h),{correlationId:p.id}),l?(E.internal=Ne(ie({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,E)):this.client.core.relayer.publish(i,d,E).catch(S=>this.client.logger.error(S));return p.id}),F(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:s}=r,n=xt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:Ye}),a=ft(JSON.stringify(n)),c=ft(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Ne(ie({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=r,c=rs(n.id,s),l=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:Ye}),u=xt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(i,u,{encoding:Ye});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Ne(ie({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=rs(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?vr:Ye;u=await this.client.core.crypto.encode(s,l,Ne(ie({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),d}let f,p;try{f=await this.client.core.history.get(s,i);const d=f.request;try{p=this.getTVFParams(i,d.params,n)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),d}if(h){const d=Bs(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Oe[d].res;g.tvf=Ne(ie({},p),{correlationId:i}),o?(g.internal=Ne(ie({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),F(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Tn(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?vr:Ye;u=await this.client.core.crypto.encode(s,l,Ne(ie({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let f;try{f=await this.client.core.history.get(s,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),p}if(h){const p=Bs(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Oe[p].res;this.client.core.relayer.publish(s,u,d)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Ut(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ut(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Pt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Pt.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Pt.idle}),F(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=q("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Gt.proposal_listener_not_found)),this.isValidConnect(ie({},s.params));const u=a.expiryTimestamp||pe(Oe.wc_sessionPropose.req.ttl),h=ie({id:c,pairingTopic:i,expiryTimestamp:u,attestation:n,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:n,hash:ft(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Bt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:Oe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(Tt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:r,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(dt(i)){await this.deleteProposal(n);const o=re("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),F(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=i.params,p=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const d=this.client.proposal.get(p.proposalId),g=Ne(ie(ie(ie({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(re("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;Tt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(re("session_approve",s),{})):dt(i)&&(await this.client.session.delete(r,ce("USER_DISCONNECTED")),this.events.emit(re("session_approve",s),{error:i.error}))}),F(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=Ci.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ie({topic:r},s));try{Ci.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0})}catch(c){throw Ci.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=re("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Tt(i)?this.events.emit(re("session_update",s),{}):dt(i)&&this.events.emit(re("session_update",s),{error:i.error})}),F(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,pe(si)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),F(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=re("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Tt(i)?this.events.emit(re("session_extend",s),{}):dt(i)&&this.events.emit(re("session_extend",s),{error:i.error})}),F(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),F(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=re("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);Tt(i)?this.events.emit(re("session_ping",s),{}):dt(i)&&this.events.emit(re("session_ping",s),{error:i.error})},500)}),F(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(he.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ce("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),F(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(ie({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:ft(JSON.stringify(xt("wc_sessionRequest",f,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),u===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=re("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Tt(i)?this.events.emit(re("session_request",s),{result:i.result}):dt(i)&&this.events.emit(re("session_request",s),{error:i.error})}),F(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=Ci.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ie({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),Ci.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Tt(i)?this.events.emit(re("session_request",s),{result:i.result}):dt(i)&&this.events.emit(re("session_request",s),{error:i.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,f=await this.getVerifyContext({attestationId:o,hash:ft(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:s,id:n.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:p,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),p={type:tr,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:p,rpcOpts:Oe.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Pt.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=re("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(re("session_request",n.request.id),{error:i})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Pt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Pt.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:xt("wc_sessionPropose",Ne(ie({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Ke(r)){const{message:l}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(be(i)||await this.isValidPairingTopic(i),!lI(c)){const{message:l}=q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!be(s)&&jt(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!be(n)&&jt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),be(o)||this.validateSessionProps(o,"sessionProperties"),!be(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(r,i)=>{const s=cI(r,"connect()",i);if(s)throw new Error(s.message)}),F(this,"isValidApprove",async r=>{if(!Ke(r))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=Oo(s,"approve()");if(l)throw new Error(l.message);const u=Nu(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!ge(n,!0)){const{message:h}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(be(o)||this.validateSessionProps(o,"sessionProperties"),!be(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Ke(r)){const{message:n}=q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!hI(s)){const{message:n}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Ke(r)){const{message:l}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!Lp(i)){const{message:l}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=rI(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Oo(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ut(o)){const{message:l}=q("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async r=>{if(!Ke(r)){const{message:c}=q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=Oo(s,"update()");if(o)throw new Error(o.message);const a=Nu(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Ke(r)){const{message:s}=q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),F(this,"isValidRequest",async r=>{if(!Ke(r)){const{message:c}=q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Uu(a,n)){const{message:c}=q("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!fI(s)){const{message:c}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!gI(a,n,s.method)){const{message:c}=q("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!bI(o,Fo)){const{message:c}=q("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Fo.min} and ${Fo.max}`);throw new Error(c)}}),F(this,"isValidRespond",async r=>{var i;if(!Ke(r)){const{message:o}=q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(o){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!dI(n)){const{message:o}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),F(this,"isValidPing",async r=>{if(!Ke(r)){const{message:s}=q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidEmit",async r=>{if(!Ke(r)){const{message:a}=q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Uu(o,n)){const{message:a}=q("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!pI(s)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!yI(o,n,s.name)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Ke(r)){const{message:s}=q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(s,!1))throw new Error("uri is required parameter");if(!ge(n,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>er(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=er(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Wi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=q("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),F(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=q("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),F(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,l,u,h,f;return!r||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r?.redirect)==null?void 0:s.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Wl(r,"topic")||"",s=decodeURIComponent(Wl(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),F(this,"registerLinkModeListeners",async()=>{var r;if(ac()||Sr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),F(this,"getTVFParams",(r,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),F(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=r?.data||((i=r?.[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const n=r.method,o=uO[n];if(n==="sui_signTransaction")return[UE(i.transactionBytes)];if(n==="near_signTransaction")return[tu(i)];if(n==="near_signTransactions")return i.map(c=>tu(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[RI({transaction:r.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return gt(i)?i.map(c=>ru(c)):[ru(i)];if(n==="cosmos_signDirect")return[kE(i)];if(n==="wallet_sendCalls")return jE(i);if(typeof i=="string")return[i];const a=i[o.key];if(gt(a))return n==="solana_signAllTransactions"?a.map(c=>RE(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(he.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ks)?this.client.auth.authKeys.get(Ks):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===ae.link_mode?vr:Ye});Ec(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:ft(i)})):Rn(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ut.expired,async e=>{const{topic:r,id:i}=Md(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,q("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Rr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Rr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=q("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=q("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:r}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!uI(e)){const{message:r}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class _O extends Zr{constructor(e,r){super(e,r,aO,Ic),this.core=e,this.logger=r}}let SO=class extends Zr{constructor(e,r){super(e,r,cO,Ic),this.core=e,this.logger=r}};class $O extends Zr{constructor(e,r){super(e,r,hO,Ic,i=>i.id),this.core=e,this.logger=r}}class DO extends Zr{constructor(e,r){super(e,r,gO,Nn,()=>Ks),this.core=e,this.logger=r}}class OO extends Zr{constructor(e,r){super(e,r,yO,Nn),this.core=e,this.logger=r}}class AO extends Zr{constructor(e,r){super(e,r,wO,Nn,i=>i.id),this.core=e,this.logger=r}}var PO=Object.defineProperty,BO=(t,e,r)=>e in t?PO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lo=(t,e,r)=>BO(t,typeof e!="symbol"?e+"":e,r);class CO{constructor(e,r){this.core=e,this.logger=r,Lo(this,"authKeys"),Lo(this,"pairingTopics"),Lo(this,"requests"),this.authKeys=new DO(this.core,this.logger),this.pairingTopics=new OO(this.core,this.logger),this.requests=new AO(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var TO=Object.defineProperty,RO=(t,e,r)=>e in t?TO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>RO(t,typeof e!="symbol"?e+"":e,r);let UO=class gg extends X_{constructor(e){super(e),Q(this,"protocol",fg),Q(this,"version",dg),Q(this,"name",jo.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new wt.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(i,s)=>this.events.on(i,s)),Q(this,"once",(i,s)=>this.events.once(i,s)),Q(this,"off",(i,s)=>this.events.off(i,s)),Q(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),Q(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Q(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Q(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||jo.name,this.metadata=D2(e?.metadata),this.signConfig=e?.signConfig;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:gs(Cn({level:e?.logger||jo.logger}));this.core=e?.core||new oO(e),this.logger=qe(r,this.name),this.session=new SO(this.core,this.logger),this.proposal=new _O(this.core,this.logger),this.pendingRequest=new $O(this.core,this.logger),this.engine=new IO(this),this.auth=new CO(this.core,this.logger)}static async init(e){const r=new gg(e);return await r.initialize(),r}get context(){return Qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Rs={exports:{}},Ch;function NO(){return Ch||(Ch=1,function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Rt<"u"&&Rt,i=function(){function n(){this.fetch=!1,this.DOMException=r.DOMException}return n.prototype=r,new n}();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof Rt<"u"&&Rt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(y){return y&&u.indexOf(Object.prototype.toString.call(y))>-1};function f(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function p(y){return typeof y!="string"&&(y=String(y)),y}function d(y){var w={next:function(){var x=y.shift();return{done:x===void 0,value:x}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function g(y){this.map={},y instanceof g?y.forEach(function(w,x){this.append(x,w)},this):Array.isArray(y)?y.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(w){this.append(w,y[w])},this)}g.prototype.append=function(y,w){y=f(y),w=p(w);var x=this.map[y];this.map[y]=x?x+", "+w:w},g.prototype.delete=function(y){delete this.map[f(y)]},g.prototype.get=function(y){return y=f(y),this.has(y)?this.map[y]:null},g.prototype.has=function(y){return this.map.hasOwnProperty(f(y))},g.prototype.set=function(y,w){this.map[f(y)]=p(w)},g.prototype.forEach=function(y,w){for(var x in this.map)this.map.hasOwnProperty(x)&&y.call(w,this.map[x],x,this)},g.prototype.keys=function(){var y=[];return this.forEach(function(w,x){y.push(x)}),d(y)},g.prototype.values=function(){var y=[];return this.forEach(function(w){y.push(w)}),d(y)},g.prototype.entries=function(){var y=[];return this.forEach(function(w,x){y.push([x,w])}),d(y)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function m(y){if(!y._noBody){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}}function E(y){return new Promise(function(w,x){y.onload=function(){w(y.result)},y.onerror=function(){x(y.error)}})}function S(y){var w=new FileReader,x=E(w);return w.readAsArrayBuffer(y),x}function b(y){var w=new FileReader,x=E(w),P=/charset=([A-Za-z0-9_-]+)/.exec(y.type),_=P?P[1]:"utf-8";return w.readAsText(y,_),x}function I(y){for(var w=new Uint8Array(y),x=new Array(w.length),P=0;P<w.length;P++)x[P]=String.fromCharCode(w[P]);return x.join("")}function A(y){if(y.slice)return y.slice(0);var w=new Uint8Array(y.byteLength);return w.set(new Uint8Array(y)),w.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(y){this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&l(y)?(this._bodyArrayBuffer=A(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||h(y))?this._bodyArrayBuffer=A(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=m(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=m(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(S);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var y=m(this);if(y)return y;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(I(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var C=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(y){var w=y.toUpperCase();return C.indexOf(w)>-1?w:y}function B(y,w){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var x=w.body;if(y instanceof B){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,w.headers||(this.headers=new g(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!x&&y._bodyInit!=null&&(x=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new g(w.headers)),this.method=R(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||function(){if("AbortController"in a){var $=new AbortController;return $.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&x)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(x),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var P=/([?&])_=[^&]*/;if(P.test(this.url))this.url=this.url.replace(P,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}B.prototype.clone=function(){return new B(this,{body:this._bodyInit})};function k(y){var w=new FormData;return y.trim().split("&").forEach(function(x){if(x){var P=x.split("="),_=P.shift().replace(/\+/g," "),$=P.join("=").replace(/\+/g," ");w.append(decodeURIComponent(_),decodeURIComponent($))}}),w}function U(y){var w=new g,x=y.replace(/\r?\n[\t ]+/g," ");return x.split("\r").map(function(P){return P.indexOf(`
`)===0?P.substr(1,P.length):P}).forEach(function(P){var _=P.split(":"),$=_.shift().trim();if($){var N=_.join(":").trim();try{w.append($,N)}catch(j){console.warn("Response "+j.message)}}}),w}v.call(B.prototype);function T(y,w){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new g(w.headers),this.url=w.url||"",this._initBody(y)}v.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},T.error=function(){var y=new T(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var O=[301,302,303,307,308];T.redirect=function(y,w){if(O.indexOf(w)===-1)throw new RangeError("Invalid status code");return new T(null,{status:w,headers:{location:y}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,x){this.message=w,this.name=x;var P=Error(w);this.stack=P.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function D(y,w){return new Promise(function(x,P){var _=new B(y,w);if(_.signal&&_.signal.aborted)return P(new o.DOMException("Aborted","AbortError"));var $=new XMLHttpRequest;function N(){$.abort()}$.onload=function(){var L={statusText:$.statusText,headers:U($.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&($.status<200||$.status>599)?L.status=200:L.status=$.status,L.url="responseURL"in $?$.responseURL:L.headers.get("X-Request-URL");var M="response"in $?$.response:$.responseText;setTimeout(function(){x(new T(M,L))},0)},$.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},$.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},$.onabort=function(){setTimeout(function(){P(new o.DOMException("Aborted","AbortError"))},0)};function j(L){try{return L===""&&a.location.href?a.location.href:L}catch{return L}}if($.open(_.method,j(_.url),!0),_.credentials==="include"?$.withCredentials=!0:_.credentials==="omit"&&($.withCredentials=!1),"responseType"in $&&(c.blob?$.responseType="blob":c.arrayBuffer&&($.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof g||a.Headers&&w.headers instanceof a.Headers)){var V=[];Object.getOwnPropertyNames(w.headers).forEach(function(L){V.push(f(L)),$.setRequestHeader(L,p(w.headers[L]))}),_.headers.forEach(function(L,M){V.indexOf(M)===-1&&$.setRequestHeader(M,L)})}else _.headers.forEach(function(L,M){$.setRequestHeader(M,L)});_.signal&&(_.signal.addEventListener("abort",N),$.onreadystatechange=function(){$.readyState===4&&_.signal.removeEventListener("abort",N)}),$.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return D.polyfill=!0,a.fetch||(a.fetch=D,a.Headers=g,a.Request=B,a.Response=T),o.Headers=g,o.Request=B,o.Response=T,o.fetch=D,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=r.fetch?r:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e}(Rs,Rs.exports)),Rs.exports}var kO=NO();const Th=lf(kO);var jO=Object.defineProperty,FO=Object.defineProperties,LO=Object.getOwnPropertyDescriptors,Rh=Object.getOwnPropertySymbols,MO=Object.prototype.hasOwnProperty,qO=Object.prototype.propertyIsEnumerable,Uh=(t,e,r)=>e in t?jO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nh=(t,e)=>{for(var r in e||(e={}))MO.call(e,r)&&Uh(t,r,e[r]);if(Rh)for(var r of Rh(e))qO.call(e,r)&&Uh(t,r,e[r]);return t},kh=(t,e)=>FO(t,LO(e));const zO={Accept:"application/json","Content-Type":"application/json"},VO="POST",jh={headers:zO,method:VO},Fh=10;let yg=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new wt.EventEmitter,this.isAvailable=!1,this.registering=!1,!th(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=ir(e),i=await(await Th(this.url,kh(Nh({},jh),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!th(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=ir({id:1,jsonrpc:"2.0",method:"test",params:[]});await Th(e,kh(Nh({},jh),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?zr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=Tn(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Kp(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Fh&&this.events.setMaxListeners(Fh)}};const Lh="error",HO="wss://relay.walletconnect.org",KO="wc",WO="universal_provider",Us=`${KO}@2:${WO}:`,wg="https://rpc.walletconnect.org/v1/",mg="generic",GO=`${wg}bundler`,pi="call_status",YO=86400,_c={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Sc(t){return t==null||typeof t!="object"&&typeof t!="function"}function bg(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function vg(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const ZO="[object RegExp]",Eg="[object String]",xg="[object Number]",Ig="[object Boolean]",_g="[object Arguments]",JO="[object Symbol]",XO="[object Date]",QO="[object Map]",eA="[object Set]",tA="[object Array]",rA="[object ArrayBuffer]",iA="[object Object]",sA="[object DataView]",nA="[object Uint8Array]",oA="[object Uint8ClampedArray]",aA="[object Uint16Array]",cA="[object Uint32Array]",lA="[object Int8Array]",uA="[object Int16Array]",hA="[object Int32Array]",fA="[object Float32Array]",dA="[object Float64Array]";function $c(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function pA(t,e){return ui(t,void 0,t,new Map,e)}function ui(t,e,r,i=new Map,s=void 0){const n=s?.(t,e,r,i);if(n!=null)return n;if(Sc(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=ui(t[a],a,r,i,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,ui(c,a,r,i,s));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(ui(a,void 0,r,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if($c(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=ui(t[a],a,r,i,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),Ur(o,t,r,i,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),Ur(o,t,r,i,s),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),Ur(o,t,r,i,s),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Ur(o,t,r,i,s),o}if(typeof t=="object"&&gA(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),Ur(o,t,r,i,s),o}return t}function Ur(t,e,r=t,i,s){const n=[...Object.keys(e),...bg(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=ui(e[a],a,r,i,s))}}function gA(t){switch(vg(t)){case _g:case tA:case rA:case sA:case Ig:case XO:case fA:case dA:case lA:case uA:case hA:case QO:case xg:case iA:case ZO:case eA:case Eg:case JO:case nA:case oA:case aA:case cA:return!0;default:return!1}}function yA(t,e){return pA(t,(r,i,s,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case xg:case Eg:case Ig:{const o=new t.constructor(t?.valueOf());return Ur(o,t),o}case _g:{const o={};return Ur(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function Mh(t){return yA(t)}function qh(t){return t!==null&&typeof t=="object"&&vg(t)==="[object Arguments]"}function zh(t){return typeof t=="object"&&t!==null}function wA(){}function mA(t){return $c(t)}function bA(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function vA(t){if(Sc(t))return t;if(Array.isArray(t)||$c(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const i=new r(t.message);return i.stack=t.stack,i.name=t.name,i.cause=t.cause,i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function EA(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let s=t;for(let n=0;n<r.length;n++){const o=r[n];s=ja(s,o,i,new Map)}return s}function ja(t,e,r,i){if(Sc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return vA(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...bg(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=t[o];if(qh(a)&&(a={...a}),qh(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Mh(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const p=h[f];u[p]=c[p]}c=u}else c=[];const l=r(c,a,o,t,e,i);l!=null?t[o]=l:Array.isArray(a)||zh(c)&&zh(a)?t[o]=ja(c,a,r,i):c==null&&bA(a)?t[o]=ja({},a,r,i):c==null&&mA(a)?t[o]=Mh(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function xA(t,...e){return EA(t,...e,wA)}var IA=Object.defineProperty,_A=Object.defineProperties,SA=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,$A=Object.prototype.hasOwnProperty,DA=Object.prototype.propertyIsEnumerable,Hh=(t,e,r)=>e in t?IA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ns=(t,e)=>{for(var r in e||(e={}))$A.call(e,r)&&Hh(t,r,e[r]);if(Vh)for(var r of Vh(e))DA.call(e,r)&&Hh(t,r,e[r]);return t},OA=(t,e)=>_A(t,SA(e));function Sg(t,e,r){var i;const s=er(t);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${wg}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function AA(t){return t.includes(":")?t.split(":")[1]:t}function $g(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function PA(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const i=[];return r.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function Kh(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,s;return((i=r?.chains)==null?void 0:i.length)&&((s=r?.chains)==null?void 0:s.length)>0}))}function ks(t={},e={}){const r=Kh(Wh(t)),i=Kh(Wh(e));return xA(r,i)}function Wh(t){var e,r,i,s,n;const o={};if(!jt(t))return o;for(const[a,c]of Object.entries(t)){const l=Bn(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},p=li(a);o[p]=OA(Ns(Ns({},o[p]),c),{chains:kt(l,(e=o[p])==null?void 0:e.chains),methods:kt(u,(r=o[p])==null?void 0:r.methods),events:kt(h,(i=o[p])==null?void 0:i.events)}),(jt(f)||jt(((s=o[p])==null?void 0:s.rpcMap)||{}))&&(o[p].rpcMap=Ns(Ns({},f),(n=o[p])==null?void 0:n.rpcMap))}return o}function Gh(t){return t.includes(":")?t.split(":")[2]:t}function Yh(t){const e={};for(const[r,i]of Object.entries(t)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=Bn(r)?[r]:i.chains?i.chains:$g(i.accounts);e[r]={chains:a,methods:s,events:n,accounts:o}}return e}function Mo(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function BA(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Dg={},gi=t=>Dg[t],qo=(t,e)=>{Dg[t]=e};var CA=Object.defineProperty,Zh=Object.getOwnPropertySymbols,TA=Object.prototype.hasOwnProperty,RA=Object.prototype.propertyIsEnumerable,Jh=(t,e,r)=>e in t?CA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xh=(t,e)=>{for(var r in e||(e={}))TA.call(e,r)&&Jh(t,r,e[r]);if(Zh)for(var r of Zh(e))RA.call(e,r)&&Jh(t,r,e[r]);return t};const Qh="eip155",UA=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],NA=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,zo=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,ef=t=>Object.keys(t).filter(e=>UA.includes(e)).reduce((e,r)=>(e[r]=kA(t[r]),e),{}),kA=t=>typeof t=="string"&&BA(t)?JSON.parse(t):t,jA=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:s={}}=t,n={};if(!jt(s)&&!jt(i))return;const o=ef(i);for(const a of r){const c=NA(a);if(!c)continue;n[zo(c)]=o;const l=s?.[`${Qh}:${c}`];if(l){const u=l?.[`${Qh}:${c}:${e}`];n[zo(c)]=Xh(Xh({},n[zo(c)]),ef(u||l))}}for(const[a,c]of Object.entries(n))Object.keys(c).length===0&&delete n[a];return Object.keys(n).length>0?n:void 0};var FA=Object.defineProperty,LA=(t,e,r)=>e in t?FA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,MA=(t,e,r)=>LA(t,e+"",r);let Vo,qA=class Og{constructor(e){MA(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Vo||(Vo=new Og(e)),Vo}};var zA=Object.defineProperty,VA=Object.defineProperties,HA=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertySymbols,KA=Object.prototype.hasOwnProperty,WA=Object.prototype.propertyIsEnumerable,rf=(t,e,r)=>e in t?zA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,GA=(t,e)=>{for(var r in e||(e={}))KA.call(e,r)&&rf(t,r,e[r]);if(tf)for(var r of tf(e))WA.call(e,r)&&rf(t,r,e[r]);return t},YA=(t,e)=>VA(t,HA(e));async function ZA(t,e){const r=er(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(i.map(h=>JA(r.reference,h,e))),n=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!n.length||n.some(h=>!h),a=n.every(h=>h?.status==="0x1"),c=n.every(h=>h?.status==="0x0"),l=n.some(h=>h?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:n,status:u}}async function JA(t,e,r){return await r(parseInt(t)).request(xt("eth_getTransactionReceipt",[e]))}async function XA({sendCalls:t,storage:e}){const r=await e.getItem(pi);await e.setItem(pi,YA(GA({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:pe(YO)}}))}async function QA({resultId:t,storage:e}){const r=await e.getItem(pi);if(r){delete r[t],await e.setItem(pi,r);for(const i in r)Ut(r[i].expiry)&&delete r[i];await e.setItem(pi,r)}}async function e6({resultId:t,storage:e}){const r=await e.getItem(pi),i=r?.[t];if(i&&!Ut(i.expiry))return i;await QA({resultId:t,storage:e})}var t6=Object.defineProperty,r6=Object.defineProperties,i6=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,s6=Object.prototype.hasOwnProperty,n6=Object.prototype.propertyIsEnumerable,Fa=(t,e,r)=>e in t?t6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ho=(t,e)=>{for(var r in e||(e={}))s6.call(e,r)&&Fa(t,r,e[r]);if(sf)for(var r of sf(e))n6.call(e,r)&&Fa(t,r,e[r]);return t},Ko=(t,e)=>r6(t,i6(e)),Pr=(t,e,r)=>Fa(t,typeof e!="symbol"?e+"":e,r);class o6{constructor(e){Pr(this,"name","eip155"),Pr(this,"client"),Pr(this,"chainId"),Pr(this,"namespace"),Pr(this,"httpProviders"),Pr(this,"events"),Pr(this,"storage"),this.namespace=e.namespace,this.events=gi("events"),this.client=gi("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=qA.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(_c.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Sg(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new xc(new yg(i,gi("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=parseInt(AA(r));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=Ko(Ho({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,s,n,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,f=u?.[h];if(f)return f;let p;try{p=jA(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(p)return p;const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ko(Ho({},l.sessionProperties||{}),{capabilities:Ko(Ho({},u||{}),{[h]:d})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return d}async getCallStatus(e){var r,i,s;const n=this.client.session.get(e.topic),o=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await e6({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await ZA(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(xt("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,r){return`${GO}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,s;const n=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=n?.id,c=n?.capabilities||{},l=(i=c?.caip345)==null?void 0:i.caip2,u=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await XA({sendCalls:{request:o,result:n},storage:this.storage}),n}}var a6=Object.defineProperty,c6=(t,e,r)=>e in t?a6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ni=(t,e,r)=>c6(t,typeof e!="symbol"?e+"":e,r);class l6{constructor(e){ni(this,"name",mg),ni(this,"client"),ni(this,"httpProviders"),ni(this,"events"),ni(this,"namespace"),ni(this,"chainId"),this.namespace=e.namespace,this.events=gi("events"),this.client=gi("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(_c.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return er(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var n,o;const a=er(s),c=(o=(n=this.namespace)==null?void 0:n.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(s,c)}),i}getHttpProvider(e){const r=er(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Sg(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new xc(new yg(i,gi("disableProviderPing")))}}var u6=Object.defineProperty,h6=Object.defineProperties,f6=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,d6=Object.prototype.hasOwnProperty,p6=Object.prototype.propertyIsEnumerable,La=(t,e,r)=>e in t?u6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ji=(t,e)=>{for(var r in e||(e={}))d6.call(e,r)&&La(t,r,e[r]);if(nf)for(var r of nf(e))p6.call(e,r)&&La(t,r,e[r]);return t},js=(t,e)=>h6(t,f6(e)),lt=(t,e,r)=>La(t,typeof e!="symbol"?e+"":e,r);class Dc{constructor(e){lt(this,"client"),lt(this,"namespaces"),lt(this,"optionalNamespaces"),lt(this,"sessionProperties"),lt(this,"scopedProperties"),lt(this,"events",new qa),lt(this,"rpcProviders",{}),lt(this,"session"),lt(this,"providerOpts"),lt(this,"logger"),lt(this,"uri"),lt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:gs(Cn({level:e?.logger||Lh})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new Dc(e);return await r.initialize(),r}async request(e,r,i){const[s,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ji({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>r(null,rs(n,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=Yh(this.session.namespaces);this.namespaces=ks(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const s=await i();this.session=s;const n=Yh(s.namespaces);return this.namespaces=ks(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!gt(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn("Failed to cleanup pending pairings",r)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await UO.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Lh,relayUrl:this.providerOpts.relayUrl||HO,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>li(r)))];qo("client",this.client),qo("events",this.events),qo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=PA(r,this.session);if(i?.length===0)return;const s=$g(i),n=ks(this.namespaces,this.optionalNamespaces),o=js(ji({},n[r]),{accounts:i,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new o6({namespace:o});break;default:this.rpcProviders[r]=new l6({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&gt(o)&&this.events.emit("accountsChanged",o.map(Gh))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=li(o),l=Mo(o)!==Mo(a)?`${c}:${Mo(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=js(ji({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",js(ji({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(_c.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(js(ji({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[mg]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=ks(r,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>li(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const s=li(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[s,n]=this.validateChain(e);n&&(this.updateNamespaceChain(s,n),i?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(s).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var s,n;try{if(i===r)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(Gh);if(!gt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Us}/${e}${s}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Us}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Us}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(Us)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const g6=Dc,y6="wc",w6="ethereum_provider",m6=`${y6}@2:${w6}:`,b6="https://rpc.walletconnect.org/v1/",dn=["eth_sendTransaction","personal_sign"],Ag=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],pn=["chainChanged","accountsChanged"],Pg=["chainChanged","accountsChanged","message","disconnect","connect"],v6=async()=>{const{createAppKit:t}=await Lg(()=>import("./core-Cq-uZS8R.js").then(e=>e.a0),__vite__mapDeps([0,1,2,3]),import.meta.url);return t};var E6=Object.defineProperty,x6=Object.defineProperties,I6=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,_6=Object.prototype.hasOwnProperty,S6=Object.prototype.propertyIsEnumerable,Ma=(t,e,r)=>e in t?E6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cr=(t,e)=>{for(var r in e||(e={}))_6.call(e,r)&&Ma(t,r,e[r]);if(of)for(var r of of(e))S6.call(e,r)&&Ma(t,r,e[r]);return t},Fi=(t,e)=>x6(t,I6(e)),tt=(t,e,r)=>Ma(t,typeof e!="symbol"?e+"":e,r);function gn(t){return Number(t[0].split(":")[1])}function Fs(t){return`0x${t.toString(16)}`}function $6(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=t;if(!gt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||dn,events:n||pn,rpcMap:Cr({},e.length?{[gn(e)]:a[gn(e)]}:{})},l=n?.filter(p=>!pn.includes(p)),u=i?.filter(p=>!dn.includes(p));if(!r&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=l?.length&&u?.length||!r,f={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:Ag))],events:[...new Set(c.events.concat(o!=null&&o.length?o:Pg))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?f:void 0}}class kn{constructor(){tt(this,"events",new wt.EventEmitter),tt(this,"namespace","eip155"),tt(this,"accounts",[]),tt(this,"signer"),tt(this,"chainId",1),tt(this,"modal"),tt(this,"rpc"),tt(this,"STORAGE_KEY",m6),tt(this,"on",(e,r)=>(this.events.on(e,r),this)),tt(this,"once",(e,r)=>(this.events.once(e,r),this)),tt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),tt(this,"off",(e,r)=>(this.events.off(e,r),this)),tt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new kn;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:s}=$6(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Fi(Cr({namespaces:Cr({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e?.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!n)return;const o=ql(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Fs(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Fi(Cr({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),n=s.session;if(n){const o=ql(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Fs(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Fs(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Fi(Cr({},ce("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Fs(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,s]=e.split(":");return{chainId:`${r}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const s=(r=e?.chains)!=null?r:[],n=(i=e?.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?e?.methods||dn:[],c=s.length?e?.events||pn:[],l=e?.optionalMethods||[],u=e?.optionalEvents||[],h=e?.rpcMap||this.buildRpcMap(o,e.projectId),f=e?.qrModalOptions||void 0;return{chains:s?.map(p=>this.formatChainId(p)),optionalChains:n.map(p=>this.formatChainId(p)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?gn(this.rpc.chains):gn(this.rpc.optionalChains),this.signer=await g6.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const i=await v6(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return k6}),n=s(Fi(Cr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnect·");r=i(Fi(Cr({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(i){throw console.warn(i),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:s}=e;r&&gt(r)&&(this.rpc.chains=r.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)})),i&&gt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${b6}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const D6=kn;var O6=Object.defineProperty,A6=Object.defineProperties,P6=Object.getOwnPropertyDescriptors,af=Object.getOwnPropertySymbols,B6=Object.prototype.hasOwnProperty,C6=Object.prototype.propertyIsEnumerable,cf=(t,e,r)=>e in t?O6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bg=(t,e)=>{for(var r in e||(e={}))B6.call(e,r)&&cf(t,r,e[r]);if(af)for(var r of af(e))C6.call(e,r)&&cf(t,r,e[r]);return t},T6=(t,e)=>A6(t,P6(e));function R6(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const U6=t=>{const[e,r]=t.split(":");return Cg({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function N6(t){var e,r,i,s,n,o,a;const c=(e=t.chains)==null?void 0:e.map(U6).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=t.defaultChain)==null?void 0:f.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:R6(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:T6(Bg({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((s=t.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=t.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(d=>({id:d.id,name:d.name,links:d.links})),...(t.desktopWallets||[]).map(d=>({id:d.id,name:d.name,links:{native:d.links.native,universal:d.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],p=h.filter(d=>!f.includes(d.id));p.length&&(u.customWallets=p)}return u}function Cg(t){return Bg({formatters:void 0,fees:void 0,serializers:void 0},t)}var k6=Object.freeze({__proto__:null,convertWCMToAppKitOptions:N6,defineChain:Cg});const A4=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:D6,OPTIONAL_EVENTS:Pg,OPTIONAL_METHODS:Ag,REQUIRED_EVENTS:pn,REQUIRED_METHODS:dn,default:kn},Symbol.toStringTag,{value:"Module"}));export{T_ as A,fv as B,l2 as C,ir as D,qe as E,zr as F,Er as G,Tn as H,Wr as I,Tt as J,dt as K,Ct as L,yg as M,z6 as N,A4 as O,Ul as P,Pd as Q,z as a,rr as b,By as c,Yg as d,Vi as e,pt as f,os as g,vm as h,hm as i,Rw as j,c0 as k,d2 as l,Cn as m,NI as n,y_ as o,xt as p,gs as q,Gr as r,la as s,Xe as t,xc as u,x8 as v,Ec as w,Rn as x,Qe as y,rs as z};
